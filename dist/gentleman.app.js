(()=>{"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function n(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?m(e)?t:e:f(e)?t:e}function r(e){return h(e)&&0===e.length}function a(t){return t instanceof Date||"object"===e(t)&&"[object Date]"===Object.prototype.toString.call(t)}function l(e){return"string"==typeof e||e instanceof String}function o(e){return"function"==typeof e}function c(t){return!f(t)&&"object"===e(t)}function h(e){return!f(e)&&"function"==typeof e[Symbol.iterator]}function u(e){return h(e)&&!l(e)}function d(e){return null===e}function p(e){return!e||l(e)&&(0===e.length||/^\s*$/.test(e))}function m(e){return void 0===e}function f(e){return d(e)||m(e)}var b=Object.prototype.hasOwnProperty,v=(Object.prototype.isPrototypeOf,function(e,t){return b.call(e,t)});function g(e){if(f(e)||!c(e))return e;var t=e.constructor();for(var i in e)v(e,i)&&(e.isActiveClone=null,t[i]=g(e[i]),delete e.isActiveClone);return t}function y(e){return p(e)?e:e.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()}))}function E(e){return p(e)?e:y(e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function w(e){var t=n(e,!1);return l(t)&&"true"===t.toLowerCase()||Number.isInteger(t)&&1===t||!0===t}var C=function(e){return!f(e)&&e.nodeType===Node.ELEMENT_NODE},j=function(e){return e instanceof Node},L=function(e){return C(e)&&e instanceof Element},x=function(e,t){return!!(C(e)&&e instanceof HTMLElement)&&(!h(t)||(s=e,n=Array.isArray(t)?t:[t],a=function(e){return s instanceof e},l=function(e){return s.tagName===e.toUpperCase()},o=function(e){return Array.isArray(e)?e.includes(s.type):s.type===e},n.some((function(e){if(!h(e))return!1;var t,s,n=e,c=null;if(Array.isArray(e)){var d=(s=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){n=!0,r=e}finally{try{s||null==l.return||l.return()}finally{if(n)throw r}}return i}}(t,s)||i(t,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());n=d[0],c=d[1]}n=n.toLowerCase();var p="HTML".concat(v(T,n)?T[n]:E(n),"Element");return!(!a(window[p])&&!l(n))&&(!(u(c)&&!r(c))||o(c))}))));var s,n,a,l,o},T={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},O=function(e){return function(e){return!f(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&e instanceof DocumentFragment};function A(e,t){if(!l(t))return null;var i=document.createElement("template");return i.innerHTML=t.trim(),i.content[e]}var _=A.bind(null,"firstChild");function V(e,t,i){e[t]=i}function S(e,t,i){e.setAttribute(t,i)}A.bind(null,"childNodes");var R="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",M={accesskey:[V,"accessKey"],autocapitalize:[V,"autocapitalize"],class:[function(e,i){var s;if(!x(e))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(s=e.classList).add.apply(s,t(Array.isArray(i)?i:[i])),e}],dataset:[function(e,t,i){Object.assign(e[t],i)},"dataset"],draggable:[V,"draggable"],editable:[V,"contentEditable"],hidden:[V,"hidden"],id:[V,"id"],inputmode:[V,"inputMode"],lang:[V,"lang"],html:[V,"innerHTML"],style:[V,"style"],tabindex:[V,"tabIndex"],text:[V,"textContent"],title:[V,"title"],data:[V,"data"],cite:[V,"cite"],download:[V,"download"],ping:[V,"ping"],target:[V,"target"],coords:[V,"coords"],shape:[V,"shape"],autoplay:[V,"autoplay"],buffered:[V,"buffered"],controls:[V,"controls"],loop:[V,"loop"],muted:[V,"muted"],playsinline:[S,"playsinline"],poster:[V,"poster"],preload:[V,"preload"],crossorigin:[V,"crossOrigin"],decoding:[V,"decoding"],height:[V,"height"],ismap:[V,"isMap"],loading:[V,"loading"],srcset:[V,"srcset"],width:[V,"width"],alt:[V,"alt"],as:[V,"as"],media:[V,"media"],rel:[V,"rel"],src:[V,"src"],sizes:[V,"sizes"],reversed:[V,"reversed"],start:[V,"start"],accept:[V,"accept"],"accept-charset":[V,"acceptCharset"],action:[V,"action"],autocomplete:[V,"autocomplete"],autofocus:[V,"autofocus"],capture:[V,"capture"],checked:[V,"checked"],cols:[V,"cols"],disabled:[V,"disabled"],dirname:[V,"dirName"],enctype:[V,"enctype"],for:[V,"for"],form:[V,"form"],formaction:[V,"formAction"],formenctype:[V,"formEnctype"],formmethod:[V,"formMethod"],formnovalidate:[V,"formNoValidate"],formtarget:[V,"formTarget"],high:[V,"high"],label:[V,"label"],list:[V,"list"],low:[V,"low"],max:[V,"max"],maxlength:[V,"maxLength"],method:[V,"method"],min:[V,"min"],minlength:[V,"minLength"],multiple:[V,"multiple"],name:[V,"name"],novalidate:[V,"noValidate"],optimum:[V,"optimum"],pattern:[V,"pattern"],placeholder:[V,"placeholder"],readonly:[V,"readOnly"],required:[V,"required"],rows:[V,"rows"],selected:[V,"selected"],size:[V,"size"],spellcheck:[S,"spellcheck"],step:[V,"step"],wrap:[V,"wrap"],default:[V,"default"],kind:[V,"kind"],srclang:[V,"srclang"],abbr:[V,"abbr"],colspan:[V,"colSpan"],span:[V,"span"],rowspan:[V,"rowSpan"],scope:[V,"scope"],href:[V,"href"],hreflang:[V,"hreflang"],datetime:[V,"dateTime"],type:[V,"type"],value:[V,"value"],usemap:[V,"useMap"]};function k(e,i,s){var r=document.createElement(e);return x(r)?(c(s)&&function(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!x(e))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!c(i))return e;for(var n=function(e){return R.includes(e)||s.includes(e)},r=0,a=Object.keys(i);r<a.length;r++){var l=a[r];if(n(l)){var o=i[l],h=M[l].slice(0);h.shift().apply(void 0,[e].concat(t(h),[o]))}}}(r,s,n(i,"")),r):null}function I(e,t,i,s){var n=k(e,t,i);return x(n)?(f(s)||fe(n,s),n):null}function N(e,t,i,s,n){var r=k(e,t,s);return x(r)?(f(n)||fe(r,n,i),r):null}function H(e){var t=document.createDocumentFragment();return f(e)||fe(t,e),t}k.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),I.bind(null,"template","");var P=I.bind(null,"header",""),$=(I.bind(null,"footer",""),I.bind(null,"main",""),I.bind(null,"article",""),I.bind(null,"section","")),D=(I.bind(null,"nav",""),I.bind(null,"aside",""),I.bind(null,"h1",""),I.bind(null,"h2",""),I.bind(null,"h3","")),B=I.bind(null,"h4",""),F=(I.bind(null,"h5",""),I.bind(null,"h6",""),I.bind(null,"div","")),z=(I.bind(null,"object","data,height,name,type,usemap,width"),k.bind(null,"embed","height,src,type,width"),k.bind(null,"br",""),k.bind(null,"hr",""),I.bind(null,"p","")),q=(I.bind(null,"blockquote","cite"),function(e){return x(e,"li")?e:U(null,e)}),W=N.bind(null,"ul","",q),U=(N.bind(null,"ol","reversed,start,type",q),I.bind(null,"li","value")),J=(I.bind(null,"dl",""),I.bind(null,"dt",""),I.bind(null,"dd",""),I.bind(null,"a","download,href,hreflang,ping,rel,target,type")),G=(k.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),k.bind(null,"base","href,target"),k.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width")),K=I.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),Y=(I.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),k.bind(null,"source","media,sizes,src,srcset,type"),k.bind(null,"track","default,kind,label,src,srclang"),I.bind(null,"picture",""),I.bind(null,"figure",""),I.bind(null,"figcaption",""),I.bind(null,"span","")),Z=I.bind(null,"strong",""),X=I.bind(null,"em",""),Q=(I.bind(null,"mark",""),I.bind(null,"samp",""),I.bind(null,"sub",""),I.bind(null,"sup",""),I.bind(null,"del","cite,datetime"),I.bind(null,"ins","cite,datetime"),I.bind(null,"q","cite"),I.bind(null,"abbr",""),I.bind(null,"b",""),I.bind(null,"i","")),ee=(I.bind(null,"s",""),I.bind(null,"u",""),I.bind(null,"cite",""),I.bind(null,"time","datetime"),I.bind(null,"code",""),I.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),k.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width")),te=I.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),ie=I.bind(null,"label","for"),se=(N.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(e){return x(e,["option","optgroup"])?e:Array.isArray(e)?re(null,e):se(null,e)})),I.bind(null,"option","disabled,label,selected,value")),ne=function(e){return x(e,"option")?e:se(null,e)},re=N.bind(null,"optgroup","disabled,label",ne),ae=(I.bind(null,"fieldset","disabled,name"),I.bind(null,"legend",""),N.bind(null,"datalist","",ne),I.bind(null,"meter","high,low,max,min,optimum,value"),I.bind(null,"progress","max,value"),I.bind(null,"output","name,value"),I.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value")),le=I.bind(null,"table",""),oe=(I.bind(null,"caption",""),function(e){return x(e,"tr")?e:de(null,e)}),ce=N.bind(null,"thead","",oe),he=N.bind(null,"tbody","",oe),ue=N.bind(null,"tfoot","",oe),de=(k.bind(null,"col","span"),N.bind(null,"colgroup","span",(function(e){return x(e,"col")?e:null})),N.bind(null,"tr","",(function(e){return x(e,["th","td"])?e:me(null,e)}))),pe=I.bind(null,"th","abbr,colspan,rowspan,scope"),me=I.bind(null,"td","colspan,rowspan");function fe(e,t,i){var s=Array.isArray(t)?t:[t];return o(i)&&(s=s.map((function(e){return i(e)}))),function(e,t){if(!j(e))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!(t instanceof HTMLCollection||u(t)))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=O(e)?e:document.createDocumentFragment();Array.from(t).forEach((function(e){var t;f(e)||i.appendChild(j(e)?e:(t=e.toString(),document.createTextNode(t.toString())))})),e!==i&&e.appendChild(i)}(e,s),e}function be(e,t){var i=n(t,document);return p(e)?null:O(i)?i.querySelector(e):function(e){return/^#[a-zA-Z0-9_-]+$/.test(e)}(e)?document.getElementById(e.substring(1)):function(e){return/^\.[a-zA-Z0-9_-]+$/.test(e)}(e)?i.getElementsByClassName(e.substring(1))[0]:i.querySelector(e)}function ve(e,t,i){if(!x(t))return null;var s=t[e];if(o(i))for(;L(s)&&!i(s);)s=s[e];return s}function ge(e,t,i){if(!L(e))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!o(t))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var s=e.parentElement;return i>0?Ee(s,t,i-1):ye(s,t)}function ye(e,t){return f(e)?null:t(e)?e:ye(e.parentElement,t)}function Ee(e,t,i){return f(e)||0===i?null:t(e)?e:Ee(e.parentElement,t,i-1)}function we(e,t){if(!j(e))throw new TypeError("Bad argument: The given `node` is not a valid Node");return o(t)?(Array.from(e.childNodes).forEach((function(i){t(i)&&e.removeChild(i)})),e):function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}(e)}ve.bind(null,"previousElementSibling"),ve.bind(null,"nextElementSibling");var Ce=function(e){return e.dataset.state},je=function(e,t){return e.dataset.state=t},Le=function(e,t){return je(e,n(t,"checked"))},xe=function(e,t){return je(e,n(t,"unchecked"))},Te={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return d(this.selectedItem)&&!d(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("change",(function(t){var i=t.target,s=!1;if(o(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),s)return i.checked=!1,void e.items[e.selectedIndex].setChecked(!0);var r=e.items.find((function(e){return e.index===+n(i.dataset.selectorIndex,-1)}));f(r)||(e.setSelectedItem(r),o(e.afterChange)&&e.afterChange(e,t))}))}},Oe=function(e){return'[data-type="'.concat(e.name,'"]')},Ae={BaseSelector:Oe({name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return d(this.selectedItem)&&!d(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=t.target;if(v(i.dataset,"selector")){var s=!1;if(o(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),!s){var r=e.items.find((function(e){return e.index===+n(i.dataset.selectorIndex,-1)}));f(r)||(e.setSelectedItem(r),o(e.afterChange)&&e.afterChange(e,t))}}}))}}),FormSelector:Oe(Te)};new Error("Missing container: A selector requires a container"),new Error("Missing input: FormSelector requires an input in the container"),[Ae.BaseSelector,Ae.FormSelector].join(","),new Error("Missing container: A switch requires a container"),new Error("Missing input: FormSwitch requires an input in the container");var _e="on",Ve=function(e){return'[data-type="'.concat(e.name,'"]')},Se={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return Ce(this.container)===_e},setChecked:function(e){return!f(e)&&(this.input.checked=e,e?Le(this.container,_e):xe(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var e=this;this.input.addEventListener("change",(function(t){var i=!1;o(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i?e.input.checked=!e.input.checked:(e.toggle(),o(e.afterChange)&&e.afterChange(e,t))}))}};function Re(e){let t=0;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t}[Ve({name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return Ce(this.container)===_e},setChecked:function(e){return!f(e)&&(e?Le(this.container,_e):xe(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.isChecked()&&Le(this.container,_e),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=!1;o(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i||(e.toggle(),o(e.afterChange)&&e.afterChange(e,t))}))}}),Ve(Se)].join(","),new Error("Missing container: A collapsible requires a container"),new Error("Missing container: An accordion requires a container"),encodeURIComponent;const Me="hidden",ke="collapsed",Ie="shake";function Ne(e){return x(e)&&e.classList.remove(Me),e}function He(e){return x(e)&&e.classList.add(Me),e}function Pe(e){return x(e)&&e.classList.toggle(Me),e}const $e=e=>{e.classList.contains(Ie)||(e.classList.add(Ie),setTimeout((()=>{e.classList.remove(Ie)}),1e3))},De="Backspace",Be="Enter",Fe="Control",ze="Escape",qe="ArrowUp",We="ArrowRight",Ue="ArrowDown",Je="Delete",Ge={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},Ke="error",Ye="model";function Ze(e){if(!x)throw new TypeError("Bad parameter");return e.hidden||"none"===window.getComputedStyle(e).display}const Xe=e=>+e.substring(0,e.indexOf("px")),Qe={top:e=>e.marginTop,right:e=>e.marginRight,bottom:e=>e.marginBottom,left:e=>e.marginLeft},et={top:e=>e.paddingTop,right:e=>e.paddingRight,bottom:e=>e.paddingBottom,left:e=>e.paddingLeft},tt={top:e=>e.borderTopWidth,right:e=>e.borderRightWidth,bottom:e=>e.borderBottomWidth,left:e=>e.borderLeftWidth};function it(e,t,i){const s=window.getComputedStyle(e),n=window.getComputedStyle(t),r=Qe[i](s),a=et[i](n),l=tt[i](n);return o=e.getBoundingClientRect()[i]+Xe(r),c=t.getBoundingClientRect()[i]-Xe(a)-Xe(l),Math.abs(o-c)<2;var o,c}function st(e){for(let t=0;t<e.children.length;t++){const i=e.children[t];if(!Ze(i))return i}return null}function nt(e,t,i,s){return"up"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&it(e,t,"top"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{bottom:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n>=c-1&&(u<l||u===l&&d<o)&&(a=i,l=u,o=d)}return a}(e,i,s):"down"===t?function(e,t,i=!0){const s=t.children,{bottom:n,left:r}=e.getBoundingClientRect();if(i&&it(e,t,"bottom"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n<=c+1&&(u<l||u===l&&d<o)&&(a=i,l=u,o=d)}return a}(e,i,s):"left"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&it(e,t,"left"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{top:c,right:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r>=h-1&&(d<o||d===o&&u<l)&&(a=i,l=u,o=d)}return a}(e,i,s):"right"===t?function(e,t,i=!0){const s=t.children,{top:n,right:r}=e.getBoundingClientRect();if(i&&it(e,t,"right"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r<=h+1&&(d<o||d===o&&u<l)&&(a=i,l=u,o=d)}return a}(e,i,s):(console.error("unknown direction",t),null)}function rt(e){const t=e.children,{top:i,left:s}=e.getBoundingClientRect();if(0===t.length)return null;let n=null,r=99999,a=99999;for(let e=0;e<t.length;e++){const l=t[e];if(Ze(l)||l.classList.contains("badge"))continue;const{top:o,left:c}=l.getBoundingClientRect();let h=Math.abs(i-o),u=Math.abs(s-c);i<=o+1&&(h<r||h===r&&u<a)&&(n=l,r=h,a=u)}return n}function at(e){const t=e.children,{top:i,left:s}=e.getBoundingClientRect();if(0===t.length)return null;let n=null,r=99999,a=99999;for(let e=0;e<t.length;e++){const l=t[e];if(Ze(l)||l.classList.contains("badge"))continue;const{top:o,left:c}=l.getBoundingClientRect();let h=Math.abs(i-o),u=Math.abs(s-c);s<=c+1&&(u<a||u===a&&h<r)&&(n=l,r=h,a=u)}return n}function lt(e){const t=e.children,{top:i,right:s}=e.getBoundingClientRect();if(0===t.length)return null;let n=null,r=99999,a=99999;for(let e=0;e<t.length;e++){const l=t[e];if(Ze(l)||l.classList.contains("badge"))continue;const{top:o,right:c}=l.getBoundingClientRect();let h=Math.abs(i-o),u=Math.abs(s-c);s>=c-1&&(u<a||u===a&&h<r)&&(n=l,r=h,a=u)}return n}function ot(e){const t=e.children,{bottom:i,left:s}=e.getBoundingClientRect();if(0===t.length)return null;let n=null,r=99999,a=99999;for(let e=0;e<t.length;e++){const l=t[e];if(Ze(l)||l.classList.contains("badge"))continue;const{bottom:o,left:c}=l.getBoundingClientRect();let h=Math.abs(i-o),u=Math.abs(s-c);i>=o-1&&(h<r||h===r&&u<a)&&(n=l,r=h,a=u)}return n}var ct={};const ht=function(e,t){if(!o(t))return!1;ct[e]=ct[e]||[],ct[e].push(t)},ut=function(e,t){v(ct,e)&&ct[e].forEach((function(e){e(t)}))},dt=function(){var e={},t=[];for(let e=0;e<256;e++)t[e]=e<16?"0"+e.toString(16):e.toString(16);return e.generate=function(){var e=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,s=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]},e}(),pt="content",mt="name",ft="style",bt="prototype",vt="tags",gt=(e,t)=>e.getAttributeByName(t).target,yt=(e,t,i=!1)=>gt(e,t).getValue(i),Et=(e,t)=>gt(e,t).hasValue(),wt=(e,t)=>e.isAttributeCreated(t),Ct=e=>yt(e,mt).toLowerCase(),jt={projection:function(e){const t=[],i=wt(e,vt)?gt(e,vt).build():[],s=Tt.call(this,gt(e,"concept"));if(r(Object.keys(s))&&t.push("The projection is missing a <<concept>>."),Et(e,pt)||t.push("The projection is missing a <<content>>."),!r(t))return{success:!1,message:"Validation failed: The projection could not be built.",errors:t};const n=yt(e,pt),a=n.getProperty("contentType");let l={id:e.id,concept:s,type:a,tags:i,content:Lt[a].call(this,n),metadata:JSON.stringify(e.export())};return wt(e,mt)&&Et(e,mt)&&(l.name=Ct(e)),{success:!0,message:l}},template:function(e){const t=[],i=Ct(e);if(p(i)&&t.push("The template is missing a name."),Et(e,pt)||t.push("The template is missing a content."),!r(t))return{success:!1,message:"Validation failed: The template could not be built.",errors:t};const s=[];return yt(e,pt).filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();s.push(At.call(this,t))})),{success:!0,message:{id:e.id,type:"template",name:i,content:s}}},style:function(e){const t=[],i=Ct(e);if(p(i)&&t.push("The style rule is missing a name."),Et(e,ft)||t.push("The style rule is missing a rule."),!r(t))return{success:!1,message:"Validation failed: The style rule could not be built.",errors:t};const s=kt.call(this,gt(e,ft));return{success:!0,message:{id:e.id,type:"style",name:i,style:s}}}},Lt={layout:Ot,field:Vt};function xt(e,t={}){const i=[],s=[];this.logs.clear();const a=Object.assign({name:"projection",download:!0},t),l=e.getConcepts(["projection","template","style rule"]);return r(l)?(this.notify("<strong>Empty model</strong>: There was no projection found to be built.",Ge.WARNING,2e3),!1):(l.forEach((t=>{const r=jt[n(t.getProperty("handler"),"")];if(!o(r))throw new Error("The projection's is missing a build handler.");const{success:a,errors:l,message:c}=r.call(e,t);a?i.push(c):s.push(...l)})),r(s)?(this.notify("The projection model was <strong>successfully</strong> built",Ge.SUCCESS,2e3),a.download&&this.download(i,a.name),console.log(i),i):(this.notify("<strong>Validation failed</strong>: The model could not be built.<br> <em>See Log for more details</em>.",Ge.ERROR),this.logs.add(s,"Validation error",Ke),!1))}function Tt(e){const t={};return wt(e,mt)&&Et(e,mt)&&(t.name=yt(e,mt).toLowerCase()),wt(e,bt)&&Et(e,bt)&&(t.prototype=yt(e,bt).toLowerCase()),t}function Ot(e){const t=e.getProperty("elementType");var i={type:t},s=[];return"stack"===t?(i.orientation=yt(e,"orientation"),yt(e,"elements").filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();s.push(At.call(this,t))}))):"flex"===t?(i.orientation=yt(e,"orientation"),i.wrappable=yt(e,"wrappable"),i.alignItems=yt(e,"align-items"),i.justifyContent=yt(e,"justify-content"),yt(e,"elements").filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();s.push(At.call(this,t))}))):"wrap"===t?yt(e,"elements").filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();s.push(At.call(this,t))})):"cell"===t&&(i.type="table",i.orientation=yt(e,"orientation"),yt(e,"rows").forEach((e=>{const t=[];yt(e,"cells").forEach((e=>{let i=yt(e,"span"),s=yt(e,"content");t.push({type:"cell",span:i,content:At.call(this,s)})})),s.push(t)}))),wt(e,"style")&&(i.style=Mt.call(this,gt(e,"style"))),i.disposition=s,i}function At(e){const t=e.getProperty("contentType"),i=e.getProperty("elementType");if("static"===t)return{type:t,static:_t.call(this,e,i)};if("attribute"===t){let i={type:t,name:yt(e,"value")};if(wt(e,"tag")&&(i.tag=yt(e,"tag")),wt(e,"placeholder")){const t=[];yt(e,"placeholder").filter((e=>e.hasValue())).forEach((e=>{const i=e.getValue();t.push(At.call(this,i))})),i.placeholder=t}return i}if("projection"===t){let i={type:t,src:"value"};if(wt(e,"tag")&&(i.tag=yt(e,"tag")),wt(e,"placeholder")){const t=[];yt(e,"placeholder").filter((e=>e.hasValue())).forEach((e=>{const i=e.getValue();t.push(At.call(this,i))})),i.placeholder=t}return i}return"layout"===t?{type:t,layout:Ot.call(this,e)}:"field"===t?{type:t,field:Vt.call(this,e)}:"template"===t?{type:t,name:(s=e,n="value",Ct(((e,t)=>gt(e,t).getReference())(s,n)))}:null;var s,n}function _t(e,t){let i={type:t};return"text"===t?(i.content=yt(e,"content"),i.contentType=yt(e,"content type")):"image"===t?(i.url=yt(e,"url"),i.alt=yt(e,"alternative text"),i.width=yt(e,"width"),i.height=yt(e,"height")):"html"===t?i.selector=yt(e,"selector"):"link"===t?(i.url=yt(e,"url"),i.urlType=yt(e,"url type"),i.content=[],yt(e,"content").filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();i.content.push(At.call(this,t))}))):"plink"===t&&(i.tag=yt(e,"tag"),i.content=[],yt(e,"content").filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();i.content.push(At.call(this,t))}))),wt(e,"style")&&(i.style=Mt.call(this,gt(e,"style"))),i}function Vt(e){const t=e.getProperty("elementType");var i={type:t,readonly:yt(e,"readonly"),disabled:yt(e,"disabled")};if("text"===t)i.multiline=yt(e,"multiline"),i.resizable=yt(e,"resizable"),wt(e,"input")&&(i.input=St.call(this,gt(e,"input")));else if("binary"===t)i.state={true:{content:yt(e,"true-state").filter((e=>e.hasValue())).map((e=>At.call(this,e.getValue())))},false:{content:yt(e,"false-state").filter((e=>e.hasValue())).map((e=>At.call(this,e.getValue())))}};else if("choice"===t)i.choice={},wt(e,"choice template")&&(i.choice.option={template:Rt.call(this,gt(e,"choice template"))});else if("list"===t){if(i.list={},wt(e,"item template")&&(i.list.item={template:Rt.call(this,gt(e,"item template"))}),wt(e,"action")){let t=gt(e,"action");if(i.action={},wt(t,"add")){let e=gt(t,"add");i.action.add={};const s=[];yt(e,pt).filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();s.push(At.call(this,t))})),i.action.add.content=s}if(wt(t,"remove")){let e=gt(t,"remove");i.action.remove={};const s=[];yt(e,pt).filter((e=>e.hasValue())).forEach((e=>{const t=e.getValue();s.push(At.call(this,t))})),i.action.remove.content=s}}}else"table"===t&&(i.type="table",i.table={},wt(e,"row template")&&(i.table.row={template:Rt.call(this,gt(e,"row template"))}),wt(e,"header")&&(i.header=Mt.call(this,gt(e,"header"))),wt(e,"body")&&(i.body=Mt.call(this,gt(e,"body"))),wt(e,"footer")&&(i.footer=Mt.call(this,gt(e,"footer"))));return wt(e,"style")&&(i.style=Mt.call(this,gt(e,"style"))),i}function St(e){let t={type:yt(e,"type"),placeholder:yt(e,"placeholder")};return wt(e,"style")&&(t.style=Mt.call(this,gt(e,"style"))),t}function Rt(e){let t={tag:yt(e,"tag"),name:yt(e,"name")};return wt(e,"style")&&(t.style=Mt.call(this,gt(e,"style"))),t}function Mt(e){let t={};return wt(e,"css")&&(t.css=gt(e,"css").build()),wt(e,"ref")&&(t.ref=yt(e,"ref",!0).map((e=>Ct(this.getConcept(e))))),wt(e,"gss")&&(t.gss=kt.call(this,gt(e,"gss"))),t}function kt(e){let t={};return wt(e,"text")&&(t.text=It.call(this,gt(e,"text"))),wt(e,"box")&&(t.box=Nt.call(this,gt(e,"box"))),t}function It(e){let t={};return wt(e,"bold")&&(t.bold=yt(e,"bold")),wt(e,"italic")&&(t.italic=yt(e,"italic")),wt(e,"underline")&&(t.underline=yt(e,"underline")),wt(e,"strikethrough")&&(t.strikethrough=yt(e,"strikethrough")),wt(e,"colour")&&Et(e,"colour")&&(t.color=Pt.call(this,yt(e,"colour"))),wt(e,"opacity")&&Et(e,"opacity")&&(t.opacity=yt(e,"opacity")),wt(e,"size")&&(t.size=$t.call(this,gt(e,"size"))),wt(e,"font")&&Et(e,"font")&&(t.font=gt(e,"font").build()),wt(e,"alignment")&&Et(e,"alignment")&&(t.alignment=yt(e,"alignment")),t}function Nt(e){let t={};return wt(e,"inner space")&&(t.inner=Ht.call(this,gt(e,"inner space"))),wt(e,"outer space")&&(t.outer=Ht.call(this,gt(e,"outer space"))),wt(e,"background")&&Et(e,"background")&&(t.background=Pt.call(this,yt(e,"background"))),wt(e,"width")&&(t.width=$t.call(this,gt(e,"width"))),wt(e,"height")&&(t.height=$t.call(this,gt(e,"height"))),wt(e,"opacity")&&Et(e,"opacity")&&(t.opacity=yt(e,"opacity")),t}function Ht(e){let t={};return["top","right","bottom","left"].forEach((i=>{wt(e,i)&&(t[i]=$t.call(this,gt(e,i)))})),t}function Pt(e){let t={};return"name colour"===e.name?(t.type="name",t.value=yt(e,"value")):"rgb colour"===e.name&&(t.type="rgb",t.value={red:yt(e,"red"),green:yt(e,"green"),blue:yt(e,"blue")}),t}function $t(e){return{value:yt(e,"value"),unit:yt(e,"unit")}}const Dt="attributes",Bt="base",Ft="required",zt="properties",qt="prototype",Wt=(e,t)=>e.getAttributeByName(t).target,Ut=(e,t)=>Wt(e,t).getReference(),Jt=(e,t,i=!1)=>Wt(e,t).getValue(i),Gt=(e,t)=>Wt(e,t).hasValue(),Kt=(e,t)=>e.isAttributeCreated(t),Yt=e=>Jt(e,"name").toLowerCase(),Zt=e=>Jt(e,"description");function Xt(e,t={}){const i=[],s=[];this.logs.clear();const n=Object.assign({name:"metamodel",download:!0},t),a=e.getConcepts(["prototype concept","concrete concept","derivative concept"]);return r(a)?(this.notify("<strong>Empty model</strong>: There was no concept found to be built.",Ge.WARNING),!1):(a.forEach((t=>{const{success:n,errors:r,message:a}=Qt.call(e,t);n?i.find((e=>e.name===a.name))?s.push(`The model has two concepts with the same name: ${a.name}`):i.push(a):s.push(...r)})),r(s)?(this.notify("The concept model was <strong>successfully</strong> built",Ge.SUCCESS,2e3),n.download&&this.download(i,n.name),console.log(i),i):(this.notify("<strong>Validation failed</strong>: The model could not be built.<br> <em>See Log for more details</em>.",Ge.ERROR),this.logs.add(s,"Validation error",Ke),!1))}function Qt(e){const t=[],i=Yt(e),s=Zt(e),n=e.getProperty("nature"),a=[],l=[];if(p(i)&&t.push(`The ${n} concept's <<name>> is missing a value.`),e.isAttributeCreated(Dt)&&Jt(e,Dt).forEach((e=>{const{success:i,errors:s,message:n}=ei.call(this,e);i?a.find((e=>e.name===n.name))?t.push(`The concept has two attributes with the same name: ${n.name}`):a.push(n):t.push(...s)})),e.isAttributeCreated(zt)&&Jt(e,zt).forEach((e=>{const{success:i,errors:s,message:n}=si.call(this,e);i?l.find((e=>e.name===n.name))?t.push(`The concept has two properties with the same name: ${n.name}`):l.push(n):t.push(...s)})),!r(t))return{success:!1,message:"Validation failed: The concept could not be built.",errors:t};let o={id:e.id,name:i,description:s,nature:n,attributes:a,properties:l,metadata:JSON.stringify(e.export())};return e.isAttributeCreated(qt)&&Gt(e,qt)&&(o.prototype=Yt(Ut(e,qt))),e.isAttributeCreated(Bt)&&Gt(e,Bt)&&(o.base=ti.call(this,Jt(e,Bt))),{success:!0,message:o}}function ei(e){const t=Yt(e),i=Zt(e),s=!Kt(e,Ft)||!Gt(e,Ft)||Jt(e,Ft),n=[];return p(t)&&n.push("The attribute's <<name>> is missing a value."),Kt(e,"target")&&Gt(e,"target")||n.push(`Attribute ${p(t)?"N/A":`'${t}'`}: <<target>> is missing a value.`),r(n)?{success:!0,message:{name:t,target:ti.call(this,Jt(e,"target")),required:s,description:i}}:{success:!1,message:"Validation failed: The attribute could not be built.",errors:n}}function ti(e){let t=e.getProperty("cname");"concept"===t&&(t=Yt(Ut(e,"concept")));const i={name:t};if(Kt(e,"accept")){let t=Jt(e,"accept");c(t)?i.accept=ti.call(this,t):i.accept={name:t}}return["default","rel"].filter((t=>Kt(e,t)&&Gt(e,t))).forEach((t=>{i[t]=Jt(e,t)})),Kt(e,"constraint")&&(i.constraint=ii.call(this,Wt(e,"constraint"))),i}function ii(e){const t={};return Kt(e,"scope")&&Gt(e,"scope")&&(t.scope=Yt(Ut(e,"scope"))),["ordered","pattern"].filter((t=>Kt(e,t)&&Gt(e,t))).forEach((i=>{t[i]=Jt(e,i)})),["length","value","cardinality"].filter((t=>Kt(e,t)&&Gt(e,t))).forEach((i=>{let s=Jt(e,i),n={};if("number constraint value"===s.name){let e={};Gt(s,"value")&&(e.value=Jt(s,"value")),n.type="fixed",n.fixed=e}else if("number constraint range"===s.name){let e={},t=Wt(s,"min");Gt(t,"value")&&(e.min={value:Jt(t,"value")});let i=Wt(s,"max");Gt(i,"value")&&(e.max={value:Jt(i,"value")}),n.type="range",n.range=e}t[i]=n})),Kt(e,"values")&&Gt(e,"values")&&(t.values=Jt(e,"values",!0)),t}function si(e){const t=[],i=Yt(e),s=Zt(e);if(p(i)&&t.push("The property's 'name' is missing a value."),Kt(e,"target")&&Gt(e,"target")||t.push(`Property ${p(i)?"N/A":`'${i}'`}: <<target>> is missing a value.`),!r(t))return{success:!1,message:"Validation failed: The property could not be built.",errors:t};const n=Jt(e,"target"),a=n.getProperty("type");return f(a)&&t.push(`The property '${i}' target's type is missing a value.`),r(t)?{success:!0,message:{name:Yt(e),type:a,value:Jt(n,"value"),description:s}}:{success:!1,message:"Validation failed: The property could not be built.",errors:t}}const ni={create(e,t){const i=Object.create(this);return i.concept=e,i.schema=t,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(e){throw new Error("This function has not been implemented")}};Object.defineProperty(ni,"model",{get(){return this.concept.model}}),Object.defineProperty(ni,"alias",{get(){return this.schema.alias}}),Object.defineProperty(ni,"name",{get(){return this.schema.name}}),Object.defineProperty(ni,"description",{get(){return this.schema.description}}),Object.defineProperty(ni,"required",{get(){return n(this.schema.required,!0)}});const ri={object:"attribute",target:null,init(e){return this.target=this.model.createConcept(this.schema.target,{value:n(e,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.value},hasValue(){return this.target.hasValue()},copy(){if(!this.target.hasValue())return null;const{nature:e}=this.target;let t={name:this.target.name},i=this.target.exportValue();return"primitive"===e?t.value=i:"prototype"===e&&this.target.hasValue()?t.value={name:this.target.value.name,attributes:i}:t.attributes=i,t},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}}},ai=Object.assign(Object.create(ni),ri),li={attributes:null,initAttribute(){return this.attributes=[],this.attributes._created=new Set,this.attributes._updated=new Set,this.attributes._deleted=new Set,this},getAttributes(){return this.attributes},getAttribute(e){if(f(e))throw new TypeError("Bad argument");return"id"===e.type?this.getAttributeById(e.value):this.getAttributeByName(e)},getAttributeSchema(e){if(p(e))throw new TypeError("Bad argument");if(!this.hasAttribute(e))throw new Error(`Attribute '${e}' does not exist`);return g(this.attributeSchema.find((t=>t.name===e)))},getAttributeByName(e){if(p(e))throw new TypeError("Bad argument");var t=this.attributes.find((t=>t.name===e));return f(t)&&(t=this.createAttribute(e)),t},getAttributeById(e){if(p(e))throw new TypeError("Bad argument");return this.attributes.find((t=>t.id===e))},createAttribute(e,t){if(!this.hasAttribute(e))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${e}'`);if(this.isAttributeCreated(e)){let i=this.getAttributeByName(e);return t&&i.target.initValue(t),i}const i=this.getAttributeSchema(e);let s=this.model.getValue(t);var n=ai.create(this,i).init(s);return this.addAttribute(n),n},addAttribute(e){if(f(e)||"attribute"!==e.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(e),this.attributes._created.add(e.name),this.notify("attribute.added",e),this},hasAttributes(){return!r(this.attributeSchema)||!r(this.attributes)},hasAttribute(e){return-1!==this.attributeSchema.findIndex((t=>t.name===e))},isAttributeRequired(e){return n(this.getAttributeSchema(e).required,!0)},isAttributeCreated(e){return this.attributes._created.has(e)},listAttributes(){const e=[];return this.attributeSchema.forEach((t=>{e.push({type:"attribute",name:t.name,alias:t.alias,description:t.description,target:t.target,accept:t.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),e},removeAttribute(e){if(this.isAttributeRequired(e))return{message:`The attribute '${e}' is required.`,success:!1};var t=this.attributes.findIndex((t=>t.name===e));if(-1===t)return{message:`The attribute '${e}' was not found.`,success:!1};var i=this.attributes.splice(t,1)[0];return this.attributes._created.delete(e),this.notify("attribute.removed",i),{message:`The attribute '${e}' was successfully removed.`,success:!0}}},oi={listeners:null,initObserver(){return this.listeners=[],this},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){var t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t)}))}},ci={model:null,schema:null,source:null,id:null,name:null,description:null,alias:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,value:null,values:null,action:null,shadows:null,history:null,kind:"concept",init(e={}){return this.accept=e.accept,this.parent=e.parent,this.ref=e.ref,this.default=n(this.schema.default,null),this.values=n(e.values,n(this.schema.values,[])),this.alias=n(e.alias,this.schema.alias),this.description=n(e.description,this.schema.description),this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getAlias(){return n(this.alias,this.getName())},getAcceptedValues(){return!h(this.accept)&&f(this.accept.name)?"":l(this.accept)?this.accept:v(this.accept,"name")?this.accept.name:Array.isArray(this.accept)?this.accept.map((e=>this.getAcceptedValues.call({accept:e}))).join(" or "):void 0},getCandidates(){return this.values.forEach((e=>{c(e)&&(e.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},exportValue(){return this.getValue()},getBuildProperty(e){const{build:t}=this.schema;return f(t)||!v(t,e)?null:t[e]},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;let i=n(this.schema.properties,[]).find((t=>t.name===e));if(f(i))return;const{type:s,value:r}=i;return"string"===s?hi.call(this,r):"number"===s?+r:"boolean"===s?w(r):r},getConstraint(e){if(this.hasConstraint(e))return this.constraint[e]},hasConstraint(e){return!f(this.constraint)&&(!!f(e)||v(this.constraint,e))},hasParent(){return!this.isRoot()},getParent(e){if(this.isRoot())return null;if(p(e))return this.parent;const t=this.parent;return t.name===e?t:t.getParent(e)},getParentWith(e){if(this.isRoot())return null;if(p(e))return this.parent;const t=this.parent;return t.hasPrototype(e)?t:t.getParentWith(e)},hasPrototype(e){if(f(this.schema.prototype))return!1;let t=this.model.getConceptSchema(this.schema.prototype);for(;!f(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1},getAncestor(e){const t=[];for(var i=this.getParent(e);i;)t.push(i),i=i.getParent(e);return t},getChildren(e){const t=[];return f(e)?this.getAttributes().forEach((e=>{t.push(e.target)})):this.getAttributes().forEach((i=>{i.target.name===e?t.push(i.target):t.push(...i.target.getChildren(e))})),t},getDescendant(e){const t=[];return this.getChildren(e).forEach((i=>{t.push(i),t.push(...i.getDescendant(e))})),t},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}this.getChildren().forEach((e=>{e.delete(!0)}));try{this.model.removeConcept(this.id)&&this.notify("delete")}catch(e){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},isRoot(){return f(this.parent)},copy(e=!0){var t={name:this.name,nature:this.nature},i=[];return this.getAttributes().forEach((e=>{i.push({name:e.name,value:e.copy(!1)})})),t.attributes=i,e&&this.model.addValue(t),t},paste(e){this.initValue(e)},export(){var e={id:this.id,root:this.isRoot(),name:this.name},t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.export()})})),e.attributes=t,e},toString(){var e={};return this.attributes.forEach((t=>{Object.assign(e,t.toString())})),e}};function hi(e){if(l(e))return e;const{type:t}=e;switch(t){case"concat":return di.call(this,e.concat)}}function ui(e,t){const{type:i}=e;return"string"===i?hi.call(this,e.value):"property"===i?this.getProperty(e.name):t||e}function di(e,t=""){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");return e.length<2?ui.call(this,e[0]):e.map((e=>ui.call(this,e))).join(t)}const pi=Object.assign(ci,oi,li);Object.defineProperty(pi,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(pi,"_prototype",{get(){return this.schema.prototype}});function mi(e){switch(e){case 400:return{success:!1,message:"The value is not a boolean."};case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const fi={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.alias=this.schema.alias,this.default=n(this.schema.default,!0),this.description=this.schema.description,this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if(f(e))return this.value=this.default,this;if(c(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return!f(this.value)},getValue(){return this.value},setValue(e){var t=this.validate(e);return 200!==t?{success:!1,message:"Validation failed: The value could not be updated.",errors:[mi(t).message]}:(this.value=w(e),this.notify("value.changed",e),{success:!0,message:"The value has been successfully updated."})},update:(e,t)=>!0,getCandidates:()=>[!0,!1],getChildren:e=>[],validate:e=>l(e)&&["true","false"].includes(e.toLowerCase())||Number.isInteger(e)&&[1,0].includes(e)||[!0,!1].includes(e)?200:400,build(){return this.getValue()},copy(){var e={name:this.name,nature:this.nature,value:this.getValue()};return this.model.addValue(e),e},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value}},bi=Object.assign(Object.create(pi),fi);function vi(e){let t=this.constraint.value;switch(e){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:"The value is not included in the list of valid values."};case 403:return{success:!1,message:`The value is greater than the maximum allowed: ${t.max.value}.`};case 402:return{success:!1,message:`The value is less than the minimum allowed: ${t.min.value}.`};case 404:return{success:!1,message:`The value is different from the value allowed: ${t.value}.`}}}const gi={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.values=n(this.schema.values,[]),this.default=n(this.schema.default,null),this.alias=this.schema.alias,this.description=this.schema.description,this.constraint={},this.constraint.value=this.schema.value,this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if(f(e))return this.value=this.default,this;if(c(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(e){var t=this.validate(e);return 200!==t?{success:!1,message:"Validation failed: The value could not be updated.",errors:[vi.call(this,t).message]}:(p(e)?this.value=null:this.value=+e,this.notify("value.changed",e),{success:!0,message:"The value has been successfully updated."})},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getCandidates(){return this.values.forEach((e=>{c(e)&&(e.type="value")})),this.values},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(isNaN(e))return 400;let t=this.constraint.value;if(t){const{min:i,max:s}=t;if(t.value&&e!==t.value)return 404;if(i){if(i.included&&e<i.value)return 402;if(!i.included&&e<=i.value)return 402}if(s){if(s.included&&e>s.value)return 403;if(!s.included&&e>=s.value)return 403}}if(p(e)||r(this.values))return 200;var i=!1;for(let t=0;!i&&t<this.values.length;t++){const s=this.values[t];i=c(s)?s.value==e:s==e}return i?200:401},build(){return this.getValue()},copy(e=!0){if(!this.hasValue())return null;var t={name:this.name,nature:this.nature,root:this.isRoot(),value:this.getValue()};return e&&this.model.addValue(t),t},export(){return{name:this.name,value:this.getValue()}},toString(){return this.value}},yi=Object.assign(Object.create(pi),gi);function Ei(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const wi={nature:"primitive",reference:null,path:null,init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=n(this.schema.values,[]),this.alias=this.schema.alias,this.description=this.schema.description,this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){return f(e)||this.setValue(e.value),this},hasValue(){return!p(this.value)},getValue(e=!1){return f(this.value)?null:e?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return f(this.reference)?null:this.reference},setValue(e){let t=c(e)?e.id:e;var i=this.validate(t);return 200!==i?{success:!1,message:"Validation failed: The value could not be updated.",errors:[Ei(i).message]}:f(t)||this.value===t?void 0:(this.reference&&this.reference.unregister(this),this.value=t,this.reference=this.model.getConcept(t),f(this.reference)?setTimeout((()=>{this.reference=this.model.getConcept(t),this.reference.register(this),this.notify("value.changed",this.reference)}),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if(f(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var e=Ci.call(this,this.accept);return this.path&&ji(this,this.path).map((e=>({type:this.accept.type,value:e}))),e},getChildren(e){return f(this.reference)||e&&this.reference.name!==e?[]:[this.reference]},delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return p(e)||r(this.values),200},build(){return this.getValue()},copy(e=!0){var t={name:this.name,nature:this.nature,accept:this.accept,value:this.getValue()};return e&&this.model.addValue(t),t},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}};function Ci(e){const{name:t,scope:i,rel:s}=e;return"parent"===s?this.getParent(i).getChildren(t):this.model.isPrototype(t)?this.model.getConceptsByPrototype(t):this.model.getConcepts(t)}function ji(e,t){if(f(t))return e;const{target:i,value:s,rel:n}=t;var r=[];return"parent"===n?r.push(e.getParentWith(i)):"children"===n?r.push(...e.getChildren(i)):"property"===n&&r.push(e.getProperty(i)),r.map((e=>ji(e,s))).flat()}const Li=Object.assign({},pi,wi),xi={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.description=this.schema.description,this.constraint=this.schema.constraint,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if(this.removeAllElement(),f(e)){let e=n(Oi.call(this),0);for(let t=0;t<e;t++)this.createElement();return this}const{id:t="",name:i,value:s}=e;t.length>10&&(this.id=t);for(let e=0;e<s.length;e++)this.createElement(s[e]);let r=n(Oi.call(this),0)-s.length;for(let e=0;e<r;e++)this.createElement();return this},hasValue(){return!r(this.value)},getValue(e=!1){const t=this.value.map((e=>this.model.getConcept(e)));return e?t.map((e=>e.getValue())):t},exportValue(){return this.value.map((e=>this.model.getConcept(e))).map((e=>{let t={name:e.name};const{nature:i}=e;let s=e.exportValue();return"primitive"===i?t.value=s:"prototype"===i&&e.hasValue()?t.value={name:e.value.name,attributes:s}:t.attributes=s,t}))},setValue(e){if(Array.isArray(e)){this.removeAllElement();for(let t=0;t<e.length;t++)this.createElement(e[t]);this.notify("value.changed",e)}},getElements(){return this.value.map((e=>this.model.getConcept(e)))},getElement(e){var t=this.value.find((t=>t===e));if(!f(t))return this.model.getConcept(t)},getElementAt(e){if(!(e<0||e>=this.value.length))return this.model.getConcept(this.value[e])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(e){return!f(e)&&(this.value.push(e.id),e.index=this.value.length-1,this.notify("value.added",e),!0)},addElementAt(e,t=0){return f(e)&&(e=this.createElement()),this.value.splice(t,0,e.id),this},removeElement(e){let t=this.value.indexOf(e.id);return-1!==t&&this.removeElementAt(t)},removeElementAt(e){let t=n(Oi.call(this),0);if(this.value.length<=t)return{message:`The set needs at least ${t} element.`,success:!1};if(!Number.isInteger(e)||e<0)return{message:"The element was not removed. The given 'index' is not valid.",success:!1};let i=this.getElementAt(e);if(f(i))return{message:`The element at index '${e}' was not found.`,success:!1};i.delete(!0),this.value.splice(e,1);const s=this.getValue();for(let t=e;t<s.length;t++)s[t].index=t;return this.notify("value.removed",i),{message:`The element '${i.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((e=>{this.model.removeConcept(e)})),this.value=[],this.notify("value.changed",this.value),this},createElement(e){const t={value:this.model.getValue(e),parent:this,ref:this},i=this.model.createConcept(this.accept,t);return this.addElement(i),i},getCandidates(){return Ti.call(this,this.accept)},getChildren(e){if(!this.hasValue())return[];const t=this.getElements();return f(e)?t:t.filter((t=>t.name===e))},build(){return this.getValue().map((e=>e.build()))},copy(e=!0){const t={name:this.name,accept:this.accept,nature:this.nature,value:this.exportValue()};return e&&this.model.addValue(t),t},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}};function Ti(e){return this.model.getConceptSchema(e)}function Oi(){if(!this.hasConstraint("cardinality"))return null;const e=this.getConstraint("cardinality"),{type:t}=e;if("range"===t){const{min:i}=e[t];return i.value}if("fixed"===t){const{value:i}=e[t];return i}return null}const Ai=Object.assign(Object.create(pi),xi);Object.defineProperty(Ai,"count",{get(){return this.value.length}}),Object.defineProperty(Ai,"canAddValue",{get:()=>!0});const _i=200;function Vi(e,t){switch(e){case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum length: ${this.value.length}/${t.value}.`};case 402:return{success:!1,message:`Minimum length: ${this.value.length}/${t.value}.`};case 404:return{success:!1,message:`Fixed length: ${t.value}.`};case 405:return{success:!1,message:"The value is not valid."}}}const Si={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.default=n(this.schema.default,""),this.description=this.schema.description,this.constraint=this.schema.constraint,this.src=n(this.schema.src,[]),this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if(f(e))return this.value=this.default,this;if(c(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return!p(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(e){var{code:t,ctx:i}=this.validate(e);return this.value=e,t!==_i?{success:!1,message:"Validation failed: The value could not be updated.",errors:[Vi.call(this,t,i).message]}:(this.notify("value.changed",e),{success:!0,message:"The value has been successfully updated."})},getCandidates(){let e=n(this.getConstraint("values"),[]);return r(e)?[...new Set(this.model.getConcepts(this.name).filter((e=>e.hasValue()&&e.value!==this.value)).map((e=>e.getValue()))),...this.src]:e.map((e=>Ri.call(this,e))).flat().filter((e=>!p(e)))},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(p(e))return{code:_i};if(!this.hasConstraint())return{code:_i};if(this.hasConstraint("length")){let t=this.getConstraint("length");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&e.length<s.value)return{code:402,ctx:s};if(n&&e.length>n.value)return{code:403,ctx:n}}else if("fixed"===i){const{value:i}=t.fixed;if(e.length!==i)return{code:404,ctx:t.fixed}}}if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("pattern"===i){const{value:i}=t.pattern;if(!new RegExp(i,"gi").test(e))return{code:405,ctx:t.pattern}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>Ri.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const n=t[s];i=c(n)?n.value===e:n===e}if(!i)return{code:401,ctx:t}}return{code:_i}},build(){return this.getValue()},copy(e=!0){if(!this.hasValue())return null;var t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value}};function Ri(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}const Mi=Object.assign(Object.create(pi),Si),ki={nature:"concrete",initValue(e){if(f(e))return!1;const{id:t="",attributes:i=[]}=e;return t.length>10&&(this.id=t),i.forEach((e=>{const{name:t,id:i,value:s}=e;this.createAttribute(t,s)})),!0},hasValue:()=>!0,getValue(){return this.getAttributes().map((e=>({name:e.name,value:e.copy(!1)})))},build(){}},Ii=Object.assign(Object.create(pi),ki),Ni=200;function Hi(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const Pi={name:"prototype",nature:"prototype",initValue(e){if(f(e)){if(this.default){let e=this.createConcept(this.default);this.setValue(e)}return this}const{id:t,value:i,name:s}=e;if(i){let e=this.createConcept(i.name,i);this.setValue(e)}else if(s){let t=this.createConcept(s,e);this.setValue(t)}return this},getValue(){return this.value},exportValue(){return this.hasValue()?this.getValue().exportValue():null},setValue(e){let t=e,i=this.validate(t);if(i!==Ni)return{success:!1,message:"Validation failed: The value could not be updated.",errors:[Hi(i).message]};var s=t;return l(t)&&(s=this.createConcept(t),c(e)&&(s.id=e.id)),this.value&&this.value.delete(!0),this.target=s,this.value=s,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!f(this.value)},getCandidates(){return this.candidates||(this.candidates=$i.call(this,this.schema.accept).map((e=>({type:"meta-concept",name:e.name})))),this.candidates},getChildren(e){if(!this.hasValue())return[];const t=[],i=this.getValue();return(f(e)||i.name===e)&&t.push(i),t},getDescendant:e=>[],createConcept(e,t){let i=this.model.getValue(t);const s={parent:this,ref:this};i&&(s.value=i);const n=this.model.createConcept(e,s);return n.prototype=this,n},validate(e){if(p(e))return Ni;if(r(this.values))return Ni;var t=!1;for(let i=0;!t&&i<this.values.length;i++){const s=this.values[i];t=c(s)?s.value===e:s===e}return t?Ni:401},export(){let e=null;if(this.hasValue()){let t=this.getValue();e={id:t.id,name:t.name}}return{id:this.id,name:this.name,root:this.isRoot(),value:e}},copy(e=!0){var t={name:this.name,nature:this.nature};if(this.hasValue()){let e=this.getValue();t.value=e.copy(!1)}return e&&this.model.addValue(t),t}};function $i(e){const t=this.model.getConcreteConcepts(this.name);return f(e)?t:Array.isArray(e)?t.filter((t=>e.some((e=>e.name===t.name)))):t.filter((t=>e===t.name))}const Di=Object.assign({},pi,Pi);function Bi(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const Fi={name:"meta",reference:null,initValue(e){return f(e)||this.setValue(e.value),this},hasValue(){return!p(this.value)},getValue(){return f(this.value)?null:this.value},getProperty(e){const t=this.schema[e];if(c(t)){const e=[];for(const i in t){const s=t[i];e.push(Object.assign({},{name:i},s))}return e}return t},setValue(e){var t=this.validate(e);return 200!==t?{success:!1,message:"Validation failed: The value could not be updated.",errors:[Bi(t).message]}:f(e)||this.value===e?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(e),this.reference.register(this),this.value=e,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:e=>[],delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return p(e)||r(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}},zi=Object.assign({},pi,Fi);function qi(e,t){return{object:{value:"concept"},model:{value:e},name:{value:t.name},base:{value:t.base},schema:{value:t,writable:!0}}}const Wi={boolean:(e,t)=>Object.create(bi,qi(e,t)),number:(e,t)=>Object.create(yi,qi(e,t)),reference:(e,t)=>Object.create(Li,qi(e,t)),set:(e,t)=>Object.create(Ai,qi(e,t)),string:(e,t)=>Object.create(Mi,qi(e,t)),meta:(e,t)=>Object.create(zi,qi(e,t))},Ui={primitive:(e,t)=>Wi[t.name](e,t),prototype:(e,t)=>Object.create(Di,qi(e,t)),concrete:(e,t)=>Object.create(Ii,qi(e,t)),derivative:(e,t)=>Wi[t.base](e,t)},Ji={createConcept(e,t,i){const{name:s,nature:n}=t,r=Ui[n];if(f(r))throw new Error(`Missing handler: The '${s}' concept could not be handled`);const a=r(e,t);if(f(a))throw new Error(`Bad request: The '${s}' concept could not be created`);return a._createConcept=this.createConcept,a.init(i),f(a.id)&&(a.id=dt.generate()),a}};var Gi=0;const Ki={concepts:null,values:null,init(e){return this.concepts=[],this.values=[],Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})}))),this},done(){return this.concepts.forEach((e=>{e.unregisterAll()})),this.concepts=[],!0},createConcept(e,t){const i=this.getCompleteModelConcept(e);var s=Ji.createConcept(this,i,t);return this.addConcept(s),s},getConcepts(e){if(h(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.concepts.filter((e=>t(e)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((e=>e.isRoot()))},getConceptsByPrototype(e){return this.concepts.filter((t=>t.schema.prototype===e))},getConcept(e){if(!l(e)||r(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((t=>t.id===e))},addConcept(e){if(f(e))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(e),ut("concept.added",e),this},removeConcept(e){if(!c(e)&&!l(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.concepts.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.concepts.splice(t,1)[0];return ut("concept.removed",i),i},getValues(e){if(h(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.values.filter((e=>t(e)))}return this.values.slice()},getValue(e){return f(e)?null:v(e,"value")||v(e,"attributes")?e:v(e,"id")?this.values.find((t=>t.id===e.id)):this.values.find((t=>t.id===e))},addValue(e){if(f(e))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((t=>{return s=e,(i=t).name===s.name&&(i.value?i.value===s.value:JSON.stringify(i.attributes)===JSON.stringify(s.attributes));var i,s}))||(e.id="value"+Gi++,this.values.push(e),ut("value.added",e)),this},removeValue(e){if(!c(e)&&!l(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.values.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.values.splice(t,1)[0];return ut("value.removed",i),i},isConcept(e){return!!l(e)&&-1!==this.schema.findIndex((t=>t.name===e))},isConcrete(e){if(!l(e))return!1;const t=this.schema.find((t=>t.name===e));return!f(t)&&"concrete"===t.nature},isPrototype(e){if(!l(e))return!1;const t=this.schema.find((t=>t.name===e));return!f(t)&&"prototype"===t.nature},getSchema(e){if(h(e)){const t=Array.isArray(e)?t=>e.includes(t.nature):t=>t.nature===e;return this.schema.filter((e=>t(e)))}return this.schema.slice()},getConceptSchema(e){const t=Xi(this.schema,e);var i;if(!f(t))return i=t,JSON.parse(JSON.stringify(i))},getCompleteModelConcept(e){let t=e;l(e)&&(t={name:e});const i=this.getConceptSchema(t.name);if(f(i))return;Object.assign(i,t),v(i,"attributes")||(i.attributes=[]);const s=Yi.call(this,i.prototype);return i.attributes.push(...s.attributes),i},getConcreteConcepts(e){const t=t=>{for(var i=t.prototype;!f(i);){if(i===e)return!0;i=n(Xi(this.schema,i),{}).prototype}return!1},i=this.schema.filter((e=>"concrete"===e.nature));return e?i.filter((e=>t(e))):i},getDerivedConcepts(e){if(f(e))throw new TypeError("Bad argument");return this.schema.filter((t=>t.base===e))},export(){const e=[];return this.getConcepts().forEach((t=>{e.push(t.export())})),e},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})}};function Yi(e){var t=e;const i=[];for(;!f(t);){const e=n(this.getConceptSchema(t),{});s=e.attributes,Array.isArray(s)&&s.forEach((e=>{const t=i.find((t=>t.name===e.name));f(t)?i.push(e):(e.required&&(t.required=e.required),e.description&&(t.description=e.description))})),t=e.prototype}var s;return{attributes:i}}const Zi=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function Xi(e,t){let i=e.find((e=>e.name===t));return f(i)&&(i=Zi.find((e=>e.name===t))),i}const Qi=[],es={createModel(e){var t=Object.create(Ki,{schema:{value:e}});return Qi.push(t),t}},ts={css:function(e,t){return h(t)?(ns(e,t),e):e},ref:function(e,t){return h(t)?(t.forEach((t=>{const{style:i={}}=n(this.model.getStyleSchema(t),{});ss.call(this,e,i)})),e):e},gss:function(e,t){if(!c(t))return e;for(const i in t){const s=t[i];let n=is[i];o(n)&&n.call(this,e,s)}return e}},is={text:function(e,t){for(const i in t){const s=t[i];switch(i){case"bold":e.style.fontWeight=as(s);break;case"italic":e.style.fontStyle="italic";break;case"underline":e.style.textDecoration="underline";break;case"strikethrough":e.style.textDecoration="line-through";break;case"colour":case"color":e.style.color=rs(s);break;case"font":e.style.fontFamily=s.toString();break;case"size":e.style.fontSize=ls(s);break;case"alignment":case"align":e.style.textAlign=s}}return e},box:function(e,t){for(const i in t){const s=t[i];switch(i){case"inner":os.call(this,e,s,"padding");break;case"outer":os.call(this,e,s,"margin");break;case"border":hs.call(this,e,s);break;case"background":cs.call(this,e,s);break;case"width":e.style.width=ls.call(this,s);break;case"height":e.style.height=ls.call(this,s);break;case"overflow":e.style.overflow=s;break;case"opacity":e.style.opacity=s/100}}return e},size:function(e,t){for(const e in t)t[e];return e}};function ss(e,t){if(!c(t))return e;for(const i in t){const s=t[i];let n=ts[i];o(n)&&n.call(this,e,s)}return e}function ns(e,t){if(Array.isArray(t))e.classList.add(...t);else{let i=t.replace(/\s+/g," ").trim();p(e.className)?e.className=i:ns(e,i.split(" "))}return e}function rs(e){const{type:t,value:i}=e;switch(t){case"rgb":return c(i)?`rgb(${i.red}, ${i.green}, ${i.blue})`:i;case"name":return i;default:return e}}function as(e){const{type:t,value:i}=e;return Number.isInteger(e)?`${e}`:"bold"}function ls(e){const{value:t,unit:i}=e;return`${t}${i}`}function os(e,t,i){if(Number.isInteger(t))e.style[i]=ls.call(this,t);else for(const s in t){const n=t[s];switch(s){case"top":e.style[`${[i]}Top`]=ls.call(this,n);break;case"right":e.style[`${[i]}Right`]=ls.call(this,n);break;case"bottom":e.style[`${[i]}Bottom`]=ls.call(this,n);break;case"left":e.style[`${[i]}Left`]=ls.call(this,n)}}}function cs(e,t){e.style.backgroundColor=rs.call(this,t)}function hs(e,t){if(t.size)e.style.borderStyle="solid",e.style.borderWidth=ls.call(this,t.size),e.style.borderColor=rs.call(this,t.color);else for(const i in t){const s=t[i];switch(i){case"top":e.style.borderTopStyle="solid",e.style.borderTopWidth=ls.call(this,s.size),e.style.borderTopColor=rs.call(this,s.color);break;case"right":e.style.borderRightStyle="solid",e.style.borderRightWidth=ls.call(this,s.size),e.style.borderRightColor=rs.call(this,s.color);break;case"bottom":e.style.borderBottomStyle="solid",e.style.borderBottomWidth=ls.call(this,s.size),e.style.borderBottomColor=rs.call(this,s.color);break;case"left":e.style.borderLeftStyle="solid",e.style.borderLeftWidth=ls.call(this,s.size),e.style.borderLeftColor=rs.call(this,s.color)}}t.radius&&us.call(this,e,t.radius)}function us(e,t){if(Number.isInteger(t))e.style.borderRadius=ls.call(this,t);else for(const i in t){const s=t[i];switch(i){case"top":e.style.borderTopLeftRadius=ls.call(this,s);break;case"right":e.style.borderTopRightRadius=ls.call(this,s);break;case"bottom":e.style.borderBottomRightRadius=ls.call(this,s);break;case"left":e.style.borderBottomLeftRadius=ls.call(this,s)}}}function ds(e,t){if(!Array.isArray(t))return!1;e.currentState=null;for(let i=0;i<t.length;i++){const s=t[i],{rule:n,result:r}=s;let a=!1,l=ps[n.type];if(o(l)&&(a=l.call(this,n[n.type])),a)return e.currentState=i,r}return null}const ps={ref:function(e){const{rule:t={}}=n(this.model.getRuleSchema(e),{});let i=ps[t.type];return!!o(i)&&i.call(this,t[t.type])},eq:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return ms.call(this,e[0])==ms.call(this,e[1])},ne:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return ms.call(this,e[0])!=ms.call(this,e[1])},lt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return ms.call(this,e[0])<ms.call(this,e[1])},le:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return ms.call(this,e[0])<=ms.call(this,e[1])},gt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return ms.call(this,e[0])>ms.call(this,e[1])},ge:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return ms.call(this,e[0])>=ms.call(this,e[1])},and:function(e){return fs.call(this,e[0])&&fs.call(this,e[1])},or:function(e){return fs.call(this,e[0])||fs.call(this,e[1])},not:function(e){return!fs.call(this,e[0])},no:function(e){let t=ms.call(this,e);return h(t)?r(t):f(t)}};function ms(e,t){if(c(e)){let t=`get${E(e.prop)}`;return this[t]?this[t]():this[e.prop]}return t||e}function fs(e){let t=ps[e.type];return o(t)?t.call(this,e[e.type]):w(ms.call(this,e))}const bs={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,errors:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return!r(this.errors)},get hasAttached(){return!r(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return o(e)?this.attached.filter((t=>e(t))):this.attached},show(){return Ne(this.element),this.visible=!0,this.active=!0,this},hide(){return He(this.element),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},focus(e){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},_focusIn:e=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var e=this.source.delete();e.success?(this.clear(),we(this.element),this.element.remove()):(this.environment.notify(e.message),$e(this.element))},spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(e){this.focusOut()},deleteHandler(e){console.warn(`DELETE_HANDLER NOT IMPLEMENTED FOR ${this.name}`)},backspaceHandler:e=>(console.warn("BACKSPACE_HANDLER NOT IMPLEMENTED"),!1),arrowHandler:(e,t)=>(console.warn("ARROW_HANDLER NOT IMPLEMENTED"),!1),clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler(e){this.toolbar&&this.toolbar.remove()}},vs=Object.assign(bs),gs={input:null,label:null,value:"",state:null,init(){const{focusable:e=!0}=this.schema;return this.focusable=e,this},render(){const e=H(),{label:t={},input:i={},after:s={}}=this.schema;var n,r;if(x(this.element)||(this.element=(n=this.id,F({id:n,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:n}})),this.readonly&&this.element.classList.add("readonly"),ss.call(this.projection,this.element,this.schema.style)),x(this.notification)||(this.notification=function(e){return F({class:["field-notification"],dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),e.appendChild(this.notification)),x(this.statusElement)||(this.statusElement=function(e){return Q({class:["field-status"],dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),this.notification.appendChild(this.statusElement)),!x(this.input)){const{style:t}=i;this.input=function(e){return ee({id:`checkbox${e}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),this.input.checked=!("concept"!==(r=this.source).object||!r.hasValue())&&r.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),ss.call(this.projection,this.input,t),e.appendChild(this.input)}if(!x(this.label)){const{style:i,content:s=[],value:n}=t;this.label=ie({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,s.forEach((e=>{this.label.append(Tn.call(this,e))})),ss.call(this.projection,this.label,i),e.appendChild(this.label)}return e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.choice&&He(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(e,t=!1){var i;i=t?this.source.setValue(e):{success:!0},this.errors=[],i.success||(this.environment.notify(i.message,"error"),this.errors.push(...i.errors)),this.input.checked=e,this.value=e,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},refresh(){if(n(ds.call(this,this.schema,this.schema.state),this.schema),this.hasChanges()?this.statusElement.classList.add("change"):this.statusElement.classList.remove("change"),this.schema.state){let e=this.schema.state[this.getValue().toString()];const{style:t,content:i,value:s}=e;let n=H();i.forEach((e=>{n.append(Tn.call(this,e))})),we(this.label).append(n),ss.call(this.projection,this.label,t)}var e,t;this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",we(this.statusElement),this.hasError?(this.element.classList.add("error"),this.input.classList.add("error"),this.statusElement.classList.add("error"),this.statusElement.appendChild(("error",e=this.errors,t=Y({class:["notification-message","notification-message--error"]},e),Array.isArray(e)?t.style.minWidth=`${Math.min(.5*e[0].length,30)}em`:t.style.minWidth=`${Math.min(.5*e.length,30)}em`,t))):(this.element.classList.remove("error"),this.input.classList.remove("error"),this.statusElement.classList.remove("error"))},append(e){if(!x(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.appendChild(e),this},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(He(this.messageElement),t=!1),t){let t=ge(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}},backspaceHandler(e){return this.arrowHandler("left",e)},enterHandler(e){this.setValue(!this.input.checked,!0)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,this.element)},bindEvents(){this.element.addEventListener("change",(e=>{this.setValue(this.getValue(),!0)}))}},ys=Object.assign(Object.create(vs),gs);function Es(e,t){var i=Y({class:["notification-message",`notification-message--${e}`]},t);return Array.isArray(t)?i.style.minWidth=`${Math.min(.5*t[0].length,30)}em`:i.style.minWidth=`${Math.min(.5*t.length,30)}em`,i}function ws(e){const t=e=>e.parentElement===this.choices;return t(e)?e:ge(e,t,5)}function Cs(e){return e.textContent}const js={value:null,values:null,choices:null,input:null,items:null,selection:null,init(){const{focusable:e=!0}=this.schema;return this.items=new Map,this.focusable=e,v(this.schema,"choice")||(this.schema.choice={}),this},hasChanges(){return this.value!=this.source.getValue(!0)},reset(){this.source.removeValue()},hasValue(){return!f(this.value)},getValue(){return this.selection},setValue(e,t=!1){var i=null;if(t)return i=this.source.setValue(e),this.errors=[],i.success||(this.environment.notify(i.message,Ge.ERROR),this.errors.push(...i.errors)),!0;f(e)?(this.selection&&this.selection.classList.remove("selected"),this.selection=null):this.setChoice(e),this.errors=[],this.value=e,this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value=""),this.hasChanges()?this.statusElement.classList.add("change"):this.statusElement.classList.remove("change"),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),we(this.statusElement),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error"),this.statusElement.classList.add("error"),this.statusElement.appendChild(Es(Ge.ERROR,this.errors))):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error"),this.statusElement.classList.remove("error")),this},render(){const e=H(),{choice:t,input:i,style:s}=this.schema;if(x(this.element)||(this.element=F({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),x(this.notification)||(this.notification=F({class:["field-notification"],dataset:{nature:"field-component",view:"choice",id:this.id}}),e.appendChild(this.notification)),x(this.statusElement)||(this.statusElement=Q({class:["field-status","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.notification.appendChild(this.statusElement)),x(this.messageElement)||(this.messageElement=Q({class:["field-message","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.notification.appendChild(this.messageElement)),!x(this.input)&&i){const{placeholder:t="",type:s,style:r}=i;let a=xn.call(this,t);this.input=ee({class:["field--choice__input"],type:n(s,"text"),placeholder:a,title:a,dataset:{nature:"field-component",view:this.type,id:this.id}}),ss.call(this,this.input,r),e.append(this.input)}if(!x(this.choices)){const{style:i}=t;this.choices=W({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),ss.call(this,this.choices,i),e.appendChild(this.choices)}return ss.call(this.projection,this.element,s),e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),we(this.choices),this.values=this.source.getCandidates(),this.values.forEach((e=>{this.choices.appendChild(this.createChoiceOption(e))})),this.source.hasValue()&&this.setValue(this.source.getValue(!0)),this.refresh(),this.element},focus(e){if(this.choices.hasChildNodes()){let e=st(this.choices);e&&e.focus()}else this.input&&!Ze(this.input)?this.input.focus():this.selection&&this.selection.focus();return this.element.classList.add("active"),this},focusIn(){this.focused=!0,this.element.classList.add("active");const e=H();return this.source.getCandidates().filter((e=>!this.values.some((t=>t.id===e.id)))).forEach((t=>{e.append(this.createChoiceOption(t)),this.values.push(t)})),this.choices.append(e),this},focusOut(){if(this.readonly)return;this.input&&p(this.input.value)&&(this.input.value=""),this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];Ne(i),i.hidden=!1}return this.focused=!1,this},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(e){const{children:t}=this.choices;if(this.element.dataset.input=e.trim(),p(e)){for(let e=0;e<t.length;e++){const i=t[e];Ne(i),i.hidden=!1}return}this.element.classList.add("querying");let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e];let n=Cs(s).toLowerCase(),r=n.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();i.some((e=>n.includes(e)||r.includes(e)))?(Ne(s),s.hidden=!1):(He(s),s.hidden=!0)}return!0},createChoiceOption(e){const t=c(e),i=U({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:t?"concept":"value",value:t?e.id:e}}),{template:s={},style:r}=this.schema.choice.option;if("meta-concept"===e.type){let t=this.model.getProjectionSchema(e.name,n(s.tag,"choice"))[0],r=t.type,a={type:r,[r]:t.content||t.projection},l=Tn.call(this,a,null,{focusable:!1,meta:e.name});i.dataset.type="meta-concept",i.dataset.value=e.name,i.append(l)}else if(t){let t=this.model.createProjection(e,n(s.tag,"choice")).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,i.append(t.render())}else i.append(e.toString());return ss.call(this.projection,i,r),this.items.set(e.id,i),i},setChoice(e){const{children:t}=this.choices,i=e=>{const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)):"meta-concept"===t?this.values.find((e=>e.name===i)):"value"===t?i:void 0};let s=!1;for(let a=0;a<t.length;a++){const l=t[a];r=e,("concept"===(n=i(l)).type?n.id===r.id:"meta-concept"===n.type?n.name===r.name:n===r)?(l.classList.add("selected"),l.dataset.selected="selected",this.selection=l,Ne(l),s=!0):(l.classList.remove("selected"),delete l.dataset.selected)}var n,r;return this},delete(){if(this.hasValue())this.reset();else{let e=this.source.delete();e.success?(this.clear(),we(this.element),this.element.remove()):(this.environment.notify(e.message),$e(this.element))}},_spaceHandler(e){let t=this.source.getCandidates();if(r(t))return this.messageElement.appendChild(Es(Ge.INFO,"No candidates found.")),void Ne(this.messageElement);const i=H();t.forEach((e=>{i.appendChild(this.createChoiceOption(e))})),we(this.choices).appendChild(i),this.filterChoice(this.input.value),Ne(this.choices),this.element.classList.add("querying")},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(He(this.messageElement),t=!1),t){let t=ge(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.focus()},enterHandler(e){const t=ws.call(this,e);x(t)&&this.selection!==t&&this.setValue((e=>{const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)):i})(t),!0)},backspaceHandler(e){ws.call(this,e)&&this.input&&this.input.focus()},clickHandler(e){const t=ws.call(this,e);x(t)&&this.selection!==t&&(this.setValue((e=>{const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)):i})(t),!0),this.focusOut())},arrowHandler(e,t){if(!x(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);let n=ws.call(this,t);if(n){let t=nt(n,e,this.choices);return x(t)?(t.focus(),!0):this.arrowHandler(e,this.choices)}if(i!==this.element)return s();let r=nt(t,e,this.element);return x(r)?(r===this.choices&&this.choices.hasChildNodes()&&("up"===e?r=ot(this.choices):"down"===e?r=rt(this.choices):"left"===e?r=lt(this.choices):"right"===e&&(r=at(this.choices))),r.focus(),!0):s()},bindEvents(){x(this.input)&&this.element.addEventListener("input",(e=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((e,t)=>{this.setValue(e)}))}},Ls=Object.assign(Object.create(vs),js),xs={content:{type:"static",static:{type:"text",content:"Remove"}}};function Ts(e){const{action:t={}}=this.schema,i=this.content.find((e=>"list"===e.type)),{template:s,style:r}=i.list.item,a=U({class:["field--list-item"],tabindex:0,dataset:{nature:"field-component",view:"list",id:this.id,value:e.id,name:e.name,index:n(e.index,this.items.size)}});var{content:l,style:o}=n(t.remove,xs),c=Tn.call(this,l),h=ae({class:["btn","btn-remove"],tabindex:-1,dataset:{nature:"field-component",view:"list",id:this.id,action:"remove",index:a.dataset.index}},c);ss.call(this.projection,h,o),a.appendChild(h);var u=this.model.createProjection(e,s.tag);return u.parent=this.projection,a.appendChild(u.init().render()),this.items.set(e.id,a),ss.call(this.projection,a,r),a}const Os={list:null,items:null,selection:null,content:null,init(){return this.source.register(this),this.items=new Map,this.content=this.schema.content,this},update(e,t){switch(e){case"value.added":this.addItem(t);break;case"value.removed":this.removeItem(t);break;case"value.changed":we(this.list),this.source.getValue().forEach((e=>{var t=Ts.call(this,e);this.list.appendChild(t)}));break;case"delete":this.source.unregister(this),we(this.element),this.element.remove();break;default:console.warn(`The message '${e}' was not handled for list field`)}this.refresh()},render(){const e=H(),{content:t,style:i,action:s={}}=this.schema;if(!Array.isArray(t))throw new Error("Empty content for listfield");return x(this.element)||(this.element=F({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),ss.call(this.projection,this.element,this.schema.style)),x(this.notification)||(this.notification=F({class:["field-notification"],dataset:{nature:"field-component",view:"list",id:this.id}}),e.appendChild(this.notification)),x(this.statusElement)||(this.statusElement=Q({class:["field-status"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.notification.appendChild(this.statusElement)),t.forEach((e=>{})),this.source.getValue().forEach((e=>{var t=Ts.call(this,e);this.list.appendChild(t)})),e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,getValue(){return this.list.children},hasValue(){return this.items.size>0},clear(){this.items.clear(),we(this.list)},focusIn(e){this.focused=!0,this.element.classList.add("active")},focusOut(e){if(!this.readonly)return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){var e,t;this.hasValue()?(this.element.classList.remove("empty"),this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list.classList.add("empty")),this.hasChanges()?this.statusElement.classList.add("change"):this.statusElement.classList.remove("change"),we(this.statusElement),this.hasError?(this.element.classList.add("error"),this.list.classList.add("error"),this.statusElement.classList.add("error"),this.statusElement.appendChild(("error",e=this.errors,t=Y({class:["notification-message","notification-message--error"]},e),Array.isArray(e)?t.style.minWidth=`${Math.min(.5*e[0].length,30)}em`:t.style.minWidth=`${Math.min(.5*e.length,30)}em`,t))):(this.element.classList.remove("error"),this.list.classList.remove("error"),this.statusElement.classList.remove("error"))},createElement(){return this.source.createElement()},getNode(e){return this.items.get(e)},addNode(e){const t=Ts.call(this,e);e.index?this.list.children[e.index-1].after(t):this.list.appendChild(t)},removeNode(e){let t=this.getItem(e.id);if(!x(t))throw new Error("List error: Item not found")},append(e){if(!x(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.appendChild(e),this},delete(e){if(e===this.element)return void this.source.remove();const{index:t}=e.dataset;this.source.removeElementAt(+t)?this.environment.notify("The element was successfully deleted"):(this.environment.notify("This element cannot be deleted"),$e(e))},escapeHandler(e){return!!this.messageElement&&(He(this.messageElement),!0)},enterHandler:e=>!1,backspaceHandler:e=>!1,clickHandler:e=>!1,arrowHandler:(e,t)=>!1,bindEvents(){}},As=Object.assign(Object.create(vs),Os),_s={content:[{type:"static",static:{type:"text",content:"Add",focusable:!1}}]},Vs={content:[{type:"static",static:{type:"text",content:"Remove",focusable:!1}}]};function Ss(){return x(this.messageElement)||(this.messageElement=Q({class:["field-message","hidden"],dataset:{nature:"field-component",view:"text",id:this.id}}),this.notification.appendChild(this.messageElement)),this.messageElement}function Rs(e,t){var i=Y({class:["notification-message",`notification-message--${e}`]},t);return Array.isArray(t)?i.style.minWidth=`${Math.min(.5*t[0].length,30)}em`:i.style.minWidth=`${Math.min(.5*t.length,30)}em`,i}function Ms(e){if(!x(e))return!1;const{nature:t,id:i}=e.dataset;return"field-component"===t&&i===this.id}function ks(e){const t=e=>e.parentElement===this.list;return t(e)?e:ge(e,t,3)}const Is={list:null,items:null,elements:null,selection:null,content:null,init(){const{focusable:e=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.focusable=e,v(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(e,t=!1){t&&this.source.setValue(e),we(this.list),e.forEach((e=>{var t=this.createItem(e);this.list.appendChild(t)})),this.refresh()},clear(){this.items.clear(),we(this.list)},focus(e){if(Ms.call(this,e))this.focusIn(e),this.selection.focus();else if(x(this.selection))this.selection.focus();else if(this.hasValue())this.list.firstElementChild.focus();else{let e=rt(this.element);if(!x(e))return this;if(e===this.list){if(!this.list.hasChildNodes())return this.arrowHandler("down",this.list);e.children[0].focus()}else e.focus()}return this},focusIn(e){this.focused=!0,this.element.classList.add("active");const{component:t}=e.dataset;"list-item"===t&&(this.selection=e)},_focusIn(e){const{component:t}=e.dataset;"list-item"===t&&(this.selection=e)},focusOut(){if(!this.readonly)return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(e){return this.items.get(e)},createItem(e){const{action:t={}}=this.schema,{template:i={},style:s}=this.schema.list.item,r=U({class:["field--list-item"],tabindex:0,dataset:{nature:"field-component",view:"list",component:"list-item",id:this.id,value:e.id,name:e.name,index:n(e.index,this.items.size)}}),{content:a,help:l,style:o}=n(t.remove,Vs);let c=ae({class:["btn","field-action","btn-remove"],tabindex:-1,title:"Remove",help:l,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",index:r.dataset.index}});a.forEach((e=>{let t=Tn.call(this,e,null,{focusable:!1});c.append(t)})),ss.call(this.projection,c,o),r.appendChild(c);let h=this.model.createProjection(e,i.tag);return h.parent=this.projection,r.appendChild(h.init().render()),h.element.parent=this,this.items.set(e.id,r),ss.call(this.projection,r,s),r},addItem(e){const t=this.createItem(e);e.index?this.list.children[e.index-1].after(t):this.list.appendChild(t),this.refresh()},removeItem(e){let t=this.getItem(e.id);if(!x(t))throw new Error("List error: Item not found");const i=+t.dataset.index;this.items.delete(e.id),this.selection==t&&(this.selection=null),we(t),t.remove();for(let e=i;e<this.list.children.length;e++){const t=this.list.children[e],{index:i}=t.dataset;t.dataset.index=+i-1}this.refresh()},append(e){if(!x(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.appendChild(e),this},delete(e){if(e===this.element)return void this.source.remove();const{index:t}=e.dataset;var i=this.source.removeElementAt(+t);if(i.success)if(this.hasValue()){let e=+t<this.list.childElementCount?+t:this.list.childElementCount-1;this.list.children[e].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${i.message}`),$e(e)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list.classList.add("empty")),this.hasChanges()?this.statusElement.classList.add("change"):this.statusElement.classList.remove("change"),this.elements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=ds.call(this,t,t.state);if(i===t.currentState)return;let n=null;n=s?Tn.call(this,s.content,null):Tn.call(this,t.content,null),we(e).append(n)})),we(this.statusElement),this.hasError?(this.element.classList.add("error"),this.list.classList.add("error"),this.statusElement.classList.add("error"),this.statusElement.appendChild(Rs(Ge.ERROR,this.errors))):(this.element.classList.remove("error"),this.list.classList.remove("error"),this.statusElement.classList.remove("error"))},render(){const e=H(),{list:t,style:i,action:s={}}=this.schema;if(x(this.element)||(this.element=F({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),ss.call(this.projection,this.element,this.schema.style)),x(this.notification)||(this.notification=F({class:["field-notification"],dataset:{nature:"field-component",view:"list",id:this.id}}),e.appendChild(this.notification)),x(this.statusElement)||(this.statusElement=Q({class:["field-status"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.notification.appendChild(this.statusElement)),!x(this.list)){const{style:i}=t;this.list=W({class:["bare-list","field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),t.currentState=null,this.elements.set(t,this.list),ss.call(this.projection,this.list,i),e.appendChild(this.list)}let r=n(s.add,_s);if(r){const{content:t,help:i,style:s}=r;let n=ae({class:["field-action","field--list__add"],tabindex:0,title:i,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});t.forEach((e=>{let t=Tn.call(this,e,null,{focusable:!1});n.append(t)})),r.currentState=null,this.elements.set(r,n),ss.call(this.projection,n,s),e.appendChild(n)}return this.source.getValue().forEach((e=>{var t=this.createItem(e);this.list.appendChild(t)})),ss.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),this.refresh(),this.element},_spaceHandler(e){Ss.call(this),we(this.messageElement),this.messageElement.appendChild(Rs(Ge.INFO,"Enter any text.")),Ne(this.messageElement)},spaceHandler(e){return!(!Ms.call(this,e)||e.parentElement!==this.list||(this.createElement(),0))},deleteHandler(e){return!(!Ms.call(this,e)||e.parentElement!==this.list||(this.selection=e,this.delete(e),0))},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(He(this.messageElement),t=!1),t){let t=ge(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}return this.focus(),!1},enterHandler(e){const t=(e=>Ms.call(this,e)?e:ge(e,(e=>Ms.call(this,e)),5))(e);if(f(t))return!1;const{action:i,index:s,component:n}=t.dataset;if("list-item"===n){let e=t.firstElementChild;for(;e&&e.dataset.id===this.id;)e=e.nextElementSibling;let i=this.environment.resolveElement(e);return i&&i.focus(),!0}return"add"===i?(this.createElement(),!0):"remove"===i&&(this.delete(t.parentElement),!0)},backspaceHandler:e=>!1,clickHandler(e){const t=(e=>Ms.call(this,e)?e:ge(e,(e=>Ms.call(this,e)),5))(e);if(f(t))return;const{action:i,index:s,name:n}=t.dataset;"add"===i?this.createElement():"remove"===i&&this.delete(t.parentElement)},arrowHandler(e,t){if(!x(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);let n=ks.call(this,t);if(n){let t=nt(n,e,this.list);return x(t)?(t.focus(),this.selection=t,!0):this.arrowHandler(e,this.list)}if(i!==this.element)return s();let r=nt(t,e,this.element);return x(r)?(r===this.list&&this.list.hasChildNodes()&&("up"===e?r=ot(this.list):"down"===e?r=rt(this.list):"left"===e?r=lt(this.list):"right"===e&&(r=at(this.list))),r.focus(),!0):s()},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.clear(),this.source.getValue().forEach((e=>{let t=this.createItem(e);this.list.appendChild(t)}))}))}},Ns=Object.assign(Object.create(vs),Is);Object.defineProperty(Ns,"size",{get(){return this.items.size}});var Hs=0;const Ps={content:{type:"static",static:{type:"text",content:"Add"}}},$s={content:{type:"static",static:{type:"text",content:"Remove"}}},Ds={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:e=[],template:t,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=e,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,t.tag)[0].projection,this},render(){const{content:e,action:t={}}=this.schema,{disposition:i}=this.template,s=H();if(!Array.isArray(e))throw new Error("Empty content for listfield");if(x(this.element)||(this.element=F({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),ss.call(this.projection,this.element,this.schema.style)),x(this.notification)||(this.notification=F({class:["field-notification"],dataset:{nature:"field-component",view:"table",id:this.id}}),s.appendChild(this.notification)),x(this.statusElement)||(this.statusElement=Q({class:["field-status"],dataset:{nature:"field-component",view:"table",id:this.id}}),this.notification.appendChild(this.statusElement)),e.forEach((e=>{if("table"===e.type){let t=n(e.table,{});const{style:i,header:r,body:a={},footer:l}=t;if(this.table=le({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),r){const{style:e}=r;this.header=ce({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),ss.call(this.projection,this.header,e),this.table.append(this.header)}if(a){const{style:e}=a;this.body=he({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),ss.call(this.projection,this.body,e),this.table.append(this.body)}if(l){const{style:e}=l;this.footer=ue({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),ss.call(this.projection,this.footer,e),this.table.append(this.footer)}t.currentState=null,this.contentElements.set(t,this.table),ss.call(this.projection,this.table,i),s.appendChild(this.table)}else if("action"===e.type){let t=n(e,Ps);const{content:i,style:r}=t;let a=Tn.call(this,i,null),l=ae({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[a]);t.currentState=null,this.contentElements.set(t,l),ss.call(this.projection,l,r),s.appendChild(l)}else{let t=Tn.call(this,e);this.contentElements.set(e,t),s.appendChild(t)}})),this.header){let e=de({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});i.forEach((t=>{const{header:i}=t,{style:s,content:n}=i;var r=Tn.call(this,n),a=pe({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},r);ss.call(this.projection,a,s),e.appendChild(a)}));let t=me({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");e.appendChild(t),this.header.appendChild(e)}return this.source.hasValue()&&this.source.getValue().forEach((e=>{this.addRow(e)})),s.hasChildNodes()&&(this.element.appendChild(s),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){var e,t,i;this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.hasChanges()?this.statusElement.classList.add("change"):this.statusElement.classList.remove("change"),this.contentElements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=ds.call(this,t,t.state);if(i===t.currentState)return;let n=null;n=s?Tn.call(this,s.content,null):Tn.call(this,t.content,null),we(e).append(n)})),we(this.statusElement),this.hasError?(this.element.classList.add("error"),this.statusElement.classList.add("error"),this.statusElement.appendChild((e=Ge.ERROR,t=this.errors,i=Y({class:["notification-message",`notification-message--${e}`]},t),Array.isArray(t)?i.style.minWidth=`${Math.min(.5*t[0].length,30)}em`:i.style.minWidth=`${Math.min(.5*t.length,30)}em`,i))):(this.element.classList.remove("error"),this.statusElement.classList.remove("error"))},createElement(){return this.source.createElement()},addRow(e){const{action:t={},before:i={},after:s={}}=this.schema,{disposition:r}=this.template,a=n(e.index,this.table.rows.length),l="row"+Hs++,o=de({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:a,elementId:l}});this.elements.set(l,o),r.forEach((t=>{const{body:i}=t,{style:s,content:n}=i;var r=Tn.call(this,n,e),a=me({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},r);ss.call(this.projection,a,s),o.appendChild(a)}));var c=me({class:["field--table__cell-action"]}),{content:h,style:u}=n(t.remove,$s),d=Tn.call(this,h),p=ae({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:l}},d),m=ae({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:l}},"Move up"),f=ae({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:l}},"Move down");ss.call(this.projection,p,u),c.append(p,m,f),o.appendChild(c),this.body.appendChild(o),this.refresh()},removeRow(e){var t=this.body.rows.item(e.index);if(!x(t))throw new Error("Table error: Row not found");we(t),t.remove();for(let t=e.index;t<this.body.rows.length;t++){const e=this.body.rows.item(t),{index:i}=e.dataset;e.dataset.index=+i-1}this.refresh()},removeElement(e){return this.source.removeElement(e)},delete(e){if(e===this.element||e===this.table)return void this.source.delete();const{index:t}=e.dataset;this.source.removeElementAt(+t)||(this.environment.notify("This element cannot be deleted"),$e(e))},bindEvents(){this.element.addEventListener("click",(e=>{const{target:t}=e,i=function(e){const t="field-component";return e.dataset.nature===t?e:ge(e,(e=>e.dataset.nature===t))}(t);if(!x(i))return;const{id:s,action:n}=i.dataset;if(s===this.id)if("add"===n)this.createElement();else if("remove"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e);this.delete(t)}else if("move-up"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.previousElementSibling;s&&s.before(t)}else if("move-down"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.nextElementSibling;s&&s.after(t)}}),!0),this.projection.registerHandler("value.added",(e=>{this.addRow(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeRow(e)})),this.projection.registerHandler("value.changed",(e=>{we(this.body),this.source.getValue().forEach((e=>{this.addRow(e)}))}))}},Bs=Object.assign(Object.create(vs),Ds),Fs=e=>x(e,["input","textarea"]);function zs(){return x(this.messageElement)||(this.messageElement=Q({class:["field-message","hidden"],dataset:{nature:"field-component",view:"text",id:this.id}}),this.notification.appendChild(this.messageElement)),this.messageElement}function qs(){return x(this.choice)||(this.choice=W({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function Ws(e){return U({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:e,id:this.id}},e)}function Us(e,t){var i=Y({class:["notification-message",`notification-message--${e}`]},t);return Array.isArray(t)?i.style.minWidth=`${Math.min(.5*t[0].length,30)}em`:i.style.minWidth=`${Math.min(.5*t.length,30)}em`,i}function Js(e){return e.parentElement===this.choice?e:ge(e,(e=>e.parentElement===this.choice),3)}function Gs(e){const{placeholder:t="",type:i}=e;let s=xn.call(this,t);return this.readonly||this.resizable?Y({class:["field--textbox__input"],editable:!this.readonly,title:s,dataset:{placeholder:s,nature:"field-component",view:this.type,id:this.id}}):this.multiline?te({class:["field--textbox__input"],placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}}):ee({class:["field--textbox__input"],type:n(i,"text"),placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}})}const Ks={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,init(){const{multiline:e=!1,resizable:t=!1,focusable:i=!0}=this.schema;return this.multiline=e,this.focusable=i,this.resizable=t,v(this.schema,"choice")||(this.schema.choice={}),this},focus(e){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),p(this.getValue())&&(this.input.textContent=""),this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.choice&&He(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!r(this.getValue())},getValue(){return Fs(this.input)?this.input.value:this.input.textContent},setValue(e,t=!1){var i;i=t?this.source.setValue(e):{success:!0},this.errors=[],i.success||(this.environment.notify(i.message,"error"),this.errors.push(...i.errors)),this.setInputValue(e),this.value=e,this.refresh()},setInputValue(e){Fs(this.input)?this.input.value=e:this.input.textContent=e},getCandidates(){return this.source.getCandidates()},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){ds.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasChanges()?this.statusElement.classList.add("change"):this.statusElement.classList.remove("change"),we(this.statusElement),this.hasError?(this.element.classList.add("error"),this.input.classList.add("error"),this.statusElement.classList.add("error"),this.statusElement.appendChild(Us(Ge.ERROR,this.errors))):(this.element.classList.remove("error"),this.input.classList.remove("error"),this.statusElement.classList.remove("error")),this.choice&&this.filterChoice(this.getValue())},render(){const e=H(),{input:t={},style:i}=this.schema;if(x(this.element)||(this.element=F({id:this.id,class:["field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),ss.call(this.projection,this.element,this.schema.style)),x(this.notification)||(this.notification=F({class:["field-notification"],dataset:{nature:"field-component",view:"text",id:this.id}}),e.appendChild(this.notification)),x(this.statusElement)||(this.statusElement=Q({class:["field-status"],dataset:{nature:"field-component",view:"text",id:this.id}}),this.notification.appendChild(this.statusElement)),!x(this.input)){const{placeholder:i="",type:s,style:n}=t;this.input=Gs.call(this,t),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",ss.call(this,this.input,n),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.appendChild(this.input)}return ss.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(e){const{children:t}=this.choice;if(p(e)){for(let e=0;e<t.length;e++){const i=t[e];Ne(i),i.hidden=!1}return!0}let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e],{value:n}=s.dataset;i.some((e=>n.toLowerCase().includes(e)))?(Ne(s),s.hidden=!1):(He(s),s.hidden=!0)}return!0},selectChoice(e){if(!x(e))return;const t=function(e){return e.dataset.value}(e);return this.setValue(t,!0),this.input.focus(),He(this.choice),this},append(e){if(!x(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.appendChild(e),this},_spaceHandler(e){const t=this.getCandidates();if(!Array.isArray(t))throw new TypeError("Bad values");if(zs.call(this),we(this.messageElement),r(t))this.messageElement.appendChild(Us(Ge.INFO,"Enter any text.")),Ne(this.messageElement);else{qs.call(this);const e=H();t.forEach((t=>e.appendChild(Ws.call(this,t)))),we(this.choice).appendChild(e),this.filterChoice(this.getValue()),Ne(this.choice)}},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(He(this.messageElement),t=!1),this.choice&&!Ze(this.choice)&&(He(this.choice),t=!1),t){let t=ge(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.input.focus()},enterHandler(e){const t=Js.call(this,e);if(t)this.selectChoice(t);else if(this.multiline);else if(e===this.input)return this.setValue(this.getValue(),!0),!0},backspaceHandler(e){Js.call(this,e)&&this.input.focus()},clickHandler(e){const t=Js.call(this,e);x(t)&&this.selectChoice(t)},arrowHandler(e,t){if(!x(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);let n=Js.call(this,t);if(x(n)){let t=nt(n,e,this.choice);return x(t)?(t.focus(),!0):this.arrowHandler(e,this.choice)}if(i!==this.element)return s();let r=null;if("right"===e){if(t===this.input&&!(this.getValue().length<Re(this.input)+1))return!1;r=nt(t,e,this.element,!1)}else if("left"===e){if(t===this.input&&0!==Re(this.input))return!1;r=nt(t,e,this.element,!1)}else r=nt(t,e,this.element,!1);return x(r)?(r===this.choice&&this.choice.hasChildNodes()&&("up"===e?r=ot(this.choice):"down"===e?r=rt(this.choice):"left"===e?r=lt(this.choice):"right"===e&&(r=at(this.choice))),r.focus(),!0):s()},controlHandler(e){this.toolbar&&this.toolbar.remove()},bindEvents(){this.element.addEventListener("input",(e=>{this.refresh()})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Ys=Object.assign(Object.create(vs),Ks),Zs={binary:(e,t,i)=>Object.create(ys,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),choice:(e,t,i)=>Object.create(Ls,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),graph:(e,t,i)=>Object.create(As,{object:{value:"field"},name:{value:"graph-field"},type:{value:"graph"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),list:(e,t,i)=>Object.create(Ns,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(Bs,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),text:(e,t,i)=>Object.create(Ys,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}})};var Xs=0;const Qs=()=>"field"+Xs++,en={createField(e,t,i){const{type:s}=t,r=Zs[s];if(f(r))throw new Error(`Missing handler: The '${s}' field could not be handled`);var a=r(e,t,i);if(f(a))throw new Error(`Bad request: The '${s}' field could not be created`);return a.errors=[],a.readonly=n(t.readonly,!1),f(a.id)&&(a.id=Qs()),a}},tn={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!r(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return o(e)?this.attached.filter((t=>e(t))):this.attached},show(){return Ne(this.element),this.visible=!0,this.active=!0,this},hide(){return He(this.element),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:e=>!1,clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",Ge.WARNING,1500),$e(this.element)},spaceHandler(e){return this.arrowHandler("right",e)},_spaceHandler(e){return this.environment.notify("Nothing do here.",Ge.NORMAL,1500),!1},escapeHandler(e){let t=ge(e,(e=>0===e.tabIndex));return this.projection.resolveElement(t).focus(t),!0},enterHandler(e){this.element.click()},deleteHandler(e){return this.environment.notify("This element cannot be removed",Ge.WARNING,1500),$e(this.element),!1},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,t)},clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:e=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},sn=Object.assign(tn,oi),nn={init(){return this},render(){const e=H(),{help:t,style:i,content:s}=this.schema;return x(this.element)||(this.element=K({class:["audio"],src:s,dataset:{ignore:"all"}})),f(t)||(this.element.title=t),ss.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},rn=Object.assign(Object.create(sn),nn);function an(e){return e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:an(`https://${e}`)}const ln={url:null,alt:null,width:null,height:null,init(){const{url:e,width:t,height:i,alt:s}=this.schema;return this.url=an(e),this.width=t,this.height=i,this.alt=s,this},render(){const{help:e,style:t}=this.schema;return x(this.element)||(this.element=G({class:["image"],src:this.url,alt:this.alt,dataset:{ignore:"all"}})),f(this.width)||isNaN(this.width)||(this.element.width=this.width),f(this.height)||isNaN(this.height)||(this.element.height=this.height),f(e)||(this.element.title=e),ss.call(this.projection,this.element,t),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},on=Object.assign(Object.create(sn),ln),cn={email:e=>`mailto:${e}`,phone:e=>`tel:${e}`,link:e=>`${e}`};function hn(e){return e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:hn(`https://${e}`)}const un={url:null,urlType:null,href:null,content:null,init(){const{url:e,content:t=[],urlType:i="link"}=this.schema;this.url=hn(e),this.content=t,this.urlType=i;const s=cn[this.urlType];if(!o(s))throw new TypeError("type not handled");return this.href=s(this.url),this},render(){if(p(this.url))throw new Error("There is no URL defined for this link");if(r(this.content))throw new Error("There is no content defined for this link");const e=H(),{help:t,style:i}=this.schema;return x(this.element)||(this.element=J({class:["link"],href:this.href,target:"_blank",dataset:{ignore:"all"}})),this.content.forEach((t=>{let i=Tn.call(this,t,this.projection.concept,{focusable:!1});e.appendChild(i)})),f(t)||(this.element.title=t),ss.call(this.projection,this.element,i),e.hasChildNodes()&&this.element.appendChild(e),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},dn=Object.assign(Object.create(sn),un);function pn(e){const{type:t,name:i}=e;return"property"===t?this.projection.concept.getProperty(i):"param"===t?this.projection.getParam(i):e}const mn={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{contentType:t="raw",editable:i=!1,focusable:s=n(this.parent.schema.focusable,!0)}=this.schema;return this.contentType=t,this.editable=i,this.focusable=s,this},render(){let e=!1;const{help:t,style:i,content:s}=this.schema;if(!x(this.element)){this.element=Y({class:["text"],editable:this.editable,dataset:{nature:"static",view:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0);let t=pn.call(this,s);"html"===this.contentType?this.element.append(_(t)):"property"===this.contentType?this.element.textContent=this.projection.concept.getProperty(t):this.element.textContent=t.trim(),e=!0}return f(t)||(this.element.title=t),ss.call(this.projection,this.element,i),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){if(!this.editable&&this.parent)return this.parent.arrowHandler(e,t);if("right"===e){if(this.getLength()<Re(this.element)+1&&this.parent)return this.parent.arrowHandler(e,t)}else if("left"===e){if(0===Re(this.element)&&this.parent)return this.parent.arrowHandler(e,t)}else if(this.parent)return this.parent.arrowHandler(e,t);return!1},escapeHandler(e){let t=ge(e,(e=>0===e.tabIndex));this.projection.resolveElement(t).focus(t)},update(){return"property"!==this.contentType||(this.element.textContent=this.projection.concept.getProperty(this.schema.content)),this},refresh(){return this},bindEvents(){this.projection.registerHandler("value.changed",(e=>{this.update()}))}},fn=Object.assign(Object.create(sn),mn),bn={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.focusable=t,this},render(){const e=H(),{help:t,style:i,content:s}=this.schema;return x(this.element)||(this.element=ae({class:["btn"],dataset:{nature:"static",view:"plink",id:this.id}}),this.focusable&&(this.element.tabIndex=0)),s.forEach((t=>{let i=Tn.call(this,t,this.projection.concept,{focusable:!1});e.appendChild(i)})),f(t)||(this.element.title=t),ss.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.appendChild(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(He(this.messageElement),we(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=ge(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},refresh(){return this},bindEvents(){}},vn=Object.assign(Object.create(sn),bn),gn={template:null,selector:null,content:null,init(){var e;return this.selector=this.schema.selector,this.template=(e=this.selector,"content"in document.createElement("template")?be(e,undefined):null),this},render(){const{style:e,content:t}=this.schema;var i;return j(this.element)||(this.element=(i=this.template)?document.importNode(i.content,n(undefined,!0)):i),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},yn=Object.assign(Object.create(sn),gn);var En=0;const wn=()=>"static"+En++,Cn={audio:(e,t,i)=>Object.create(rn,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:wn()},model:{value:e},schema:{value:t},projection:{value:i}}),plink:(e,t,i)=>Object.create(vn,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:wn()},model:{value:e},schema:{value:t},projection:{value:i}}),image:(e,t,i)=>Object.create(on,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:wn()},model:{value:e},schema:{value:t},projection:{value:i}}),link:(e,t,i)=>Object.create(dn,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:wn()},model:{value:e},schema:{value:t},projection:{value:i}}),text:(e,t,i)=>Object.create(fn,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:wn()},model:{value:e},schema:{value:t},projection:{value:i}}),html:(e,t,i)=>Object.create(yn,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:wn()},model:{value:e},schema:{value:t},projection:{value:i}})},jn={createStatic(e,t,i){const{type:s}=t,n=Cn[s];if(f(n))throw new Error(`Missing handler: The '${s}' static could not be handled`);var r=n(e,t,i);if(f(r))throw new Error(`Bad request: The '${s}' static could not be created`);return r.initObserver(),f(r.id)&&(r.id=wn()),r}};function Ln(e,t){const{name:i,merge:s=!1,required:n=t.isAttributeRequired(i),tag:r,placeholder:a={},style:l}=e;if(!t.hasAttribute(i))throw new Error(`Attribute '${i}' does not exist in the concept '${t.name}'`);n&&t.createAttribute(i);const o={name:i,get created(){return t.isAttributeCreated(i)},schema:e,placeholder:Q({class:["projection-element"],hidden:!0},i),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(o),!o.created){const{content:e}=a;return o.placeholder=e?Tn.call(this,e,t):Q({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:i}},`Add ${i}`),o.placeholder.addEventListener("click",(e=>{t.createAttribute(i),this.projection.resolveElement(o.element).focus()})),o.placeholder}{const{target:e,description:s,schema:n}=t.getAttributeByName(i);let a=this.projection.model.createProjection(e,r).init();a.parent=this.projection,o.element=a.render(),ss.call(this,o.element,l),a.element.parent=this}return o.element}function xn(e){return"property"===e.type?this.projection.concept.getProperty(e.name):e}function Tn(e,t,i={}){const s=n(t,this.projection.concept);if("layout"===e.type){let t=Bn.createLayout(this.model,e.layout,this.projection);return t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("field"===e.type){let t=en.createField(this.model,e.field,this.projection);return t.parent=this,t.init(i),this.model.registerField(t),t.render()}if("static"===e.type){let t=jn.createStatic(this.model,e.static,this.projection);return t.parent=this,t.init(i),this.model.registerStatic(t),t.render()}if("attribute"===e.type)return Ln.call(this,e,s);if("template"===e.type){let s=this.model.getTemplateSchema(e.name);s.param&&this.projection.addParam(e.param);const n=H();return s.content.forEach((e=>{n.append(Tn.call(this,e,t,i))})),n}if("projection"===e.type){const{tag:t,style:i}=e,n={schema:e,placeholder:Q({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return n.update=function(e,r,a){if(n.element&&(n.element.remove(),n.element=null),s.hasValue()){let e=s.getValue(),r=this.projection.model.createProjection(e,t).init();r.optional=!0,r.placeholder=n.placeholder,r.parent=this.projection,n.element=r.render(),n.placeholder&&n.placeholder.after(n.element),x(n.element)&&ss.call(this,n.element,i),r.element.parent=this.projection.element}},s.register(n),n.update(),n.element||n.placeholder}if("property"===e.type){const{name:t}=e;return this.projection.concept.getProperty(t)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}const On={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,editing:!1,getStyle(){return this.schema.style},setStyle(e){return this.schema.style=e,ss.call(this,this.container,e),this.refresh(),!0},isRoot(){return f(this.parent)},getField(e){return this.projection.getField(e)},getStatic(e){return this.projection.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},show(){return Ne(this.element),this.visible=!0,this.active=!0,this},hide(){return He(this.element),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},_focusIn:e=>!1,spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){if(this.isRoot())return!1;let t=ge(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);if(f(i))return!1;i.focus(t)},enterHandler(e){let t=this.environment.resolveElement(this.elements[0]);return t&&t.focus(),!1},deleteHandler(e){if(this.projection.element===this)return this.source.delete(),void this.projection.parent.focus();console.warn(`DELETE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),this.focusOut()},backspaceHandler:e=>(console.warn("BACKSPACE_HANDLER NOT IMPLEMENTED"),!1),arrowHandler:(e,t)=>(console.warn("ARROW_HANDLER NOT IMPLEMENTED"),!1),clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler(e){this.toolbar&&this.toolbar.remove()}},An={HORIZONTAL:"horizontal",VERTICAL:"vertical"},_n={orientation:null,args:null,init(e={}){const{orientation:t=An.HORIZONTAL,editable:i=!0,focusable:s=!1}=this.schema;return this.orientation=t,this.focusable=s,this.editable=i,this.elements=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){v(An,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=F({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=H(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();x(this.container)||(this.container=F({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let t=0;t<e.length;t++){let i=Tn.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.appendChild(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ss.call(this,this.container,t),s.hasChildNodes()&&(this.container.appendChild(s),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="no-wrap",this.refresh(),this.container},refresh(){return this.orientation===An.VERTICAL?this.container.style.flexDirection="column":this.orientation===An.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(e){if(this.focusable)this.container.focus();else{let e=n(st(this.container),this.elements[0]);e===this.btnCollapse&&(e=this.elements[0]);let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},arrowHandler(e,t){if(t===this.container)return!!this.parent&&this.parent.arrowHandler(e,this.container);let i=nt(t,e,this.container);if(x(i)){let e=this.environment.resolveElement(i);return e&&e.focus(),!0}return!!this.parent&&this.parent.arrowHandler(e,this.container)},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Vn=Object.assign({},On,_n),Sn={containerless:!1,args:null,init(e={}){const{containerless:t=!1,editable:i=!0,focusable:s=!1}=this.schema;return this.containerless=t,this.focusable=s,this.editable=i,this.elements=[],this.args=e,Object.assign(this,e),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();this.containerless?this.container=s:x(this.container)||(this.container=F({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let t=0;t<e.length;t++){let i=Tn.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.appendChild(i)}return this.containerless||(this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ss.call(this,this.container,t),s.hasChildNodes()&&(this.container.appendChild(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="center",this.refresh()),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(e){if(this.focusable)this.container.focus();else{let e=n(st(this.container),this.elements[0]),t=this.environment.resolveElement(e);t&&t.focus(e)}},arrowHandler(e,t){if(t===this.container)return!!this.parent&&this.parent.arrowHandler(e,this.container);if(this.containerless)return this.parent.arrowHandler(e,t);let i=nt(t,e,this.container);if(x(i)){let e=this.environment.resolveElement(i);return e&&e.focus(),!0}return!!this.parent&&this.parent.arrowHandler(e,this.container)},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Rn=Object.assign({},On,Sn),Mn={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(e={}){const{editable:t=!0,collapsible:i=!1,focusable:s=!1}=this.schema;return this.focusable=s,this.collapsible=i,this.editable=t,this.elements=[],Object.assign(this,e),this},collapse(e){if(!this.collapsed)return this.collapseContainer=F({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e){if(!this.collapsed)return;let t=H(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();x(this.container)||(this.container=F({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let t=0;t<e.length;t++){let i=e[t],n=F({class:["table-row"]});n.style.display="table-row";for(let e=0;e<i.length;e++){const t=i[e];let s=F({class:["table-cell"]},Tn.call(this,t.content));s.style.display="table-cell",ss.call(this,s,t.style),n.append(s)}s.appendChild(n)}return ss.call(this,this.container,t),s.hasChildNodes()&&(this.container.appendChild(s),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},kn=Object.assign({},On,Mn),In={ROW:"row",COLUMN:"column"},Nn={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{orientation:t=In.ROW,wrappable:i=!0,alignItems:s,justifyContent:n,editable:r=!0,focusable:a=!1}=this.schema;return this.orientation=t,this.wrappable=i,this.alignItems=s,this.justifyContent=n,this.focusable=a,this.editable=r,this.elements=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){v(In,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=F({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=H(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();x(this.container)||(this.container=F({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let t=0;t<e.length;t++){let i=Tn.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.appendChild(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ss.call(this,this.container,t),s.hasChildNodes()&&(this.container.appendChild(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=this.justifyContent,this.container.style.alignItems=this.alignItems,this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=n(st(this.container),this.elements[0]);e===this.btnCollapse&&(e=this.elements[0]);let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},arrowHandler(e,t){if(t===this.container)return!!this.parent&&this.parent.arrowHandler(e,this.container);let i=nt(t,e,this.container);if(x(i)){let e=this.environment.resolveElement(i);return e&&e.focus(),!0}return!!this.parent&&this.parent.arrowHandler(e,this.container)},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Hn=Object.assign({},On,Nn);var Pn=0;const $n=()=>"layout"+Pn++,Dn={stack:(e,t,i)=>Object.create(Vn,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:$n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),wrap:(e,t,i)=>Object.create(Rn,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:$n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(kn,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:$n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),flex:(e,t,i)=>Object.create(Hn,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:$n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}})},Bn={createLayout(e,t,i){const{type:s}=t,n=Dn[s];if(f(n))throw new TypeError(`Missing handler: The '${s}' layout could not be handled`);const r=n(e,t,i);if(f(r))throw new Error(`Bad request: The '${s}' layout could not be created`);return r.createLayout=this.createLayout,f(r.id)&&(r.id=$n()),r}};var Fn=0;const zn={createProjection(e,t,i,s){var r=Object.create(qn,{id:{value:n(t.id,"projection"+Fn++)},model:{value:e},schema:{value:t,writable:!0},environment:{value:s}});return r.concept=i,r}},qn={handlers:null,init(e={}){return this.containers=new Map,this.attributes=[],this.params=[],this.handlers={},this.args=e,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return n(this.getSchema().readonly,!1)},isRoot(){return f(this.parent)},getSchema(e){return this.schema[n(e,this.index)]},getContainer(e){return this.containers.get(n(e,this.index))},getStyle(){const{style:e}=this.getSchema();return e},addParam(e){this.params.push(...Array.isArray(e)?e:[e])},getParam(e){let t=this.params.find((t=>t.name===e));if(f(t))return;const{type:i="string",value:s}=t;return"string"===i?s.toString():"number"===i?+s:"boolean"===i?w(s):void 0},getAttributes(e){return this.attributes.filter((t=>t.name===e))},getField(e){return this.environment.getField(e)},getStatic(e){return this.environment.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},resolveElement(e){return this.environment.resolveElement(e)},getHandlers(e){return n(this.handlers[e],[])},update(e,t,i){if(r(this.containers))return;if("delete"===e)return void this.delete();const s=this.getHandlers(e);if(r(s))switch(e){case"attribute.added":return void this.getAttributes(t.name).forEach((e=>{const{schema:i}=e,s=this.model.createProjection(t.target,i.tag).init();s.parent=this,s.optional=!0;const n=s.render();ss.call(this,n,i.style),s.element.parent=e.parent,e.element=n,e.placeholder&&(e.placeholder.after(n),He(e.placeholder))}));case"attribute.removed":return void this.getAttributes(t.name).forEach((e=>{e.element&&(we(e.element).remove(),e.element=null),e.placeholder&&Ne(e.placeholder)}));default:console.warn(`The message '${e}' is not handled by the element`)}else s.forEach((e=>{e(t,i)}))},delete(){return this.concept&&this.concept.unregister(this),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((e=>{we(e),x(e)&&e.remove()})),this.model.removeProjection(this.id),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(e,t){if(!v(this.handlers,e))return!1;for(let i=0;i<this.handlers[e].length;i++)if(this.handlers[e][i]===t)return this.handlers[e].splice(i,1),!0;return!1},focus(){this.element.focus()},render(){const e=this.getSchema(),{type:t,projection:i,content:s}=e;var r=null;if("layout"===t?(this.element=Bn.createLayout(this.model,n(i,s),this).init(this.args),this.model.registerLayout(this.element)):"field"===t&&(this.element=en.createField(this.model,n(i,s),this).init(this.args),this.model.registerField(this.element)),this.element.focusable=!0,this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),r=this.element.render(),!j(r))throw new Error("Projection element container could not be created");if(this.element.containerless)return this.containers.set(this.index,r),r;if(Object.assign(r.dataset,{projection:this.id,object:this.concept.object,alt:this.schema.length}),this.optional){let e=ae({class:["btn","structure__btn-delete"],title:"Delete",dataset:{action:"delete"}});e.addEventListener("click",(e=>{this.concept.delete()})),r.dataset.deletable=!0,r.classList.add("has-toolbar"),r.prepend(e)}return this.containers.set(this.index,r),r},refresh(){this.editing?this.containers.forEach((e=>{e.tabIndex=0})):this.containers.forEach((e=>{e.tabIndex=null}))},changeView(e){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let t=this.getContainer();this.index=n(e,(this.index+1)%this.schema.length);let i=this.getContainer();return x(i)||(i=this.render()),t.replaceWith(i),this.element=this.resolveElement(i),this.focus(),this},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},Wn=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}],Un={projections:null,fields:null,statics:null,layouts:null,init(e){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this},done(){return this.projections.forEach((e=>{})),this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(e,t){const i=this.getProjectionSchema(e,t);r(i)&&console.warn(e,i,t);const s=zn.createProjection(this,i,e,this.environment);return s.tag=t,this.addProjection(s),s},getProjections(){return this.projections.slice()},getProjection(e){return Number.isInteger(e)?this.projections[e]:this.projections.find((t=>t.id===e))},addProjection(e){if(f(e))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(e),this},removeProjection(e){var t=this.projections.findIndex((t=>t.id===e));return-1!==t&&(this.projections.splice(t,1),!0)},registerField(e){return e.environment=this.environment,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.environment=null,this.fields.delete(t.id)),this},getField(e){return this.fields.get(e)},registerStatic(e){return e.environment=this.environment,this.statics.set(e.id,e),this},unregisterStatic(e){var t=this.statics.get(e.id);return t&&(t.environment=null,this.statics.delete(t.id)),this},getStatic(e){return this.statics.get(e)},registerLayout(e){return e.environment=this.environment,this.layouts.set(e.id,e),this},unregisterLayout(e){var t=this.layouts.get(e.id);return t&&(t.environment=null,this.layouts.delete(t.id)),this},getLayout(e){return this.layouts.get(e)},getMetadata(e){let t=this.schema.find((t=>t.id===e));return t?t.metadata:null},hasConceptProjection(e,t){const i=t=>t.concept.name===e.name;return f(t)?-1!==this.schema.findIndex((e=>i(e))):-1!==this.schema.findIndex((e=>i(e)&&(e=>Array.isArray(e.tags)&&e.tags.includes(t))(e)))},getSchema(){return this.schema},getProjectionSchema(e,t){if(f(e))throw new TypeError("Bad parameter: concept");var i=null;const s=e=>!["template","rule","style"].includes(e);return i=l(e)?this.schema.filter((t=>s(t.type)&&t.concept.name===e)):this.schema.filter((t=>{return s(t.type)&&((t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||!f(i=t.concept.prototype)&&"prototype"!==e.nature&&e.hasPrototype(i));var i})),h(t)&&!r(t)?i.filter((e=>e.tags&&e.tags.includes(t))):i},getTemplateSchema(e){return this.schema.find((t=>"template"===t.type&&t.name===e))},getRuleSchema(e){return this.schema.find((t=>"rule"===t.type&&t.name===e))},getStyleSchema(e){return this.schema.find((t=>"style"===t.type&&t.name===e))},export(){const e=[];return this.getProjections().forEach((t=>{e.push(t.export())})),e}},Jn={container:null,menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,btnCreateModel:null,btnCreateProjection:null,modelFileIO:null,projectionFileIO:null,init(e){return e&&(this.schema=e),this},get isRendered(){return x(this.container)},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this},clear(){return we(this.container),this},update(){},render(){const e=H();return x(this.container)||(this.container=F({class:["editor-home"]})),x(this.menu)||(this.menu=Gn.call(this),e.append(this.menu)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:e,hasProjectionModel:t}=this.editor;return"design"===this.editor.getMode()?(Ne(this.btnCreateModel),Ne(this.btnCreateProjection)):(He(this.btnCreateModel),He(this.btnCreateProjection)),e&&t||this.show(),this.modelFileIO.setFile(e?"file":null),this.projectionFileIO.setFile(t?"file":null),this.btnStart.disabled=!(e&&t),this},bindEvents(){}};function Gn(){const e=$({class:["editor-home-section","editor-home-section--model"]});D({class:["title","editor-home-section__title","font-ui"]},"Modelling activity");let t=F({class:["editor-home-section__content","editor-home-section--model__content"]});this.modelFileIO=Yn.call(this,"model"),this.projectionFileIO=Yn.call(this,"projection"),this.btnCreateModel=Kn("metamodel"),this.btnCreateProjection=Kn("projection");let i=F({class:["editor-home-section__menu"]},[this.modelFileIO.render(),this.btnCreateModel]),s=F({class:["editor-home-section__menu"]},[this.projectionFileIO.render(),this.btnCreateProjection]);return t.append(i,s),this.btnStart=ae({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Start"),e.append(t,this.btnStart),e}function Kn(e){return ae({class:["btn","editor-home-section__button","editor-home-section__button--new"],dataset:{action:`create-${e}`}},`Create a ${e}`)}function Yn(e,t){const i=Object.create(Zn,{editor:{value:this.editor}});return i.init(e,t),i}const Zn={file:null,type:null,title:null,status:null,container:null,btnLoad:null,btnUnload:null,btnReLoad:null,init(e,t){return this.type=e,this.title=n(t,e),this},get hasFile(){return!f(this.file)},getFile(){return this.file},setFile(e){this.file=e,this.refresh()},refresh(){return this.hasFile?this.container.classList.remove("empty"):this.container.classList.add("empty"),this.btnReLoad.disabled=!this.hasFile,this.btnUnload.disabled=!this.hasFile,this},render(){this.container=F({class:["drop-area","editor-home-section__drop-area",`editor-home-section__drop-area--${this.type}`],dataset:{type:this.type}});let e=F({class:["drop-area__file-section"]}),t=Q({class:["icon","file-section__icon"]},`${this.type} {JSON}`),i=F({class:["file-section__actionbar"]});var s;this.btnUnload=ae({class:["btn","file-section__actionbar-button","file-section__actionbar-button--remove"],dataset:{action:`unload-${this.type}`}},"UN.load"),this.btnReLoad=ae({class:["btn","file-section__actionbar-button","file-section__actionbar-button--reload"],dataset:{action:`reload-${this.type}`}},"RE.load"),i.append(this.btnUnload,this.btnReLoad),e.append(t,i),this.btnLoad=ae({class:["btn","drop-area__button","drop-area__button--open"],dataset:{action:`load-${this.type}`}},`Select ${s=this.title.charAt(0),s&&["a","e","i","o","u"].includes(s.toLowerCase())?"an":"a"} ${this.title}`);let n=z({class:["drop-area__instruction"]},[this.btnLoad,"or drop it here"]);return this.container.append(e,n),this.bindEvents(),this.refresh(),this.container},bindEvents(){this.container.addEventListener("dragenter",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragleave",(e=>{this.container.classList.remove("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragover",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("drop",(e=>{this.container.classList.remove("highlight");let t=e.dataTransfer.files[0];if(!t.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=e=>{this.editor.load(i.result,this.type)},i.readAsText(t),e.preventDefault(),e.stopPropagation()}),!1)}},Xn=(e,t)=>{const{name:i,object:s}=t,n=U({class:["selector-concept",`selector-concept--${e}`],dataset:{object:s}});Q({class:["selector-concept-nature","fit-content"]},i);var r=Y({class:["selector-concept-content"]},t.getName());return n.append(r),"ancestor"===e&&r.classList.add("fit-content"),n},Qn={container:null,title:null,visible:!0,conceptList:null,header:null,body:null,get isRendered(){return x(this.container)},init(e={}){return this.schema=e,this},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},update(){},refresh(){const{activeInstance:e,activeConcept:t,hasActiveInstance:i,hasActiveConcept:s}=this.editor;if(!i)return we(this.conceptList),this;const n=e.concept,r=H();if(r.append(Xn("root",n)),!s||n===t)return we(this.conceptList).append(r),this;if(!t.hasParent())return we(this.conceptList).append(r),this;let a=t.getParent(),l=[];for(;a&&a!==n;)l.unshift(a),a=a.getParent();return l.forEach((e=>{r.append(Xn("ancestor",e))})),r.append(Xn("active",t)),we(this.conceptList).append(r),this},render(){const e=H();x(this.container)||(this.container=F({class:["editor-breadcrumb"]})),x(this.notification)||(this.notification=F({class:["notification","breadcrumb-notification"]}),e.appendChild(this.notification));const t=Y({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return e.append(t),x(this.conceptList)||(this.conceptList=W({class:["bare-list","selector-concepts"]}),e.append(this.conceptList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},er={container:null,actionList:null,notification:null,schema:null,isOpen:!1,visible:!0,get isRendered(){return x(this.container)},init(e){return e&&(this.schema=e),this},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},open(){return 0===this.actionList.childElementCount?(this.notify("The menu is empty",1500),this):(this.container.classList.add("open"),this.show(),this.isOpen=!0,this)},close(){return this.container.classList.remove("open"),this.isOpen=!1,this},clear(){return we(this.container),this},update(e){e&&(this.schema=e);const{actions:t}=this.schema,i=H();t.filter((e=>n(e.default,!0))).forEach((e=>{const{name:t,content:s,handler:r}=e;let a=ae({class:["btn","menu-action__button"],dataset:{action:t,handler:!0}},n(s,t)),l=U({class:["menu-action-list-item"]},a);i.append(l)})),we(this.actionList).append(i),this.schema=e},notify(e,t=4500){let i=function(e,t="normal"){var i=Y({class:["notification-message",`notification-message--${t}`]},e);return Array.isArray(e)?i.style.minWidth=`${Math.min(.6*e[0].length,30)}em`:i.style.minWidth=`${Math.min(.6*e.length,30)}em`,i}(e);const s="open";if(this.notification.classList.contains(s))return!1;this.notification.appendChild(i),setTimeout((()=>{this.notification.classList.add(s),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(s),this.container.classList.remove("menu--notifying"),setTimeout((()=>{we(this.notification)}),500)}),t)},render(){const e=H();x(this.container)||(this.container=F({class:["menu"],draggable:!0,title:"Click to access the editor actions",dataset:{action:"menu.click",handler:!0}})),x(this.notification)||(this.notification=F({class:["notification","menu-notification"]}),e.appendChild(this.notification));const t=Y({class:["menu-title"],dataset:{ignore:"all"}},"Menu");return e.append(t),x(this.actionList)||(this.actionList=W({class:["bare-list","menu-action-list"]}),e.append(this.actionList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.update(),this.refresh(),this.container},refresh(){return this.editor.isReady?this.show():this.hide(),this},bindEvents(){this.editor.registerHandler("menu.click",(()=>this.isOpen?this.close():this.open()))}},tr={container:null,schema:null,isOpen:!1,visible:!0,btnStart:null,modelFileIO:null,projectionFileIO:null,get isRendered(){return x(this.container)},init(e){return e&&(this.schema=e),this},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this},clear(){return we(this.container),this},update(){},render(){const e=H();return x(this.container)||(this.container=F({class:["editor-style"]})),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.close(),this.refresh(),this.container},refresh(){return this},bindEvents(){}},ir={container:null,schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(e){return e&&(this.schema=e),this},get isRendered(){return x(this.container)},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this},add(e,t,i="normal"){let s=W({class:["bare-list","log-item-messages"]});e.forEach((e=>s.append(U({class:["log-item-message"]},e.toString()))));let r=U({class:["log-item",`log-item--${i}`]}),l=ae({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},"✖"),o=Y({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${n(t,"Log")} (${y=Date.now(),c=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f(e))return new Date;if(a(e))return e;var i=new Date(e),s=i.getTime();return Number.isNaN(s)?new Date:t?new Date(s+6e4*i.getTimezoneOffset()):i}(y,!1),h="yyyy-mm-dd hh:MM",u=c.getDate(),d=c.getMonth()+1,p=c.getFullYear().toString(),m=c.getHours(),b=c.getMinutes(),v=c.getSeconds(),g=function(e){return e<10?"0".concat(e):e},h.replace("yyyy",p).replace("yy",p.slice(-2)).replace("mm",g(d)).replace("m",d).replace("dd",g(u)).replace("d",u).replace("hh",g(m)).replace("h",m).replace("MM",g(b)).replace("M",b).replace("ss",g(v)).replace("s",v)})`);var c,h,u,d,p,m,b,v,g,y;return r.append(l,o,s),this.logList.append(r),this.refresh(),this},clear(){return we(this.logList),this},update(){},render(){const e=H();return x(this.container)||(this.container=F({class:["editor-log"]})),x(this.logList)||(this.logList=W({class:["bare-list","log-list"]}),e.append(this.logList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}};function sr(e,t,i){return Object.create(nr,{object:{value:"selector"},model:{value:i},type:{value:e},editor:{value:t}})}const nr={container:null,list:null,editor:null,dataList:null,fetch:null,init(e){return this.fetch=e,this},render(){const e=H();return x(this.container)||(this.container=F({class:["container","container--editor-selectors"]})),x(this.list)||(this.list=W({class:["bare-list","editor-selectors","font-ui"]}),e.append(this.list)),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){return this.dataList=this.fetch(),we(this.list),this.dataList.forEach((e=>{const{concept:t,accept:i}=e;let s=B({class:["title","editor-selector__title"]},`${e.name||e.type}`);t&&s.append(Y({class:["editor-selector__title-concept"]},(t.name||t.prototype).replace(" ","-").toLowerCase())),i&&s.append(Y({class:["editor-selector__title-accept"]},i.name));let n=ae({class:["btn","btn-collapse"],dataset:{action:"collapse",rel:"parent",target:"selector"}}),r=P({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[s,n]),a=rr[this.type],l=F({class:["editor-selector__preview"]},a(e)),o=ar[this.type],c=F({class:["editor-selector__action-bar"]},o(e)),h=U({class:["editor-selector","collapsed","font-ui"],title:e.description,tabindex:0,dataset:{type:this.type,name:"selector",projection:e.id}},[r,l,c]);n.dataset.state=h.classList.contains("collapsed")?"ON":"OFF",this.list.appendChild(h)})),this.refresh(),this},show(){return Ne(this.container),this},hide(){return He(this.container),this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{action:i,type:s,id:n,concept:r}=t.dataset;"global"===i&&this.editor.projectionModel.changeProjection({global:t.checked})}))}},rr={projection:e=>{const{concept:t,tags:i=[]}=e,s=H();let n=Y({class:["editor-selector__preview-concept"]},t.name||t.prototype),r=W({class:["bare-list","editor-selector__preview-tags"]});return i.forEach((e=>r.append(U({class:["editor-selector__preview-tag"]},e)))),s.append(n,r),s},value:e=>{if(f(e))return X({class:["editor-selector__preview-null"]},"null");const{name:t,nature:i,value:s,attributes:n}=e;if(["string","number","boolean"].includes(t))return Y({class:["editor-selector__preview-text"]},s);if("set"===t){let e=W({class:["bare-list","editor-selector__preview-list"]});return s.forEach((t=>{let i=U({class:["editor-selector__preview-list-item"]},rr.value(t));e.append(i)})),e}if("prototype"===i){let e=H(),t=Y({class:["editor-selector__preview-text"]},s.name);return e.append(t,rr.value(s)),e}if(n){let e=W({class:["bare-list","editor-selector__preview-attributes"]});return n.forEach((t=>{const{name:i,value:s}=t;let n=Y({class:["editor-selector__preview-text","editor-selector__preview-text--attribute"]},i),r=U({class:["editor-selector__preview-attribute"]},[n,rr.value(s)]);e.append(r)})),e}return s?rr.value(s):e.toString()},concept:e=>{const t=H();if(Array.isArray(e.attributes)){let i=W({class:["bare-list","editor-selector__attributes"]});e.attributes.forEach((e=>{const{name:t,required:s,target:n={}}=e;let r=Y({class:["editor-selector__preview-text","editor-selector__preview-text--attribute"]},t),a=Y({class:["editor-selector__preview-text","editor-selector__preview-text--target"]},n.name);n.accept&&a.append(Y({class:["editor-selector__preview-text--target-accept"]},n.accept.name));let l=U({class:["editor-selector__attribute"]},[r,a]);s&&(l.classList.add("required"),Q({class:["editor-selector__badge"]})),i.append(l)})),t.append(i)}return t},resource:e=>H()},ar={projection:e=>{const t=H();ee({type:"checkbox",class:["checkbox","editor-selector__action-bar-checkbox","editor-selector__action-bar-checkbox--global"],checked:w(e.global),dataset:{action:"global",id:e.id}});let i=ae({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:e.id}},"Edit");return t.append(i),t},value:e=>{const t=H();let i=ae({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:e.id}},"Copy"),s=ae({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:e.id}},"Delete");return t.append(i,s),t},concept:e=>{const t=H();let i=ae({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance",concept:e.name}},"Create");return t.append(i),t},resource:e=>{const t=H();let i=ae({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:e.name}},"Delete");return t.append(i),t}};function lr(e){let t=U({class:["tab","editor-header-tab"],tabindex:0,dataset:{value:e,action:`selector-${e}`}}),i=Y({class:["editor-header-tab__content"]},e);return t.append(i),t}const or={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,body:null,btnClose:null,btnHome:null,get isRendered(){return x(this.container)},init(e){return e&&(this.editor=e),this._conceptSelector=sr("concept",this.editor).init((()=>this.editor.hasConceptModel?this.editor.getRoots().map((e=>this.editor.conceptModel.getCompleteModelConcept(e))):[])),this._valueSelector=sr("value",this.editor).init((()=>this.editor.hasConceptModel?this.editor.conceptModel.getValues():[])),this._projectionSelector=sr("projection",this.editor).init((()=>this.editor.hasProjectionModel?this.editor.projectionModel.schema.filter((e=>"template"!==e.type)):[])),this._resourceSelector=sr("resource",this.editor).init((()=>this.editor.resources)),this},render(){const e=H();x(this.container)||(this.container=F({class:["editor-header"],dataset:{name:"editor-header"}})),x(this.title)||(this.title=Y({class:["editor-header-title"]},"Editor")),this.tabs=W({class:["bare-list","tabs","editor-header-tabs"]}),this.tabConcept=lr("concept"),this.tabConceptNotification=Q({class:["editor-selector__notification","hidden"]}),this.tabConcept.prepend(this.tabConceptNotification),this.tabValue=lr("value"),this.tabValueNotification=Q({class:["editor-selector__notification","hidden"]}),this.tabValue.prepend(this.tabValueNotification),this.tabProjection=lr("projection"),this.tabProjectionNotification=Q({class:["editor-selector__notification","hidden"]}),this.tabProjection.prepend(this.tabProjectionNotification),this.tabResource=lr("resource"),this.tabResourceNotification=Q({class:["editor-selector__notification","hidden"]}),this.tabResource.prepend(this.tabResourceNotification),this.tabs.append(this.tabConcept,this.tabValue,this.tabResource),this.activeTab=this.tabs.children[0],this.activeTab.classList.add("selected"),this.activeTabValue=this.activeTab.dataset.value,this.btnClose=ae({class:["btn","editor-toolbar__button","btn-close"],dataset:{action:"close"}}),this.btnHome=ae({class:["btn","editor-toolbar__button","btn-home"],dataset:{action:"home"}});let t=F({class:["editor-toolbar"]},[this.btnHome,this.btnClose]);return x(this.menu)||(this.menu=F({class:["editor-header-menu"]},[this.title,this.tabs,t]),e.append(this.menu)),x(this.body)||(this.body=F({class:["editor-header-main"]}),e.append(this.body)),x(this.btnCollapse)||(this.btnCollapse=ae({class:["btn","editor-header__button","btn-collapse"],dataset:{action:"collapse",rel:"parent",target:"editor-header"}}),e.append(this.btnCollapse)),x(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),x(this._valueSelector.container)||this.body.append(this._valueSelector.render()),x(this._projectionSelector.container)||this.body.append(this._projectionSelector.render()),x(this._resourceSelector.container)||this.body.append(this._resourceSelector.render()),this.btnCollapse.dataset.state=this.container.classList.contains("collapsed")?"ON":"OFF",e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},refresh(){if(v(this.editor.config,"name")&&(this.title.textContent=`Editor – ${this.editor.config.name}`),this.editor.concept)return this.title.textContent=`Editor – ${this.editor.config.name} : ${this.editor.concept.name}`,He(this.tabs),void He(this.body);this.editor.hasConceptModel?(Ne(this.tabs),Ne(this.body),Ne(this.btnCollapse)):(He(this.tabs),He(this.body),He(this.btnCollapse));let e=cr[this.activeTabValue];return o(e)&&e.call(this),this.valueCount>0?(this.tabValueNotification.textContent=this.valueCount,Ne(this.tabValueNotification)):He(this.tabValueNotification),this.fileCount>0?(this.tabResourceNotification.textContent=this.fileCount,Ne(this.tabResourceNotification)):He(this.tabResourceNotification),this},updateSelector(e){const{value:t}=e.dataset;this.activeTabValue!==t&&e.parentElement===this.tabs&&(this.activeTab.classList.remove("selected"),this.activeTabValue=t,this.activeTab=e,this.activeTab.classList.add("selected"),this.refresh())},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},bindEvents(){this.tabs.addEventListener("click",(e=>{const{target:t}=e;let i=hr.call(this,t);this.updateSelector(i)})),ht("value.added",(e=>{this.valueCount++,this.refresh()})),ht("value.removed",(e=>{this.refresh()})),ht("resource.added",(e=>{this.fileCount++,this.refresh()})),ht("resource.removed",(e=>{this.refresh()}))}},cr={concept:function(){this._conceptSelector.update(),this._conceptSelector.show(),He(this.tabConceptNotification),this._valueSelector.hide(),this._projectionSelector.hide(),this._resourceSelector.hide()},projection:function(){this._projectionSelector.update(),this._projectionSelector.show(),He(this.tabProjectionNotification),this._conceptSelector.hide(),this._valueSelector.hide(),this._resourceSelector.hide()},value:function(){this._valueSelector.update(),this.valueCount=0,this._valueSelector.show(),He(this.tabValueNotification),this._conceptSelector.hide(),this._projectionSelector.hide(),this._resourceSelector.hide()},resource:function(){this._resourceSelector.update(),this.fileCount=0,this._resourceSelector.show(),He(this.tabResourceNotification),this._conceptSelector.hide(),this._projectionSelector.hide(),this._valueSelector.hide()}};function hr(e){const t=e=>e.parentElement===this.tabs;return t(e)?e:ge(e,t,10)}const ur={container:null,title:null,visible:!0,menu:null,header:null,body:null,btnCollapse:null,btnMaximize:null,btnResize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,get isRendered(){return x(this.container)},init(e={}){return this.schema=e,this},collapse(){return this.collapsed=!this.collapsed,this.collapsed&&(this.fullscreen=!1),this.refresh(),this},resize(){return this.size=this.size%2+1,this.refresh(),this},maximize(){return this.fullscreen=!this.fullscreen,this.refresh(),this},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},refresh(){var e;return this.container.dataset.size=`${this.size}`,this.fullscreen?this.container.classList.add("focus"):this.container.classList.remove("focus"),this.collapsed?(e=this.container,x(e)&&e.classList.add(ke)):function(e){x(e)&&e.classList.remove(ke)}(this.container),this},render(){const e=H();x(this.container)||(this.container=F({class:["editor-concept"],dataset:{nature:"concept-container",size:1}}));const{name:t}=this.concept;x(this.header)||(this.header=P({class:["editor-concept-header"]}),e.append(this.header)),e.append(this.projection.render()),x(this.btnClose)||(this.btnClose=ae({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete ${t.toLowerCase()}`,dataset:{action:"close",context:this.type,id:this.id}})),x(this.btnCollapse)||(this.btnCollapse=ae({class:["btn","editor-concept-toolbar__btn-collapse"],title:`Collapse ${t.toLowerCase()}`,dataset:{action:"collapse",context:this.type,id:this.id}})),x(this.btnMaximize)||(this.btnMaximize=ae({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${t.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),x(this.btnResize)||(this.btnResize=ae({class:["btn","editor-concept-toolbar__btn-resize"],title:`Resize ${t.toLowerCase()}`,dataset:{action:"resize",context:this.type,id:this.id}}));let i=D({class:["title","editor-concept-title","fit-content"]},t),s=F({class:["editor-concept-toolbar"]},[this.btnCollapse,this.btnResize,this.btnMaximize,this.btnClose]);return we(this.header).append(i,s),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},actionHandler(e){switch(e){case"collapse":this.collapse();break;case"resize":this.resize();break;case"maximize":this.maximize();break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",Ge.ERROR),this;break;case"DELETE-PROJECTION":if(!this.projection.delete())return this.notify("The projection could not be deleted",Ge.ERROR),this}we(this.container).remove(),this.editor.removeInstance(this.id)},bindEvents(){this.container.addEventListener("focusin",(e=>{this.editor.updateActiveInstance(this)}))}};var dr=0;function pr(){return Object.create(or,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function mr(){return Object.create(er,{object:{value:"environment"},name:{value:"editor-menu"},type:{value:"menu"},editor:{value:this}})}function fr(){return Object.create(Qn,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function br(){return Object.create(Jn,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}})}function vr(){return Object.create(tr,{object:{value:"environment"},name:{value:"editor-style"},type:{value:"style"},editor:{value:this}})}function gr(){return Object.create(ir,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}})}const yr={root:[],mode:Ye,header:{css:["editor-header"]},body:{css:["editor-body"]},menu:{actions:[{name:"export"}],css:["editor-menu"]}},Er=e=>x(e,["input","textarea"])||"true"===e.contentEditable,wr={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeInstance:null,container:null,header:null,body:null,footer:null,instanceSection:null,navigationSection:null,breadcrumb:null,menu:null,home:null,style:null,logs:null,input:null,copyValue:null,activeElement:null,config:null,active:!1,visible:!1,handlers:null,instances:null,resources:null,init(e={}){const{conceptModel:t,projectionModel:i,config:s=yr,handlers:n={}}=e;this.conceptModel=t,this.projectionModel=i,this.config=s,this.handlers={},this.instances=new Map,this.resources=new Map;for(const e in n){const t=n[e];this.registerHandler(e,t)}return this.config&&(this.header=pr.call(this).init()),this.menu=mr.call(this).init(this.config.menu),this.home=br.call(this).init(this.config.home),this.breadcrumb=fr.call(this).init(this.config.breadcrumb),this.style=vr.call(this).init(this.config.style),this.logs=gr.call(this).init(this.config.logs),this.render(),this.isReady&&this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this},setConfig(e){if(f(e))return!1;this.config=e,this.menu.update(this.config.menu),this.home.update(this.config.home),this.style.update(this.config.style),this.logs.update(this.config.logs)},getRoots(){const{root:e=[]}=this.config;return r(e)?this.conceptModel.getSchema("concrete"):e},getMode(){return n(this.config.mode,Ye)},createInstance(e,t,i){if(f(e))return this.notify("The concept is not valid",Ge.ERROR),!1;let s=n(t,this.projectionModel.createProjection(e).init()),r=Object.create(ur,{id:{value:"instance"+dr++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:e},projection:{value:s},editor:{value:this}});const a=Object.assign({minimize:!0,resize:!0,maximize:!0,close:"DELETE-CONCEPT"},i);return r.init(a),this.addInstance(r)},getInstance(e){return this.instances.get(e)},addInstance(e){return e.isRendered||this.instanceSection.appendChild(e.render()),this.instances.set(e.id,e),this.updateActiveInstance(e),e},removeInstance(e){return this.instances.delete(e)},get hasConceptModel(){return!f(this.conceptModel)},get hasProjectionModel(){return!f(this.projectionModel)},get isReady(){return this.hasConceptModel&&this.hasProjectionModel},get hasActiveConcept(){return!f(this.activeConcept)},get hasActiveProjection(){return!f(this.activeProjection)},get hasActiveInstance(){return!f(this.activeInstance)},createConcept(e){if(f(e))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(e)?this.conceptModel.createConcept(e):(this.notify(`The concept '${e}' is not defined in the model`,Ge.ERROR),!1)},addConcept(e){Array.isArray(e)?this.conceptModel.schema.push(...e):this.conceptModel.schema.push(e),this.refresh()},createProjection(e,t){if(f(e))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(e,t)?this.projectionModel.createProjection(e,t).init():(this.notify(`The projection for the concept '${e.name}' is not defined in the model`,Ge.ERROR),!1)},addProjection(e){Array.isArray(e)?this.projectionModel.schema.push(...e):this.projectionModel.schema.push(e),this.refresh()},getField(e){if(!x(e))return console.warn("Field error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(i)?this.projectionModel.getField(t):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(e){if(!x(e))return console.warn("Static error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Static error: Missing id attribute on field"),null):["static"].includes(i)?this.projectionModel.getStatic(t):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(e){if(!x(e))return console.warn("Layout error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(i)?this.projectionModel.getLayout(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(e){if(!x(e))return null;const{nature:t}=e.dataset;if(f(t))return null;let i=null;switch(t){case"field":case"field-component":i=this.getField(e);break;case"layout":case"layout-component":i=this.getLayout(e);break;case"static":i=this.getStatic(e)}return i&&(i.environment=this),i},download(e,t,i){const s="application/json";window.URL=window.webkitURL||window.URL;var r=J({class:["bare-link","download-item__link"]},"Download");p(r.href)||window.URL.revokeObjectURL(r.href);var a=new Blob([JSON.stringify(e)],{type:s});return Object.assign(r,{download:`${n(t,(new Date).getTime())}.json`,href:window.URL.createObjectURL(a)}),r.dataset.downloadurl=[s,r.download,r.href].join(":"),r.click(),this.notify("The model has been downloaded",Ge.SUCCESS),setTimeout((()=>{window.URL.revokeObjectURL(r.href),r.remove()}),1500),e},export(e=!1){const t="application/json";window.URL=window.webkitURL||window.URL;var i=J({});this.container.appendChild(i),p(i.href)||window.URL.revokeObjectURL(i.href);const s={concept:this.conceptModel.schema,values:this.conceptModel.export(),projection:this.projectionModel.schema,editor:this.config};var n=new Blob([JSON.stringify(s)],{type:t});return Object.assign(i,{download:"model.json",href:window.URL.createObjectURL(n)}),i.dataset.downloadurl=[t,i.download,i.href].join(":"),e?(function(e){if(f(e))return!1;var t=te({value:x(e)?e.textContent:e.toString(),readonly:!0});x(t)&&(document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove())}(JSON.stringify(s)),this.notify("The model has been copied to clipboard",Ge.SUCCESS)):(i.click(),this.notify("The model has been downloaded",Ge.SUCCESS)),setTimeout((()=>{window.URL.revokeObjectURL(i.href),i.remove()}),1500),s},notify(e,t,i=4500){let s=z({class:["notify"],html:e});t&&s.classList.add(t),this.container.appendChild(s),setTimeout((()=>{s.classList.add("open")}),50),setTimeout((()=>{s.classList.remove("open"),setTimeout((()=>{s.remove()}),500)}),i)},addResource(e){return this.resources.set(e.name,e),ut("resource.added",e),this.refresh(),e},removeResource(e){return this.resources.delete(e),ut("resource.removed",e),this.refresh(),!0},copy(e){return this.copyValue=e,this.notify(`${e.name} copied`,Ge.NORMAL),this},paste(e,t){let i=n(t,this.copyValue);return e.initValue(i),this},show(){return Ne(this.container),this.visible=!0,this},hide(){return He(this.container),this.visible=!1,this},toggle(){return Pe(this.container),this.visible=!this.visible,this},open(){return this.show(),this.active=!0,ut("editor.open"),this},reduce(){return this.hide(),this.active=!0,ut("editor.reduce"),this},close(){return this.hide(),this.active=!1,this.clean(),this.container.remove(),this.manager.deleteEditor(this),ut("editor.close"),this},unloadConceptModel(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this},loadConceptModel(e,t){return Array.isArray(e)?r(e)?(this.notify("The concept model is empty",Ge.ERROR),!1):(this.unloadConceptModel(),this.clear(),this.conceptModel=es.createModel(e).init(t),f(this.conceptModel),this.hasProjectionModel&&this.projectionModel.done(),ut("model.changed",this.conceptModel),this.refresh(),this):(this.notify("Invalid concept model",Ge.ERROR),!1)},unloadProjectionModel(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this},loadProjectionModel(e,t){return Array.isArray(e)?r(e)?(this.notify("The projection model is empty",Ge.ERROR),!1):(this.unloadProjectionModel(),this.clear(),this.projectionModel=function(e,t){return Object.create(Un,{schema:{value:[...e,...Wn]},environment:{value:t}})}(e,this).init(t),f(this.projectionModel),ut("model.changed",this.projectionModel),this.refresh(),this):(this.notify("Invalid projection model",Ge.ERROR),!1)},load(e,t){let i=new FileReader;if("model"===t)i.onload=e=>{const t=JSON.parse(i.result);if(Array.isArray(t))this.loadConceptModel(t);else{const{concept:e,values:i=[],projection:s=[],editor:n}=t;this.loadConceptModel(e,i),r(s)||(this.notify("A projection was found in the model.",Ge.NORMAL,2e3),setTimeout((()=>{this.loadProjectionModel(s)}),30)),n&&this.setConfig(n)}},i.readAsText(e);else if("projection"===t)i.onload=e=>{const t=JSON.parse(i.result);if(Array.isArray(t))this.loadProjectionModel(t);else{const{projection:e,views:i=[]}=t;this.loadProjectionModel(e,i)}},i.readAsText(e);else{if("resource"!==t)return this.notify(`File type '${t}' is not handled`,Ge.WARNING),!1;this.addResource(e)}return!0},unload(){return this.unloadConceptModel(),this.unloadProjectionModel(),this.clear(),this},clean(){return this.conceptModel,this.projectionModel,we(this.container),ut("editor.clean"),this},clear(){return this.instanceSection&&we(this.instanceSection),this.activeElement=null,this.activeConcept=null,this.activeProjection=null,ut("editor.clear"),this},render(e){const t=H();return this.home.isRendered||t.appendChild(this.home.render()),this.style.isRendered||t.appendChild(this.style.render()),this.header.isRendered||t.appendChild(this.header.render()),x(this.body)||(this.body=F({class:["editor-body"],tabindex:0}),this.navigationSection=$({class:["model-navigation-section"]}),this.instanceSection=$({class:["model-concept-section"]}),this.body.append(this.navigationSection,this.instanceSection),t.appendChild(this.body)),x(this.footer)||(this.footer=F({class:["editor-footer"],tabindex:0}),this.logs.isRendered||this.footer.append(this.logs.render()),t.appendChild(this.footer)),this.breadcrumb.isRendered||this.navigationSection.appendChild(this.breadcrumb.render()),this.menu.isRendered||t.appendChild(this.menu.render()),x(this.input)||(this.input=ee({type:"file",class:["hidden"],accept:".json"}),t.appendChild(this.input)),t.hasChildNodes()&&(this.container.appendChild(t),this.bindEvents()),x(e)&&e.appendChild(this.container),this.refresh(),this.container},refresh(){return this.hasConceptModel?this.container.classList.remove("no-concept-model"):this.container.classList.add("no-concept-model"),this.hasProjectionModel?this.container.classList.remove("no-projection-model"):this.container.classList.add("no-projection-model"),this.header.refresh(),this.breadcrumb.refresh(),this.menu.refresh(),this.home.refresh(),this.style.refresh(),this.logs.refresh(),this},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.activeElement=e),this},updateActiveConcept(e){return this.activeConcept&&this.activeConcept===e||(this.activeConcept=e,this.refresh()),this},updateActiveProjection(e){return this.activeProjection&&this.activeProjection===e||(this.activeProjection=e,this.refresh()),this},updateActiveInstance(e){if(this.activeInstance){if(this.activeInstance===e)return this;this.activeInstance.container.classList.remove("active")}return this.activeInstance=e,this.activeInstance.container.classList.add("active"),this.refresh(),this},getHandlers(e){return n(this.handlers[e],[])},triggerEvent(e,t){const{name:i,options:s}=e;return this.getHandlers(i).forEach((e=>{let i=e.call(this,this.conceptModel,s);o(t)&&t.call(this,i)})),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(e,t){if(!v(this.handlers,e))return!1;for(let i=0;i<this.handlers[e].length;i++)if(this.handlers[e][i]===t)return this.handlers[e].splice(i,1),!0;return!1},bindEvents(){var e=null,t=null;const i={open:e=>{const{context:t}=e.dataset;t?this[t].open():this.open()},close:e=>{const{context:t,id:i,type:s}=e.dataset;t?this[t].close():this.close()},collapse:e=>{const{rel:t,target:i}=e.dataset;if("parent"===t){let t=ge(e,(e=>e.dataset.name===i));x(t)&&(t.classList.toggle("collapsed"),e.dataset.state=t.classList.contains("collapsed")?"ON":"OFF")}},delete:e=>{const{target:t}=e.dataset;if("parent"===t){let t=e.parentElement;we(t),t.remove()}},"delete:value":e=>{const{id:t}=e.dataset;this.conceptModel.removeValue(t)},"delete:resource":e=>{const{id:t}=e.dataset;this.editor.removeResource(t)},style:e=>{this.style.toggle()},home:e=>{this.home.toggle()},logs:e=>{this.logs.toggle()},export:e=>{this.export()},"export--copy":e=>{this.export(!0)},"create-instance":e=>{const{concept:t}=e.dataset;this.createInstance(this.createConcept(t))},"copy:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t);this.copy(i)},"load-resource":e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="resource",this.input.dispatchEvent(i)},"load-model":e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="model",this.input.dispatchEvent(i)},"unload-model":e=>{this.unloadConceptModel()},"reload-model":e=>{const{schema:t,values:i}=this.projectionModel;this.loadConceptModel(t,i)},"load-projection":e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="projection",this.input.dispatchEvent(i)},"unload-projection":e=>{this.unloadProjectionModel()},"reload-projection":e=>{const{schema:t,views:i}=this.projectionModel;this.loadProjectionModel(t,i)}};this.container.addEventListener("click",(e=>{var t=function(e){const t=e=>!v(e.dataset,"ignore");return t(e)?e:ge(e,t,10)}(e.target);const{action:s,context:n,id:r,handler:a}=t.dataset;if("instance"===n)return void this.getInstance(r).actionHandler(s);this.activeElement&&this.activeElement.clickHandler(t);const l=i[s];a&&s?this.triggerEvent({name:s}):o(l)?(l(t),t.blur()):s&&this.triggerEvent({name:s})}),!0),this.input.addEventListener("change",(e=>{let i=this.input.files[0];this.load(i,t),t=null,this.input.value=""})),this.body.addEventListener("keydown",(t=>{const{target:i}=t,{nature:s}=i.dataset;var n=!1;switch(t.key){case De:this.activeElement&&e!==Fe&&!0===this.activeElement.backspaceHandler(i)&&t.preventDefault();break;case Fe:t.preventDefault(),n=!0;break;case Je:this.activeElement&&e!==Fe&&this.activeElement.deleteHandler(i)&&t.preventDefault();break;case" ":this.activeElement&&e!==Fe&&this.activeElement.spaceHandler(i)&&t.preventDefault();break;case"Alt":t.preventDefault(),n=!0;break;case Be:this.activeElement?!0===this.activeElement.enterHandler(i)&&t.preventDefault():"BUTTON"===i.tagName?(i.click(),t.preventDefault()):t.preventDefault();break;case ze:this.activeElement&&!0===this.activeElement.escapeHandler(i)&&t.preventDefault();break;case"Insert":this.activeElement&&t.preventDefault();break;case qe:this.activeElement&&!0===this.activeElement.arrowHandler("up",i)&&t.preventDefault();break;case Ue:this.activeElement&&!0===this.activeElement.arrowHandler("down",i)&&t.preventDefault();break;case We:this.activeElement&&!0===this.activeElement.arrowHandler("right",i)&&t.preventDefault();break;case"ArrowLeft":this.activeElement&&!0===this.activeElement.arrowHandler("left",i)&&t.preventDefault();break;case"s":e===Fe&&(this.activeConcept.copy(),t.preventDefault());break;case"c":e===Fe&&(Er(i)||(this.copy(this.activeConcept.copy(!1)),t.preventDefault()));break;case"v":e===Fe&&(Er(i)||(this.paste(this.activeConcept),t.preventDefault()));break;case"e":e===Fe&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{close:"DELETE-PROJECTION"}),t.preventDefault())}n&&(e=t.key)}),!1),this.body.addEventListener("keyup",(t=>{var i=t.target;switch(t.key){case" ":e===Fe&&this.activeElement&&this.activeElement._spaceHandler(i);break;case Je:e===Fe&&this.activeElement&&this.activeElement.delete(i);break;case Fe:e===Fe&&this.activeElement&&this.activeElement.controlHandler(i)}e=-1}),!1),this.body.addEventListener("focusin",(e=>{const{target:t}=e,i=this.resolveElement(t);if(i&&i.projection.focusable&&i.focusable){if(this.activeElement&&this.activeElement!==i&&(this.activeElement.focusOut(),this.activeElement=null),f(i)||i===this.activeElement)return void(this.activeElement&&this.activeElement._focusIn(t));this.updateActiveElement(i),this.activeElement.focusIn(t)}else i||(this.activeElement&&this.activeElement.focusOut(t),this.activeElement=null);if(this.activeElement){let e=this.activeElement.projection;this.updateActiveProjection(e),this.updateActiveConcept(e.concept)}}));var s=null;this.container.addEventListener("dragstart",(e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("clientX",e.clientX),e.dataTransfer.setData("clientY",e.clientY),s=e.target,this.body.classList.add("dragging")})),this.container.addEventListener("dragend",(e=>{this.body.classList.remove("dragging"),s=null})),this.body.addEventListener("drop",(e=>{var t=e.dataTransfer.getData("clientX"),i=e.dataTransfer.getData("clientY");s.style.top=`${Math.max(s.offsetTop-(i-e.clientY),0)}px`,s.style.left=`${Math.max(s.offsetLeft-(t-e.clientX),0)}px`})),this.body.addEventListener("dragover",(e=>{e.preventDefault()})),this.registerHandler("build-concept",Xt),this.registerHandler("build-projection",xt),this.registerHandler("export",(()=>this.export())),this.registerHandler("copy",(()=>this.export(!0))),this.registerHandler("load-resource",(()=>{let e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="resource",this.input.dispatchEvent(e)})),ht("model.changed",(()=>{this.isReady&&this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)}))}))}};function Cr(){return this.model.concepts.filter((e=>this.metamodel.isConcrete(e.name)))}const jr={metamodel:null,model:null,concept:null,container:null,header:null,body:null,footer:null,selectorElement:null,selectorList:null,input:null,results:null,active:!1,fields:null,init(e,t,i){return this.metamodel=e,this.model=t,this.concept=i,this.fields=new Map,this.render(),this},registerField(e){return e.editor=this,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.editor=null,this.fields.delete(t.id)),this},open(){return this.active=!0,Ne(this.container),this.container.classList.replace("close","open"),this.input.focus(),ut("explorer.open"),this},close(){return this.active=!1,He(this.container),this.container.classList.replace("open","close"),ut("explorer.close"),this},clear(){return we(this.results),this.input.value="",this},render(e){const t=H();if(!x(this.header)){this.header=F({class:["explorer-header"],tabindex:-1});let e=ae({class:["btn","btn-close"],dataset:{action:"close"}}),i=F({class:["explorer-toolbar"]},[e]);this.header.appendChild(i);const{refname:s,name:n}=this.activeConcept;this.concept&&this.header.appendChild(F({class:["explorer-header-concept"]},`${s} (${n})`)),t.appendChild(this.header)}return x(this.body)||(this.body=F({class:["explorer-body"],tabindex:-1}),t.appendChild(this.body)),x(this.footer)||(this.footer=F({class:["editor-footer"],tabindex:-1}),t.appendChild(this.footer)),x(this.selectorElement)||(this.selectorElement=ae({class:["btn","explorer-header-concept","hidden"]}),this.header.appendChild(this.selectorElement)),x(this.selectorList)||(this.selectorList=W({class:["bare-list","explorer-selector-list","hidden"]}),t.appendChild(this.selectorList)),x(this.input)||(this.input=ee({class:["explorer-input","hidden"],placeholder:"Rechercher..."}),t.appendChild(this.input)),x(this.results)||(this.results=W({class:["bare-list","explorer-results"]}),this.body.appendChild(this.results)),t.hasChildNodes()&&(this.container.appendChild(t),this.bindEvents()),x(e)&&e.appendChild(this.container),this.clear(),this.refresh(),this.container},update(e){const t=H();return t.appendChild(U({class:["explorer-result-title"]},"Attribute")),e.filter((e=>"attribute"===e.type)).forEach((e=>{var i=`${e.target}${e.accept?`:${e.accept}`:""}`;t.appendChild(Lr(e,"Target concept",i))})),t.appendChild(U({class:["explorer-result-title"]},"Component")),e.filter((e=>"component"===e.type)).forEach((e=>{var i=e.attributes.join(", ");t.appendChild(Lr(e,"Attributes",i))})),we(this.results),this.results.appendChild(t),this},refresh(){return f(this.concept)?(we(this.selectorList),Cr.call(this).forEach((e=>{var t=this.metamodel.getProjectionSchema(e.name).filter((e=>"explorer"===e.environment)),i=zn.createProjection(t,e,this).init(),s=U({class:["explorer-selector","explorer-selector--concept"],dataset:{concept:e.id}},i.render());this.selectorList.appendChild(s)})),Ne(this.selectorList),He(this.results),He(this.selectorElement)):(Ne(this.selectorElement),He(this.selectorList),Ne(this.results),this.update(this.concept.getStructure())),this},query(e){var t=this.concept.getStructure().slice(0);if(!p(e)){var i=e.trim().replace(/\s+/g," ").split(" ");t=t.filter((e=>i.some((t=>{let i=!1;return e.alias&&(i=e.alias.includes(t)),i||e.name.includes(t)}))))}return this.update(t),this},bindEvents(){var e=0;this.container.addEventListener("keydown",(t=>{var i=!1;switch(t.key){case De:break;case Fe:t.preventDefault(),i=!0;break;case Je:break;case"Alt":i=!0;break;case Be:case We:break;case qe:e>0&&(e--,this.results.children[e].focus());break;case Ue:e<this.results.childElementCount&&(this.results.children[e].focus(),e++);break;case ze:i=!1,this.close()}i&&t.key}),!1),this.container.addEventListener("click",(e=>{"close"===e.target.dataset.action&&this.close()})),this.results.addEventListener("change",(e=>{let t=e.target,[i,s]=t.value.split(":");"attribute"===s?this.concept.createAttribute(i):"component"===s&&this.concept.createComponent(i),t.disabled=!0})),this.input.addEventListener("input",(t=>{this.query(this.input.value.trim()),e=0})),this.input.addEventListener("blur",(e=>{p(this.input.value)&&(this.input.value="")}));const t=e=>e.parentElement===this.selectorList?e:ge(e,(e=>e.parentElement===this.selectorList));this.selectorList.addEventListener("click",(e=>{const{target:i}=e,s=t(i),{concept:n}=s.dataset;if(n){let e=this.model.getConcept(n);this.concept=e,this.selectorElement.textContent=e.fullName,this.clear(),this.refresh()}})),this.selectorElement.addEventListener("click",(e=>{Ne(this.selectorList)}))}};function Lr(e,t,i){const{name:s,alias:r,type:a,created:l,required:o}=e,c=ee({type:"checkbox",class:["explorer-result-item__checkbox"],value:`${s}:${a}`,disabled:!0});c.id=`${y(s)}${y(a)}`,c.checked=l,c.required=o;const h=Y({class:["explorer-result-item__label-name"]},n(r,s)),u=Y({class:["explorer-result-item__label-info"]},[`${t}: `,Z({class:["concept-name"]},`${i}`)]),d=ie({class:["explorer-result-item__label"]},[h,u]);d.htmlFor=c.id;var p=ae({type:"button",class:["btn","btn-add","explorer-result-item__button"],disabled:l,dataset:{action:"add"}},"+"),m=ae({type:"button",class:["btn","btn-remove","explorer-result-item__button"],disabled:o,dataset:{action:"remove"}},"-"),f=U({class:["explorer-result-item"],dataset:{value:s,required:o}},[c,d,p,m]);return f.tabIndex=-1,f}const xr="editor",Tr="explorer",Or=[];var Ar=0;const _r=()=>"GE"+Ar++,Vr={container:null,containerEnv:null,menu:null,btnStyle:null,get editors(){return Or.filter((e=>e.type===xr))},get explorers(){return Or.filter((e=>e.type===Tr))},get hasEnvironment(){return!r(Or)},get hasEditor(){return Or.some((e=>e.type===xr))},get hasExplorer(){return Or.some((e=>e.type===Tr))},init(e={}){const t=function(e){return x(e)?e:p(e)?be("[data-gentleman]"):be(e)}(e.container);if(!x(t))throw new TypeError("Bad argument: The container argument could not be resolved to an HTML Element.");return this.container=t,this.container.tabIndex=-1,this.containerEnv=this.container.dataset.gentleman,"editor"===this.containerEnv&&this.createEditor().init(e.editor),this.bindDOM(),this.bindEvents(),this.render(),this},render(){const e=H();return e.hasChildNodes()&&this.container.append(e),this.refresh(),this.container},refresh(){return this.hasEnvironment||this.createEditor().init(),this},getEditors(e){const t=this.editors;return o(e)?this.editors.filter((t=>e(t))):t.filter((e=>!e.active))},getEditor(e){return e?Or((t=>t.id===e)):this.editors[0]},createEditor(){var e=Object.create(wr,{object:{value:"environment"},type:{value:"editor"},name:{value:"editor"},id:{value:_r()},manager:{value:this},container:{value:Sr("editor")}});return this.container.append(e.container),Or.push(e),this.refresh(),e},deleteEditor(e){var t;return-1!==(t=l(e)?Or.findIndex((t=>t.id===e)):Or.indexOf(e))&&(Or.splice(t,1),this.refresh(),!0)},getExplorer(e){return e?Or((t=>t.id===e)):this.explorers.find((e=>!e.active))},createExplorer(){const e=Object.create(jr,{object:{value:"environment"},type:{value:"explorer"},name:{value:"explorer"},id:{value:_r()},manager:{value:this},container:{value:Sr("explorer")}});return this.container.append(e.container),Or.push(e),this.refresh(),e},bindDOM(){x(this.menu)||(this.menu=F({class:["manager-menu"]})),x(this.btnStyle)||(this.btnStyle=ae({id:"btnStyleEditor",class:["btn","manager__button","manager__btn-style"]},"Style"))},bindEvents(){}};function Sr(e){return F({class:["env",`${e}-container`],tabindex:-1})}window.GENTLEMAN_CONFIG?Vr.init(window.GENTLEMAN_CONFIG):Vr.init()})();