/*! For license information please see gentleman.core.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Gentleman=t():e.Gentleman=t()}(self,(function(){return(()=>{"use strict";var e={835:(e,t,i)=>{function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function l(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?g(e)?t:e:b(e)?t:e}function o(e){return p(e)&&0===e.length}function c(e){return e instanceof Date||"object"===s(e)&&"[object Date]"===Object.prototype.toString.call(e)}function h(e){return"string"==typeof e||e instanceof String}function u(e){return"function"==typeof e}function d(e){return!b(e)&&"object"===s(e)}function p(e){return!b(e)&&"function"==typeof e[Symbol.iterator]}function m(e){return p(e)&&!h(e)}function f(e){return null===e}function v(e){return!e||h(e)&&(0===e.length||/^\s*$/.test(e))}function g(e){return void 0===e}function b(e){return f(e)||g(e)}function y(e){if(!Array.isArray(e))throw new TypeError("Bad argument");if(!o(e))return e[e.length-1]}function w(e,t){var i=e.getDate(),s=e.getMonth()+1,n=e.getFullYear().toString(),r=e.getHours(),a=e.getMinutes(),l=e.getSeconds(),o=function(e){return e<10?"0".concat(e):e};return t.replace("yyyy",n).replace("yy",n.slice(-2)).replace("mm",o(s)).replace("m",s).replace("dd",o(i)).replace("d",i).replace("hh",o(r)).replace("h",r).replace("MM",o(a)).replace("M",a).replace("ss",o(l)).replace("s",l)}function E(e){return w(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(b(e))return new Date;if(c(e))return e;var i=new Date(e),s=i.getTime();return Number.isNaN(s)?new Date:t?new Date(s+6e4*i.getTimezoneOffset()):i}(e,!1),"yyyy-mm-dd hh:MM")}i.d(t,{fm:()=>x,kI:()=>L,jC:()=>Ae,WA:()=>He,cH:()=>te,Pi:()=>W,K$:()=>se,ax:()=>me,wC:()=>K,DZ:()=>Z,UF:()=>ae,rX:()=>q,_N:()=>U,mg:()=>G,dc:()=>F,oL:()=>le,Bi:()=>ie,Ju:()=>oe,_:()=>he,HV:()=>ee,qm:()=>Q,vB:()=>z,kQ:()=>ne,u4:()=>re,W_:()=>fe,uI:()=>be,Ss:()=>Ce,tH:()=>ye,ZL:()=>ge,zI:()=>Ee,ui:()=>we,nE:()=>ce,w_:()=>Y,wr:()=>Se,p6:()=>w,sb:()=>xe,$3:()=>Re,t4:()=>Ie,RI:()=>j,Bv:()=>k,xb:()=>o,mf:()=>u,Re:()=>V,TW:()=>p,UG:()=>O,le:()=>b,hr:()=>v,Kn:()=>d,HD:()=>h,Z$:()=>y,Ho:()=>R,ep:()=>Te,iG:()=>E,sw:()=>I,XI:()=>l});var C=Object.prototype.hasOwnProperty,j=(Object.prototype.isPrototypeOf,function(e,t){return C.call(e,t)});function L(e){if(b(e)||!d(e))return e;var t=e.constructor();for(var i in e)j(e,i)&&(e.isActiveClone=null,t[i]=L(e[i]),delete e.isActiveClone);return t}function x(e){return v(e)?e:e.charAt(0).toUpperCase()+e.slice(1)}function R(e){return v(e)?e:function(e){return v(e)?e:e.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()}))}(e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function I(e){var t=l(e,!1);return h(t)&&"true"===t.toLowerCase()||Number.isInteger(t)&&1===t||!0===t}var A=function(e){return!b(e)&&e.nodeType===Node.ELEMENT_NODE},O=function(e){return e instanceof Node},S=function(e){return A(e)&&e instanceof Element},V=function(e,t){return!!(A(e)&&e instanceof HTMLElement)&&(!p(t)||(i=e,s=Array.isArray(t)?t:[t],n=function(e){return i instanceof e},a=function(e){return i.tagName===e.toUpperCase()},l=function(e){return Array.isArray(e)?e.includes(i.type):i.type===e},s.some((function(e){if(!p(e))return!1;var t,i,s=e,c=null;if(Array.isArray(e)){var h=(i=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){n=!0,r=e}finally{try{s||null==l.return||l.return()}finally{if(n)throw r}}return i}}(t,i)||r(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());s=h[0],c=h[1]}s=s.toLowerCase();var u="HTML".concat(j(_,s)?_[s]:R(s),"Element");return!(!n(window[u])&&!a(s))&&(!(m(c)&&!o(c))||l(c))}))));var i,s,n,a,l},_={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},T=function(e){return function(e){return!b(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&e instanceof DocumentFragment};function H(e,t){if(!h(t))return null;var i=document.createElement("template");return i.innerHTML=t.trim(),i.content[e]}var k=H.bind(null,"firstChild");function M(e,t,i){e[t]=i}function $(e,t,i){e.setAttribute(t,i)}H.bind(null,"childNodes");var P="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",N={accesskey:[M,"accessKey"],autocapitalize:[M,"autocapitalize"],class:[function(e,t){var i;if(!V(e))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(i=e.classList).add.apply(i,n(Array.isArray(t)?t:[t])),e}],dataset:[function(e,t,i){Object.assign(e[t],i)},"dataset"],draggable:[M,"draggable"],editable:[M,"contentEditable"],hidden:[M,"hidden"],id:[M,"id"],inputmode:[M,"inputMode"],lang:[M,"lang"],html:[M,"innerHTML"],style:[M,"style"],tabindex:[M,"tabIndex"],text:[M,"textContent"],title:[M,"title"],data:[M,"data"],cite:[M,"cite"],download:[M,"download"],ping:[M,"ping"],target:[M,"target"],coords:[M,"coords"],shape:[M,"shape"],autoplay:[M,"autoplay"],buffered:[M,"buffered"],controls:[M,"controls"],loop:[M,"loop"],muted:[M,"muted"],playsinline:[$,"playsinline"],poster:[M,"poster"],preload:[M,"preload"],crossorigin:[M,"crossOrigin"],decoding:[M,"decoding"],height:[M,"height"],ismap:[M,"isMap"],loading:[M,"loading"],srcset:[M,"srcset"],width:[M,"width"],alt:[M,"alt"],as:[M,"as"],media:[M,"media"],rel:[M,"rel"],src:[M,"src"],sizes:[M,"sizes"],reversed:[M,"reversed"],start:[M,"start"],accept:[M,"accept"],"accept-charset":[M,"acceptCharset"],action:[M,"action"],autocomplete:[M,"autocomplete"],autofocus:[M,"autofocus"],capture:[M,"capture"],checked:[M,"checked"],cols:[M,"cols"],disabled:[M,"disabled"],dirname:[M,"dirName"],enctype:[M,"enctype"],for:[M,"for"],form:[M,"form"],formaction:[M,"formAction"],formenctype:[M,"formEnctype"],formmethod:[M,"formMethod"],formnovalidate:[M,"formNoValidate"],formtarget:[M,"formTarget"],high:[M,"high"],label:[M,"label"],list:[M,"list"],low:[M,"low"],max:[M,"max"],maxlength:[M,"maxLength"],method:[M,"method"],min:[M,"min"],minlength:[M,"minLength"],multiple:[M,"multiple"],name:[M,"name"],novalidate:[M,"noValidate"],optimum:[M,"optimum"],pattern:[M,"pattern"],placeholder:[M,"placeholder"],readonly:[M,"readOnly"],required:[M,"required"],rows:[M,"rows"],selected:[M,"selected"],size:[M,"size"],spellcheck:[$,"spellcheck"],step:[M,"step"],wrap:[M,"wrap"],default:[M,"default"],kind:[M,"kind"],srclang:[M,"srclang"],abbr:[M,"abbr"],colspan:[M,"colSpan"],span:[M,"span"],rowspan:[M,"rowSpan"],scope:[M,"scope"],href:[M,"href"],hreflang:[M,"hreflang"],datetime:[M,"dateTime"],type:[M,"type"],value:[M,"value"],usemap:[M,"useMap"]};function D(e,t,i){var s=document.createElement(e);return V(s)?(d(i)&&function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!V(e))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!d(t))return e;for(var s=function(e){return P.includes(e)||i.includes(e)},r=0,a=Object.keys(t);r<a.length;r++){var l=a[r];if(s(l)){var o=t[l],c=N[l].slice(0);c.shift().apply(void 0,[e].concat(n(c),[o]))}}}(s,i,l(t,"")),s):null}function B(e,t,i,s){var n=D(e,t,i);return V(n)?(b(s)||je(n,s),n):null}function X(e,t,i,s,n){var r=D(e,t,s);return V(r)?(b(n)||je(r,n,i),r):null}function Z(e){var t=document.createDocumentFragment();return b(e)||je(t,e),t}D.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),B.bind(null,"template","");var F=B.bind(null,"header",""),z=(B.bind(null,"footer",""),B.bind(null,"main",""),B.bind(null,"article",""),B.bind(null,"section","")),W=(B.bind(null,"nav",""),B.bind(null,"aside","")),q=(B.bind(null,"h1",""),B.bind(null,"h2","")),U=B.bind(null,"h3",""),G=B.bind(null,"h4",""),K=(B.bind(null,"h5",""),B.bind(null,"h6",""),B.bind(null,"div","")),Q=(B.bind(null,"object","data,height,name,type,usemap,width"),D.bind(null,"embed","height,src,type,width"),D.bind(null,"br",""),D.bind(null,"hr",""),B.bind(null,"p","")),J=(B.bind(null,"blockquote","cite"),function(e){return V(e,"li")?e:ee(null,e)}),Y=X.bind(null,"ul","",J),ee=(X.bind(null,"ol","reversed,start,type",J),B.bind(null,"li","value")),te=(B.bind(null,"dl",""),B.bind(null,"dt",""),B.bind(null,"dd",""),B.bind(null,"a","download,href,hreflang,ping,rel,target,type")),ie=(D.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),D.bind(null,"base","href,target"),D.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width")),se=B.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),ne=(B.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),D.bind(null,"source","media,sizes,src,srcset,type"),D.bind(null,"track","default,kind,label,src,srclang"),B.bind(null,"picture",""),B.bind(null,"figure",""),B.bind(null,"figcaption",""),B.bind(null,"span","")),re=B.bind(null,"strong",""),ae=B.bind(null,"em",""),le=(B.bind(null,"mark",""),B.bind(null,"samp",""),B.bind(null,"sub",""),B.bind(null,"sup",""),B.bind(null,"del","cite,datetime"),B.bind(null,"ins","cite,datetime"),B.bind(null,"q","cite"),B.bind(null,"abbr",""),B.bind(null,"b",""),B.bind(null,"i","")),oe=(B.bind(null,"s",""),B.bind(null,"u",""),B.bind(null,"cite",""),B.bind(null,"time","datetime"),B.bind(null,"code",""),B.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),D.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width")),ce=B.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),he=B.bind(null,"label","for"),ue=(X.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(e){return V(e,["option","optgroup"])?e:Array.isArray(e)?pe(null,e):ue(null,e)})),B.bind(null,"option","disabled,label,selected,value")),de=function(e){return V(e,"option")?e:ue(null,e)},pe=X.bind(null,"optgroup","disabled,label",de),me=(B.bind(null,"fieldset","disabled,name"),B.bind(null,"legend",""),X.bind(null,"datalist","",de),B.bind(null,"meter","high,low,max,min,optimum,value"),B.bind(null,"progress","max,value"),B.bind(null,"output","name,value"),B.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value")),fe=B.bind(null,"table",""),ve=(B.bind(null,"caption",""),function(e){return V(e,"tr")?e:we(null,e)}),ge=X.bind(null,"thead","",ve),be=X.bind(null,"tbody","",ve),ye=X.bind(null,"tfoot","",ve),we=(D.bind(null,"col","span"),X.bind(null,"colgroup","span",(function(e){return V(e,"col")?e:null})),X.bind(null,"tr","",(function(e){return V(e,["th","td"])?e:Ce(null,e)}))),Ee=B.bind(null,"th","abbr,colspan,rowspan,scope"),Ce=B.bind(null,"td","colspan,rowspan");function je(e,t,i){var s=Array.isArray(t)?t:[t];return u(i)&&(s=s.map((function(e){return i(e)}))),function(e,t){if(!O(e))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!(t instanceof HTMLCollection||m(t)))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=T(e)?e:document.createDocumentFragment();Array.from(t).forEach((function(e){var t;b(e)||i.appendChild(O(e)?e:(t=e.toString(),document.createTextNode(t.toString())))})),e!==i&&e.appendChild(i)}(e,s),e}var Le=function(e){return/^\.[a-zA-Z0-9_-]+$/.test(e)};function xe(e,t){var i=l(t,document);return v(e)?null:T(i)?i.querySelector(e):function(e){return/^#[a-zA-Z0-9_-]+$/.test(e)}(e)?document.getElementById(e.substring(1)):Le(e)?i.getElementsByClassName(e.substring(1))[0]:i.querySelector(e)}function Re(e,t){var i=l(t,document);return v(e)?null:T(i)?i.querySelectorAll(e):Le(e)?i.getElementsByClassName(e.substring(1)):i.querySelectorAll(e)}function Ie(e,t){return"content"in document.createElement("template")?xe(e,t):null}function Ae(e,t){return e?document.importNode(e.content,l(t,!0)):e}function Oe(e,t,i){if(!V(t))return null;var s=t[e];if(u(i))for(;S(s)&&!i(s);)s=s[e];return s}function Se(e,t,i){if(!S(e))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!u(t))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var s=e.parentElement;return i>0?_e(s,t,i-1):Ve(s,t)}function Ve(e,t){return b(e)?null:t(e)?e:Ve(e.parentElement,t)}function _e(e,t,i){return b(e)||0===i?null:t(e)?e:_e(e.parentElement,t,i-1)}function Te(e,t){if(!O(e))throw new TypeError("Bad argument: The given `node` is not a valid Node");return u(t)?(Array.from(e.childNodes).forEach((function(i){t(i)&&e.removeChild(i)})),e):function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}(e)}function He(e){if(b(e))return!1;var t=ce({value:V(e)?e.textContent:e.toString(),readonly:!0});return!!V(t)&&(document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),!0)}Oe.bind(null,"previousElementSibling"),Oe.bind(null,"nextElementSibling");var ke=function(e){return e.dataset.state},Me=function(e,t){return e.dataset.state=t},$e=function(e,t){return Me(e,l(t,"checked"))},Pe=function(e,t){return Me(e,l(t,"unchecked"))},Ne={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return f(this.selectedItem)&&!f(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("change",(function(t){var i=t.target,s=!1;if(u(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),s)return i.checked=!1,void e.items[e.selectedIndex].setChecked(!0);var n=e.items.find((function(e){return e.index===+l(i.dataset.selectorIndex,-1)}));b(n)||(e.setSelectedItem(n),u(e.afterChange)&&e.afterChange(e,t))}))}},De=function(e){return'[data-type="'.concat(e.name,'"]')},Be={BaseSelector:De({name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return f(this.selectedItem)&&!f(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=t.target;if(j(i.dataset,"selector")){var s=!1;if(u(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),!s){var n=e.items.find((function(e){return e.index===+l(i.dataset.selectorIndex,-1)}));b(n)||(e.setSelectedItem(n),u(e.afterChange)&&e.afterChange(e,t))}}}))}}),FormSelector:De(Ne)};new Error("Missing container: A selector requires a container"),new Error("Missing input: FormSelector requires an input in the container"),[Be.BaseSelector,Be.FormSelector].join(","),new Error("Missing container: A switch requires a container"),new Error("Missing input: FormSwitch requires an input in the container");var Xe="on",Ze=function(e){return'[data-type="'.concat(e.name,'"]')},Fe={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return ke(this.container)===Xe},setChecked:function(e){return!b(e)&&(this.input.checked=e,e?$e(this.container,Xe):Pe(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var e=this;this.input.addEventListener("change",(function(t){var i=!1;u(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i?e.input.checked=!e.input.checked:(e.toggle(),u(e.afterChange)&&e.afterChange(e,t))}))}};[Ze({name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return ke(this.container)===Xe},setChecked:function(e){return!b(e)&&(e?$e(this.container,Xe):Pe(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.isChecked()&&$e(this.container,Xe),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=!1;u(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i||(e.toggle(),u(e.afterChange)&&e.afterChange(e,t))}))}}),Ze(Fe)].join(","),new Error("Missing container: A collapsible requires a container"),new Error("Missing container: An accordion requires a container"),encodeURIComponent},943:(e,t,i)=>{function s(e){let t=0;if(R(e))return e.selectionStart;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t}i.d(t,{D3:()=>j,sr:()=>w,hi:()=>C,k$:()=>E,wo:()=>b,p$:()=>B,jn:()=>y,GV:()=>P,qO:()=>s,As:()=>H,NI:()=>L,EE:()=>M,GF:()=>$,Sd:()=>k,sB:()=>T,Cp:()=>u,CH:()=>m,xj:()=>x,u7:()=>R,QE:()=>I,n2:()=>D,a2:()=>A,fP:()=>N,Ys:()=>v,lL:()=>p,$Z:()=>h,ZN:()=>d,HW:()=>f,hF:()=>g});var n=i(835);const r="hidden",a="collapsed",l="highlighted",o="shake",c="selected";function h(e){return(0,n.Re)(e)?(e.classList.remove(r),e):e}function u(e){return(0,n.Re)(e)?(e.classList.add(r),e):e}function d(e){return(0,n.Re)(e)?(e.classList.toggle(r),e):e}function p(e){e.classList.contains(o)||(e.classList.add(o),setTimeout((()=>{e.classList.remove(o)}),1e3))}function m(e){return(0,n.Re)(e)?(e.classList.add(l),e):e}function f(e){return(0,n.Re)(e)?(e.classList.remove(l),e):e}function v(e){return(0,n.Re)(e)?(e.classList.add(c),e):e}function g(e){return(0,n.Re)(e)?(e.classList.remove(c),e):e}function b(e){return(0,n.Re)(e)&&e.classList.add(a),e}function y(e){return(0,n.Re)(e)&&e.classList.remove(a),e}const w={backspace:"Backspace",tab:"Tab",enter:"Enter",ctrl:"Control",shift:"Shift",alt:"Alt",escape:"Escape",spacebar:" ",page_up:"PageUp",page_down:"PageDown",insert:"Insert",end:"End",home:"Home",left_arrow:"ArrowLeft",up_arrow:"ArrowUp",right_arrow:"ArrowRight",down_arrow:"ArrowDown",delete:"Delete",period:"."},E={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},C={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},j={"audio/aac":"aac","application/octet-stream":"bin","image/jpeg":"jpeg","application/json":"json","audio/mpeg":"mp3","application/pdf":"pdf","image/svg+xml":"svg","text/plain":"txt","text/xml":"xml","application/zip":"zip"};function L(e){const t=e=>!(0,n.RI)(e.dataset,"ignore");return t(e)?e:(0,n.wr)(e,t,10)}function x(e){if(!n.Re)throw new TypeError("Bad parameter");return e.hidden||"none"===window.getComputedStyle(e).display}const R=e=>(0,n.Re)(e,["input","textarea"]),I=e=>R(e)||"true"===e.contentEditable,A=e=>+e.substring(0,e.indexOf("px")),O={top:e=>e.marginTop,right:e=>e.marginRight,bottom:e=>e.marginBottom,left:e=>e.marginLeft},S={top:e=>e.paddingTop,right:e=>e.paddingRight,bottom:e=>e.paddingBottom,left:e=>e.paddingLeft},V={top:e=>e.borderTopWidth,right:e=>e.borderRightWidth,bottom:e=>e.borderBottomWidth,left:e=>e.borderLeftWidth};function _(e,t,i){const s=window.getComputedStyle(e),n=window.getComputedStyle(t),r=O[i](s),a=S[i](n),l=V[i](n);return o=e.getBoundingClientRect()[i]+A(r),c=t.getBoundingClientRect()[i]-A(a)-A(l),Math.abs(o-c)<2;var o,c}function T(e){for(let t=0;t<e.children.length;t++){const i=e.children[t];if(!x(i))return i}return null}function H(e,t,i,s){return"up"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&_(e,t,"top"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(x(i)||i.classList.contains("badge")||i===e)continue;const{bottom:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n>=c-1&&(u<l||u===l&&d<o)&&(a=i,l=u,o=d)}return a}(e,i,s):"down"===t?function(e,t,i=!0){const s=t.children,{bottom:n,left:r}=e.getBoundingClientRect();if(i&&_(e,t,"bottom"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(x(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n<=c+1&&(u<l||u===l&&d<o)&&(a=i,l=u,o=d)}return a}(e,i,s):"left"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&_(e,t,"left"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(x(i)||i.classList.contains("badge")||i===e)continue;const{top:c,right:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r>=h-1&&(d<o||d===o&&u<l)&&(a=i,l=u,o=d)}return a}(e,i,s):"right"===t?function(e,t,i=!0){const s=t.children,{top:n,right:r}=e.getBoundingClientRect();if(i&&_(e,t,"right"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(x(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r<=h+1&&(d<o||d===o&&u<l)&&(a=i,l=u,o=d)}return a}(e,i,s):(console.error("unknown direction",t),null)}function k(e,t){const i=e.children,{top:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.mf)(t);let l=null,o=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(x(n)||n.classList.contains("badge"))continue;const{top:h,left:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);s<=h+1&&(d<o||d===o&&p<c)&&(l=n,o=d,c=p)}return l}function M(e,t){const i=e.children,{top:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.mf)(t);let l=null,o=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(x(n)||n.classList.contains("badge"))continue;const{top:h,left:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);r<=u+1&&(p<c||p===c&&d<o)&&(l=n,o=d,c=p)}return l}function $(e,t){const i=e.children,{top:s,right:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.mf)(t);let l=null,o=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(x(n)||n.classList.contains("badge"))continue;const{top:h,right:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);r>=u-1&&(p<c||p===c&&d<o)&&(l=n,o=d,c=p)}return l}function P(e,t){const i=e.children,{bottom:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.mf)(t);let l=null,o=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(x(n)||n.classList.contains("badge"))continue;const{bottom:h,left:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);s>=h-1&&(d<o||d===o&&p<c)&&(l=n,o=d,c=p)}return l}function N(e){return(0,n.Re)(e)?e:(0,n.HD)(e)&&!(0,n.hr)(e)?(0,n.sb)(e):null}function D(e,t={}){const i=N(e);if(!(0,n.Re)(i))return null;const s=Object.assign({horizontal:!0,vertical:!0,minWidth:60,minHeight:60},t),r=function(){let e=(0,n.wC)({class:["resizers"]});return["horizontal","vertical"].forEach((t=>{e.append((0,n.wC)({class:["resizer",`${t}`],dataset:{dir:t}}))})),e}();i.prepend(r),s.horizontal&&s.vertical?i.dataset.resizable="both":s.horizontal?i.dataset.resizable="horizontal":s.vertical&&(i.dataset.resizable="vertical");const{minWidth:a,minHeight:l}=getComputedStyle(i),o=(0,n.XI)(A(a),s.minWidth),c=(0,n.XI)(A(l),s.minHeight);let h=0,u=null;function d(e){const{dir:t}=u.dataset,{width:s,height:n}=getComputedStyle(i);let r="horizontal"===t?e.pageX:e.pageY;if("horizontal"===t){const e=A(s)+(r-h);e>o&&(i.style.width=`${e}px`)}else if("vertical"===t){const e=A(n)+(r-h);e>c&&(i.style.height=`${e}px`)}h=r}for(let e=0;e<r.childElementCount;e++){const t=r.children[e];t.addEventListener("mousedown",(function(e){e.preventDefault(),u=t;const{dir:i}=u.dataset;h="horizontal"===i?e.pageX:e.pageY,document.body.addEventListener("mousemove",d),document.body.addEventListener("mouseup",(()=>{document.body.removeEventListener("mousemove",d)}))}))}return i}const B=e=>JSON.parse(JSON.stringify(e));i(914)},914:(e,t,i)=>{i.d(t,{h:()=>s});const s=function(){var e={},t=[];for(let e=0;e<256;e++)t[e]=e<16?"0"+e.toString(16):e.toString(16);return e.generate=function(){var e=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,s=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]},e}()}},t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{activateEditor:()=>ts,createEditor:()=>is});var e=i(835),t=i(943);const n={menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,fileIO:null,config:null,settings:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,e.Re)(this.container)},clear(){return(0,e.ep)(this.container),this},update(){},render(){const t=(0,e.DZ)();if(!(0,e.Re)(this.container)){this.container=(0,e.wC)({class:["editor-home"]});let t=(0,e.rX)({class:["editor-title"]},"Settings");this.container.append(t)}return(0,e.Re)(this.menu)||(this.menu=r.call(this),t.append(this.menu)),(0,e.Re)(this.btnStart)||(this.btnStart=(0,e.ax)({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Done"),t.append(this.btnStart)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:e,hasProjectionModel:t}=this.editor;return this.btnStart.disabled=!(e&&t),this},actionHandler(e,t){const{concept:i}=t.dataset;"open-concept"===e&&(this.config.selectItem(i),this.config.showInfo(i))},bindEvents(){this.editor.registerHandler("editor.load-concept@post",(e=>{this.editor.hasConceptModel&&this.fileIO.addFile("concept",e[0],e[1])})),this.editor.registerHandler("editor.load-projection@post",(e=>{this.editor.hasConceptModel&&this.fileIO.addFile("projection",e[0],e[1])})),this.editor.registerHandler("editor.unload-concept@post",(e=>{this.fileIO.removeFile("concept"),this.config.clear()})),this.editor.registerHandler("editor.unload-projection@post",(e=>{this.fileIO.removeFile("projection")})),this.editor.registerHandler("concept-model.updated",(()=>{this.config.clear(),this.editor.hasConceptModel&&this.editor.conceptModel.schema.filter((e=>e.root)).forEach((e=>{this.config.addItem(e)}))}))}};function r(){const t=(0,e.vB)({class:["editor-home-menu"]});let i=(0,e.wC)({class:["editor-home-menu-section","editor-home-menu-section--file"]}),s=(0,e.wC)({class:["editor-home-menu-section","editor-home-menu-section--config"]});return this.fileIO=l.call(this),this.config=h.call(this),i.append(this.fileIO.render(),a("Files")),s.append(this.config.render(),a("Configuration")),t.append(i,s),t}function a(t){return(0,e._N)({class:["title","editor-home-menu-title"]},t)}function l(e){const t=Object.create(o,{editor:{value:this.editor}});return t.init(),t}const o={file:null,title:null,status:null,container:null,mainView:null,infoView:null,files:null,btnLoad:null,btnUnload:null,btnDownload:null,btnEdit:null,selection:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,e.le)(this.selection)},getFile(){return this.file},setFile(e){this.file=e,this.refresh()},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,t.$Z)(this.files)):(this.container.classList.add("empty"),(0,t.Cp)(this.files)),this.btnUnload.disabled=!this.hasFile,this.editor.isReady?((0,t.Cp)(this.placeholder),this.placeholder.classList.remove("error")):this.hasFile?(this.editor.hasConceptModel||(this.placeholder.innerHTML=`${c("Missing projections")}`),this.editor.hasProjectionModel||(this.placeholder.innerHTML=`${c("Missing projections")}`),this.placeholder.classList.add("error"),(0,t.$Z)(this.placeholder)):(this.placeholder.innerHTML=`Add your ${c("concepts")} and ${c("projections")} or load a previously saved ${c("model")}`,this.placeholder.classList.remove("error")),this.hasSelection||(0,t.Cp)(this.infoView),this},render(){this.container=(0,e.wC)({class:["editor-file"]});let t=(0,e.wC)({class:["drop-area","editor-file-main"]});this.files=(0,e.w_)({class:["bare-list","editor-file__list"]}),this.placeholder=(0,e.qm)({class:["editor-file-placeholder"],html:`Add your ${c("concepts")}, ${c("projections")} and all other ${c("resources")}`});let i=(0,e.wC)({class:["editor-file-actionbar"]});this.btnUnload=(0,e.ax)({class:["btn","editor-file-actionbar__button","editor-file-actionbar__btn-remove"],title:"Remove all files",dataset:{action:"unload"}}),i.append(this.btnUnload);let s=(0,e.wC)({class:["editor-file__browse"]}),n=(0,e.kQ)({class:["editor-file__browse-instruction"]},"Upload your files");return this.btnLoad=(0,e.ax)({class:["btn","editor-file__browse-button"],title:"Load file in editor",dataset:{action:"load"}},"Browse"),s.append(n,this.btnLoad),t.append(this.files,this.placeholder,s),this.container.append(i,t),this.bindEvents(),this.refresh(),this.container},clear(){(0,e.ep)(this.files)},selectItem(t){if(!this.cache.has(t))return null;let i=this.cache.get(t);(0,e.Re)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.displayInfo(t),this.refresh()},addFile(t,i,s){let n=(0,e.HV)({class:["editor-file__list-item",`editor-file__list-item--${t}`],dataset:{context:"menu",action:`open-${t}`,status:"active"}}),r=(0,e.oL)({class:["ico","ico-file","editor-file__list-item-icon"]}),a=(0,e.kQ)({class:["editor-file__list-item-type"]},(0,e.XI)(i,t)),l=(0,e.ax)({class:["editor-file__list-item__btn-remove"],dataset:{action:`unload-${t}`}},(0,e.oL)({class:["ico","ico-delete"],dataset:{ignore:"all"}},"✖"));n.append(r,a,l),this.files.append(n),this.cache.set(t,n),this.refresh()},removeFile(t,i){if(!this.cache.has(t))return;let s=this.cache.get(t);(0,e.ep)(s).remove(),this.cache.delete(t),this.refresh()},bindEvents(){this.editor.registerHandler("editor.load@post",(e=>{this.editor.hasConceptModel&&this.editor.hasProjectionModel})),this.container.addEventListener("dragenter",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragleave",(e=>{this.container.classList.remove("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragover",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("drop",(e=>{this.container.classList.remove("highlight");let t=e.dataTransfer.files[0];if(!t.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=e=>{this.editor.load(i.result,this.type)},i.readAsText(t),e.preventDefault(),e.stopPropagation()}),!1)}};function c(t){return(0,e.u4)({class:["text-bf"]},t).outerHTML}function h(){const e=Object.create(u,{editor:{value:this.editor}});return e.init(),e}const u={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,e.le)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,t.Cp)(this.placeholder),(0,t.$Z)(this.conceptList)):(this.container.classList.add("empty"),(0,t.$Z)(this.placeholder),(0,t.Cp)(this.conceptList)),this.hasSelection||(0,t.Cp)(this.infoView),this},render(){return this.container=(0,e.wC)({class:["editor-config"]}),this.mainView=(0,e.wC)({class:["editor-config-main"]}),this.infoView=(0,e.wC)({class:["editor-config-info"]}),this.conceptList=(0,e.w_)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,e.qm)({class:["editor-config-placeholder"],html:`${c("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,e.ep)(this.conceptList),(0,e.ep)(this.infoView),this.cache.clear(),this.refresh()},selectItem(t){if(!this.cache.has(t))return null;let i=this.cache.get(t);return(0,e.Re)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.refresh(),t},showInfo(i){let s=d(this.editor.conceptModel.getCompleteModelConcept(i),(0,e.t4)("#concept-schema"));(0,e.ep)(this.infoView).append(s),(0,t.$Z)(this.infoView)},addItem(t){let i=(0,e.kQ)({class:["loaded-element-name","fit-content"]},t.name),s=(0,e.HV)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:t.name,status:"active"}}),n=(0,e.ax)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:t.name}});s.append(i,n),this.conceptList.append(s),this.cache.set(t.name,s),this.refresh()},bindEvents(){}};function d(t,i){if((0,e.le)(t))throw new TypeError("Bad argument: The 'schema' is missing");if(!(0,e.Re)(i))throw new TypeError("Bad argument: The given 'template' is not a valid HTML Element");const s=(0,e.jC)(i);return(0,e.$3)("[data-if]",s).forEach(((i,s)=>{let n=i.dataset.if;(0,e.RI)(t,n)||i.remove()})),(0,e.$3)("[data-name]",s).forEach(((e,i)=>{let s=e.dataset.name;e.textContent=t[s]})),(0,e.$3)("[data-attr]",s).forEach(((e,i)=>{let s=e.dataset.attr,[n,r]=s.split(":"),a=(e=>e.startsWith("$")?t[e.substring(1)]:e)(r);delete e.dataset.attr,e.dataset[n]=a})),(0,e.$3)("[data-bind]",s).forEach(((i,s)=>{let n=i.dataset.bind;if(!(0,e.RI)(t,n))return;let r=(0,e.sb)("[data-item]",i),a=r.dataset.item,l=(0,e.t4)(`#${a}`);t[n].forEach((e=>{r.append(d(e,l))}))})),s}function p(t,i){const{name:s,object:n,id:r}=i,a=(0,e.HV)({class:["selector-concept",`selector-concept--${t}`],title:i.getName(),dataset:{concept:r,object:n}});var l=(0,e.kQ)({class:["selector-concept-content"]},i.getName());a.append(l),"ancestor"===t&&l.classList.add("fit-content");const o=(0,e.oL)({class:["selector-concept-status"]});if(i.hasError){o.classList.add("error");let t=(0,e.w_)({class:["bare-list","selector-concept-status__errors"]});i.errors.forEach((i=>{let s=(0,e.HV)({class:["selector-concept-status__error"]},i);s.style.minWidth=`${Math.min(.5*i.length,30)}em`,t.append(s)})),o.append(t),a.classList.add("error")}else o.classList.add("valid"),a.classList.add("valid");return a.append(o),a.addEventListener("mouseenter",(t=>{let i=(0,e.sb)(`.projection[data-concept="${r}"]`,this.editor.body);i&&this.editor.highlight(i)})),a.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),a.addEventListener("click",(t=>{let i=(0,e.sb)(`.projection[data-concept="${r}"]`,this.editor.body);i&&i.focus()})),a}const m={container:null,title:null,conceptList:null,header:null,body:null,get isRendered(){return(0,e.Re)(this.container)},init(e={}){return this.schema=e,this},update(){},refresh(){const{activeInstance:t,activeConcept:i,hasActiveInstance:s,hasActiveConcept:n}=this.editor;if(!s||!n)return(0,e.ep)(this.conceptList),this;const r=t.concept,a=(0,e.DZ)();let l=p.call(this,"root",r);if(a.append(l),r===i&&l.classList.add("selector-concept--active"),r===i)return(0,e.ep)(this.conceptList).append(a),this;if(!i.hasParent())return(0,e.ep)(this.conceptList).append(a),this;let o=i.getParent(),c=[];for(;o&&o!==r;)c.unshift(o),o=o.getParent();return c.forEach((e=>{a.append(p.call(this,"ancestor",e))})),l=p.call(this,"active",i),a.append(l),(0,e.ep)(this.conceptList).append(a),this},render(){const t=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["editor-breadcrumb"]})),(0,e.Re)(this.notification)||(this.notification=(0,e.wC)({class:["notification","breadcrumb-notification"]}),t.append(this.notification));const i=(0,e.kQ)({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return t.append(i),(0,e.Re)(this.conceptList)||(this.conceptList=(0,e.w_)({class:["bare-list","selector-concepts"]}),t.append(this.conceptList)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},f={schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,e.Re)(this.container)},add(i,s,n=t.hi.NORMAL){if(!Array.isArray(i))return;let r=(0,e.w_)({class:["bare-list","log-item-messages"]});i.forEach((t=>r.append((0,e.HV)({class:["log-item-message"]},t))));let a=(0,e.HV)({class:["log-item",`log-item--${n}`]}),l=(0,e.ax)({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},"✖"),o=(0,e.kQ)({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${(0,e.XI)(s,"Log")} (${(0,e.iG)(Date.now())})`);return a.append(l,o,r),this.logList.append(a),this.refresh(),this},clear(){return(0,e.ep)(this.logList),this},update(){},render(){const t=(0,e.DZ)();return(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["editor-log"]})),(0,e.Re)(this.logList)||(this.logList=(0,e.w_)({class:["bare-list","log-list"]}),t.append(this.logList)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}},v={container:null,list:null,editor:null,dataList:null,fetch:null,init(e){return this.fetch=e,this},render(){const t=(0,e.DZ)();return(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["container","container--editor-selectors"]})),(0,e.Re)(this.list)||(this.list=(0,e.w_)({class:["bare-list","editor-selectors","font-ui"]}),t.append(this.list)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){this.dataList=this.fetch(),(0,e.ep)(this.list);let t=(0,e.XI)(this.editor.getConfig("concept"),{});return this.dataList.forEach((i=>{const{concept:s,accept:n}=i;let r=(0,e.mg)({class:["title","editor-selector__title"]},`${a=i.name,(0,e.RI)(t,a)?t[a].name:a}`);var a;s&&r.append((0,e.kQ)({class:["editor-selector__title-concept"]},(s.name||s.prototype).replace(" ","-").toLowerCase())),n&&r.append((0,e.kQ)({class:["editor-selector__title-accept"]},n.name)),(0,e.ax)({class:["btn","editor-selector__header-button","editor-selector__header-button--info"],title:`View ${i.name||i.type} info`,dataset:{action:"collapse",rel:"parent",target:"selector"}},"i");let l=(0,e.dc)({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[r]),o=g[this.type],c=(0,e.wC)({class:["editor-selector__action-bar"]},o.call(this,i)),h=(0,e.HV)({class:["editor-selector","collapsed","font-ui"],tabindex:0,dataset:{type:this.type,alias:`${i.name||i.type}`,name:"selector",projection:i.id}},[l,c]);this.list.append(h)})),this.refresh(),this},show(){return(0,t.$Z)(this.container),this},hide(){return(0,t.Cp)(this.container),this},bindEvents(){}},g={projection:function(t){const i=(0,e.DZ)();let s=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:t.id}},"Edit");return i.append(s),i},value:function(t){const i=(0,e.DZ)();let s=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance:value",id:t.id}},(0,e.oL)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),n=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:t.id}},(0,e.oL)({class:["ico","ico-copy","btn-content"],dataset:{ignore:"all"}})),r=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:t.id}},(0,e.oL)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return i.append(r,n,s),i},concept:function(t){const i=(0,e.DZ)();let s=this.editor.projectionModel.hasProjectionSchema(t),n=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],disabled:!s,title:`Create an instance of "${t.name}"`,dataset:{action:"create-instance",concept:t.name}},(0,e.oL)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+"));return s||(n.title=`The concept ${t.name} has no projection`),i.append(n),i},resource:function(t){const{name:i,type:s,required:n}=t,r=(0,e.DZ)();let a=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--add"],dataset:{action:"load-resource",id:i}},(0,e.oL)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),l=(0,e.ax)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:i}},(0,e.oL)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return this.editor.getResource(i)?r.append(l):r.append(a),r}},b={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,header:null,body:null,btnHome:null,btnSave:null,btnClose:null,get isRendered(){return(0,e.Re)(this.container)},init(e){return e&&(this.editor=e),this._conceptSelector=function(e,t,i){return Object.create(v,{object:{value:"selector"},model:{value:void 0},type:{value:"concept"},editor:{value:t}})}(0,this.editor).init((()=>this.editor.isReady?this.editor.conceptModel.getSchema("concrete").filter((e=>e.root)):[])),this},render(){const t=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["editor-header"],dataset:{name:"editor-header",alias:"header"}})),(0,e.Re)(this.title)||(this.title=(0,e.kQ)({class:["editor-header-title"]},"Gentleman")),(0,e.Re)(this.menu)||(this.menu=(0,e.wC)({class:["editor-header-left"]},[this.title]));let i=(0,e.wC)({class:["editor-toolbar"]},this.editor.getConfig("toolbar").map((t=>(0,e.ax)({class:(0,e.XI)(t.class,[]),dataset:{name:t.name,action:t.action}},t.content))));return(0,e.Re)(this.header)||(this.header=(0,e.wC)({class:["editor-header-menu"]},[this.menu,i]),t.append(this.header)),(0,e.Re)(this.body)||(this.body=(0,e.wC)({class:["editor-header-main"]}),t.append(this.body)),(0,e.Re)(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){let i=(0,e.XI)(this.editor.getConfig("settings"),!0),s=(0,e.XI)(this.editor.getConfig("header"),!0);return this.editor.hasConceptModel?(this._conceptSelector.update(),(0,t.$Z)(this.body)):(0,t.Cp)(this.body),!1===i&&(0,t.Cp)(this.btnHome),!1===s&&(0,t.Cp)(this.body),this},show(i){if(!(0,e.Re)(this[i]))return(0,t.$Z)(this.container),this.visible=!0,this;(0,t.$Z)(this[i])},hide(i){if(!(0,e.Re)(this[i]))return(0,t.Cp)(this.container),this.visible=!1,this;(0,t.Cp)(this[i])},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},bindEvents(){}};var y=0;const w={createInstance(i,s,n){if((0,e.le)(i))return this.notify("The concept is not valid",t.k$.ERROR),!1;let r="concept"===i.type?i:this.createConcept(i),a=s;(0,e.le)(a)&&this.hasProjectionModel&&(a=this.createProjection(r).init());let l=Object.create(E,{id:{value:"instance"+y++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:r,writable:!0},projection:{value:a,writable:!0},editor:{value:this}});const o=Object.assign({type:"concept",resize:!0,maximize:!0,close:"DELETE-CONCEPT"},n);return l.init(o),this.addInstance(l),l},getInstance(e){return this.instances.get(e)},addInstance(e){return e.isRendered||this.instanceSection.append(e.render()),this.instances.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.updateActiveInstance(e),this.refresh(),this},removeInstance(t){let i=this.getInstance(t);return!(0,e.le)(i)&&(i===this.activeInstance&&(this.activeInstance=null),i.view&&(0,e.ep)(i.view).remove(),this.instances.delete(t),this.refresh(),!0)},moveInstance(e,t){return this.instanceSection.children[t].before(e),this},swapInstance(e,t){let i=Array.from(this.instanceSection.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveInstance(t,s),this.moveInstance(e,n),this}},E={window:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnMaximize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,schema:null,ctype:null,get isRendered(){return(0,e.Re)(this.container)},init(t={}){return this.ctype=(0,e.XI)(t.type,"concept"),this.schema=t,this},collapse(){return(0,t.wo)(this.container),this.collapsed=!0,this.fullscreen=!1,this.size="normal",this.refresh(),this},expand(){return(0,t.jn)(this.container),this.collapsed=!1,this.refresh(),this},changeSize(e){this.size=e,"fullscreen"===e?(this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height")):this.fullscreen=!1,this.refresh()},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},refresh(){return this.container.dataset.size=`${this.size}`,(0,e.le)(this.projection)&&(this.body.textContent="No projection found"),Array.from(this.editor.instances).some((e=>e.fullscreen))?this.editor.instanceSection.classList.add("fullscreen"):this.editor.instanceSection.classList.remove("fullscreen"),this},render(){const i=(0,e.DZ)(),{name:s}=this.concept,n=s.toLowerCase();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["editor-concept",`editor-concept--${this.ctype}`],tabindex:0,dataset:{nature:"concept-container",type:this.ctype,size:1}})),(0,e.Re)(this.header)||(this.header=(0,e.dc)({title:"concept"===this.schema.type?`Instance of "${n}"`:`Linked instance of "${n}"`,class:["editor-concept-header"]}),i.append(this.header)),(0,e.Re)(this.btnClose)||(this.btnClose=(0,e.ax)({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete the instance "${n}"`,dataset:{action:"close",context:this.type,id:this.id}}),"projection"===this.schema.type&&(this.btnClose.title=`Close the linked instance "${n}"`)),(0,e.Re)(this.btnMaximize)||(this.btnMaximize=(0,e.ax)({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${s.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),this.title=(0,e._N)({class:["title","editor-concept-title","fit-content"],dataset:{nature:"editable",id:this.id}},(0,e.XI)(this.schema.title,s));let r=(0,e.wC)({class:["editor-concept-toolbar"]},[this.btnMaximize,this.btnClose]);return(0,e.ep)(this.header).append(this.title,r),this.body&&this.body.remove(),this.projection?this.body=this.projection.render():this.body=(0,e.qm)(),i.append(this.body),i.hasChildNodes()&&(this.container.appendChild(i),this.bindEvents()),(0,t.n2)(this.container),this.refresh(),this.container},clear(){},actionHandler(e){switch(e){case"collapse":this.collapsed?this.expand():this.collapse();break;case"maximize":this.fullscreen?this.changeSize("normal"):this.changeSize("fullscreen");break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",t.k$.ERROR),this;break;case"DELETE-PROJECTION":if(this.projection&&!this.projection.delete())return this.notify("The projection could not be deleted",t.k$.ERROR),this}(0,e.ep)(this.container).remove(),this.editor.removeInstance(this.id),this.window&&this.window.removeInstance(this)},bindEvents(){this.container.addEventListener("focusin",(e=>{this.editor.updateActiveInstance(this)}))}};var C=0;const j={createWindow(e){let t=Object.create(L,{id:{value:"window"+C++},object:{value:"environment"},name:{value:"editor-window"},type:{value:"window"},editor:{value:this}});return t.refname=e,t.init(),this.addWindow(t),t},getWindow(e){return this.windows.get(e)},findWindow(e){return Array.from(this.windows.values()).find((t=>t.refname===e))},addWindow(e){return e.isRendered||this.body.append(e.render()),this.windows.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.refresh(),this},removeWindow(t){let i=this.getWindow(t);return!(0,e.le)(i)&&(i===this.activeWindow&&(this.activeWindow=null),i.view&&(0,e.ep)(i.view).remove(),this.windows.delete(t),this.refresh(),!0)},moveWindow(e,t){return this.body.children[t].before(e),this},swapWindow(e,t){let i=Array.from(this.body.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveWindow(t,s),this.moveWindow(e,n),this}},L={container:null,title:null,visible:!0,instances:null,menu:null,header:null,body:null,btnClose:null,maxInstance:1,get isRendered(){return(0,e.Re)(this.container)},init(t={}){return this.ctype=(0,e.XI)(t.type,"concept"),this.schema=t,this.instances=new Set,this},isEmpty(){return 0===this.instances.size},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},close(){(0,e.ep)(this.container).remove(),this.editor.removeWindow(this.id)},refresh(){return this.isEmpty()?this.hide():this.show(),this},render(){const t=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["editor-window"],tabindex:-1})),(0,e.Re)(this.header)||(this.header=(0,e.dc)({class:["editor-window-header"]}),t.append(this.header)),(0,e.Re)(this.title)||(this.title=(0,e._N)({class:["title","editor-window-title","fit-content"]})),(0,e.Re)(this.btnClose)||(this.btnClose=(0,e.ax)({class:["btn","editor-window-header__btn-delete"],title:"Close the window",dataset:{action:"close",context:this.type,id:this.id}}));let i=(0,e.wC)({class:["editor-window-toolbar"]},[this.btnClose]);return(0,e.ep)(this.header).append(this.title,i),t.hasChildNodes()&&(this.container.appendChild(t),this.bindEvents()),this.refresh(),this.container},getInstance(t){return(0,e.le)(t)?null:Array.from(this.instances).find((e=>e.id===t))},addInstance(t){if(!(0,e.le)(t)&&!this.instances.has(t))return this.instances.add(t),t.window=this,this.container.append(t.container),this.refresh(),!0},removeInstance(t){if(!(0,e.le)(t)&&this.instances.has(t))return this.instances.delete(t),this.refresh(),!0},actionHandler(e){switch(e){case"close":this.close()}},bindEvents(){}},x={modelstatus:null,editorstatus:null,notification:null,views:null,view:"grid",viewContainer:null,viewList:null,viewItem:null,activeViewItem:null,groupList:null,groupItem:null,activeGroupItem:null,visible:!0,container:null,get isRendered(){return(0,e.Re)(this.container)},init(){return this.views=new Map,this},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},updateActiveView(){"tab"===this.view&&(this.editor.instances.forEach((e=>{e!==this.editor.activeInstance&&(e.view.classList.remove("active"),e.hide())})),this.editor.activeInstance.view.classList.add("active"),this.editor.activeInstance.show()),this.editor.refresh()},addView(t){if((0,e.le)(t))return!1;let i=t.title.textContent,s=(0,e.oL)({class:["ico","ico-delete"]},"✖"),n=(0,e.ax)({class:["btn","btn-close"]},s),r=(0,e.wC)({class:[`editor-view-${this.view}list-item__content`,"fit-content"]},i),a=(0,e.HV)({class:[`editor-view-${this.view}list-item`],title:t.title.textContent},[r,n]);t.view=a,a.addEventListener("click",(i=>{if(function(t){const i=e=>e===a||e===n;return i(t)?t:(0,e.wr)(t,(e=>i(e)),5)}(i.target)===n){let e=a.previousSibling||a.nextSibling;t.delete(),null===this.editor.activeInstance&&e&&e.click()}else this.editor.updateActiveInstance(t)})),this.tabView.append(a)},changeView(i){if(i===this.view)return this;this.view=i,(0,t.hF)(this.viewItem),this.viewItem=this.views.get(this.view),(0,t.Ys)(this.viewItem),(0,e.ep)(this.editor.viewSection),"tab"===i?(this.tabView=(0,e.w_)({class:["bare-list","editor-view-tablist"]}),(0,e.ep)(this.tabView),this.editor.instances.forEach((e=>{e.expand(),this.addView(e)})),this.editor.viewSection.append(this.tabView)):"grid"===i&&this.editor.instances.forEach((e=>{e.show()})),this.updateActiveView()},addGroup(){(0,e.HV)({class:["editor-footer-group"]})},notify(t,i=4500){let s=t;const n="open";if(this.notification.classList.contains(n))return!1;this.notification.appendChild(s),setTimeout((()=>{this.notification.classList.add(n),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(n),this.container.classList.remove("menu--notifying"),setTimeout((()=>{(0,e.ep)(this.notification)}),500)}),i)},refresh(){const{conceptModel:t}=this.editor;if(this.editor.isReady){if(t.hasError){this.modelstatusBadge.classList.add("error"),this.modelstatusBadge.classList.remove("valid"),this.container.classList.add("error");let e=t.concepts.filter((e=>e.hasError)).length;this.modelstatusInfo.textContent=`${e} ${function(e,t,i){if(1===i)return e;let s="s".split("|");return 1===s.length?e+s[0]:e.substring(0,e.lastIndexOf(s[0]))+s[1]}("error",0,e)}`}else this.modelstatusBadge.classList.add("valid"),this.modelstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,e.ep)(this.modelstatusInfo),this.editor.logs.clear();if(this.editor.hasError){this.editorstatusBadge.classList.add("error"),this.editorstatusBadge.classList.remove("valid"),this.container.classList.add("error");let e=this.editor.errors.length;this.editorstatusInfo.textContent=`${e}`}else this.editorstatusBadge.classList.add("valid"),this.editorstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,e.ep)(this.editorstatusInfo),this.editor.logs.clear()}},render(){const t=(0,e.DZ)();if((0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["editor-statusbar"]})),(0,e.Re)(this.badgeContainer)||(this.badgeContainer=(0,e.wC)({class:["editor-statusbar-badge-container"]}),t.appendChild(this.badgeContainer)),(0,e.Re)(this.modelstatus)||(this.modelstatus=(0,e.wC)({class:["editor-statusbar-model"]}),this.modelstatusBadge=(0,e.oL)({class:["editor-statusbar-model-badge"]}),this.modelstatusInfo=(0,e.wC)({class:["editor-statusbar-model-info"]}),this.modelstatus.append(this.modelstatusBadge,this.modelstatusInfo),this.badgeContainer.appendChild(this.modelstatus)),(0,e.Re)(this.editorstatus)||(this.editorstatus=(0,e.wC)({class:["editor-statusbar-global"]}),this.editorstatusBadge=(0,e.oL)({class:["editor-statusbar-global-badge"]}),this.editorstatusInfo=(0,e.wC)({class:["editor-statusbar-global-info"]}),this.editorstatus.append(this.editorstatusBadge,this.editorstatusInfo),this.badgeContainer.appendChild(this.editorstatus)),(0,e.Re)(this.viewContainer)||(this.viewContainer=(0,e.wC)({class:["editor-statusbar-viewer-container"]}),t.appendChild(this.viewContainer)),!(0,e.Re)(this.btnGroup)){let t=(0,e.oL)({class:["ico","ico-plus","btn-content"],title:"Add a group",dataset:{ignore:"all"}},"+");this.btnGroup=(0,e.ax)({class:["editor-statusbar-viewer__button-add"],dataset:{action:"add-group"}},t)}return(0,e.Re)(this.groupContainer)||(this.groupContainer=(0,e.wC)({class:["editor-footer-group"]})),(0,e.Re)(this.viewList)||(this.viewList=(0,e.w_)({class:["bare-list","editor-statusbar-viewers"]}),this.viewContainer.appendChild(this.viewList)),["grid","tab"].forEach((t=>{let i=(0,e.HV)({class:["editor-statusbar-viewer"],dataset:{type:"viewer",action:"change-view",value:t}},t);this.views.set(t,i),this.viewList.append(i)})),this.viewItem=this.views.get(this.view),this.viewItem.classList.add("selected"),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},bindEvents(){function i(t,i){let s=(0,e.UF)({class:["link","error-message__link"]},t);const n=`.projection[data-concept="${i}"]`;return s.addEventListener("mouseenter",(t=>{let i=(0,e.sb)(n,this.editor.body);i&&this.editor.highlight(i)})),s.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),s.addEventListener("click",(t=>{let i=this.editor.resolveElement((0,e.sb)(n,this.editor.body));i&&i.focus()})),s}this.modelstatus.addEventListener("click",(s=>{if(!this.editor.conceptModel.hasError)return;let n=[];this.editor.conceptModel.concepts.forEach((t=>{t.hasError&&n.push(...t.errors.map((s=>{let n=i.call(this,t.getName(),t.id);return(0,e.kQ)({class:["error-message"]},[n,`: ${s}`])})))})),this.editor.logs.clear(),this.editor.logs.add(n,"Validation error",t.hi.ERROR)})),this.editorstatus.addEventListener("click",(i=>{if(!this.editor.hasError)return;let s=[];s.push(...this.editor.errors.map((t=>(0,e.kQ)({class:["error-message"]},[`${t.message}`])))),this.editor.logs.clear(),this.editor.logs.add(s,"Validation error",t.hi.ERROR)})),this.editor.registerHandler("editor.instance@active:updated",(()=>{this.updateActiveView()}))}},R={container:null,isOpen:!1,visible:!0,show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this.editor.refresh(),this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this.editor.refresh(),this}};function I(){return Object.create(b,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function A(){return Object.create(m,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function O(){return Object.assign(Object.create(R,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}}),n)}function S(){return Object.create(x,{object:{value:"environment"},name:{value:"editor-status"},type:{value:"status"},editor:{value:this}})}function V(){return Object.assign(Object.create(R,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}}),f)}const _={getHandlers(t){return(0,e.XI)(this.handlers.get(t),[])},triggerEvent(t,i,s=!0){const{name:n,options:r,args:a}=t,l=this.getHandlers(n),o=(0,e.mf)(i);let c=!1;return l.forEach((e=>{let t=e.call(this,a,r);!1!==t?s&&o&&i.call(this,t):c=!0})),!c&&(!s&&o&&i.call(this),!0)},registerHandler(e,t){return this.hasHanlder(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),!0},unregisterHandler(e,t){if(!this.hasHanlder(e))return!1;let i=this.getHandlers(e);for(let e=0;e<i.length;e++)if(i[e]===t)return i.splice(e,1),!0;return!1},hasHanlder(e){return this.handlers.has(e)}};var T=i(914);const H={create(e,t){const i=Object.create(this);return i.concept=e,i.schema=t,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(e){throw new Error("This function has not been implemented")}};Object.defineProperty(H,"model",{get(){return this.concept.model}}),Object.defineProperty(H,"name",{get(){return this.schema.name}}),Object.defineProperty(H,"required",{get(){return(0,e.XI)(this.schema.required,!0)}});const k={object:"attribute",target:null,init(t){return this.target=this.model.createConcept(this.schema.target,{value:(0,e.XI)(t,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.getValue()},hasValue(){return this.target.hasValue()},getTarget(){return this.target},copy(){return this.target.hasValue()?this.target.copy(!1):null},clone(){return this.target.hasValue()?this.target.clone():null},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}},toXML(){return this.target.hasValue()?this.target.toXML():""}},M=Object.assign(Object.create(H),k),$={attributes:null,attributes_created:null,initAttribute(){return this.attributes=[],this.attributes_created=new Set,this.attributes_updated=new Set,this.attributes_deleted=new Set,Array.isArray(this.attributeSchema)&&this.attributeSchema.filter((t=>(0,e.XI)(t.required,!0))).forEach((e=>this.createAttribute(e.name))),this},getAttributes(){return this.attributes},getAttribute(t){if((0,e.le)(t))throw new TypeError("Bad argument");return this.getAttributeByName(t)},getAttributeSchema(t){if((0,e.hr)(t))throw new TypeError("Bad argument");if(!this.hasAttribute(t))throw new Error(`Attribute '${t}' does not exist`);return(0,e.kI)(this.attributeSchema.find((e=>e.name===t)))},getAttributeByName(t){if((0,e.hr)(t))throw new TypeError("Bad argument");var i=this.attributes.find((e=>e.name===t));return(0,e.le)(i)&&(i=this.createAttribute(t)),i},createAttribute(e,t){if(!this.hasAttribute(e))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${e}'`);if(this.isAttributeCreated(e)){let i=this.getAttributeByName(e);if(t){let e=this.model.getValue(t);i.target.initValue(e)}return i}const i=this.getAttributeSchema(e);let s=this.model.getValue(t);var n=M.create(this,i).init(s);return this.addAttribute(n),n},addAttribute(t){if((0,e.le)(t)||"attribute"!==t.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(t),this.attributes_created.add(t.name),this.notify("attribute.added",t),this},hasAttributes(){return!(0,e.xb)(this.attributeSchema)||!(0,e.xb)(this.attributes)},hasAttribute(e){return-1!==this.attributeSchema.findIndex((t=>t.name===e))},isAttributeRequired(t){const i=this.getAttributeSchema(t);return(0,e.XI)(i.required,!0)},isAttributeCreated(e){return this.attributes_created.has(e)},listAttributes(){const e=[];return this.attributeSchema.forEach((t=>{e.push({type:"attribute",name:t.name,target:t.target,accept:t.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),e},removeAttribute(e){if(this.isAttributeRequired(e))return{message:`The attribute '${e}' is required.`,success:!1};var t=this.attributes.findIndex((t=>t.name===e));if(-1===t)return{message:`The attribute '${e}' was not found.`,success:!1};var i=this.attributes.splice(t,1)[0];return this.attributes_created.delete(e),this.notify("attribute.removed",i),{message:`The attribute '${e}' was successfully removed.`,success:!0}}},P={listeners:null,initObserver(){return this.listeners=[],this},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){var t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t,this)}))}},N={model:null,schema:null,source:null,id:null,name:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,errors:null,value:null,values:null,action:null,shadows:null,watchers:null,kind:"concept",init(t={}){return this.accept=t.accept,this.parent=t.parent,this.ref=t.ref,this.properties=(0,e.XI)(this.schema.properties,[]),Array.isArray(t.properties)&&this.properties.push(...t.properties),this.default=(0,e.XI)(this.schema.default,null),this.values=(0,e.XI)(t.values,(0,e.XI)(this.schema.values,[])),this.src=(0,e.XI)(this.schema.src,[]),this.constraint=this.schema.constraint,this.watchers=new Map,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},isRoot(){return(0,e.le)(this.parent)},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getCandidates(){return this.values.forEach((t=>{(0,e.Kn)(t)&&(t.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},getProperty(t,i){if("refname"===t){if((0,e.le)(this.ref))return;return this.ref.name}if("name"===t)return this.name;if("value"===t)return this.value;if(!this.hasProperty(t))return;let s=this.properties.find((e=>e.name===t));const{type:n,value:r}=s;return"string"===n?D.call(this,r):"number"===n?+r:"boolean"===n?(0,e.sw)(r):r},hasProperty(t){return!!["refname","name","value"].includes(t)||-1!==(0,e.XI)(this.schema.properties,[]).findIndex((e=>e.name===t))},getConstraint(e){if(this.hasConstraint(e))return this.constraint[e]},hasConstraint(t){return!(0,e.le)(this.constraint)&&(!!(0,e.le)(t)||(0,e.RI)(this.constraint,t))},hasParent(){return!this.isRoot()},getParent(t){if(this.isRoot())return null;if((0,e.hr)(t))return this.parent;const i=this.parent;return i.name===t?i:i.getParent(t)},getParentWith(t){if(this.isRoot())return null;if((0,e.hr)(t))return this.parent;const i=this.parent;return i.hasPrototype(t)?i:i.getParentWith(t)},getPrototype(){return(0,e.le)(this.prototype)?null:this.prototype},hasPrototype(t){if((0,e.le)(this.schema.prototype))return!1;if((0,e.le)(t))return!0;let i=this.model.getConceptSchema(this.schema.prototype);for(;!(0,e.le)(i);){if(i.name===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1},getAncestor(e){const t=[];for(var i=this.getParent(e);i;)t.push(i),i=i.getParent(e);return t},getChildren(t){const i=[];return(0,e.le)(t)?this.getAttributes().forEach((e=>{i.push(e.target)})):this.getAttributes().forEach((e=>{e.target.name===t?i.push(e.target):i.push(...e.target.getChildren(t))})),i},getDescendant(e){const t=[];return this.getChildren(e).forEach((i=>{t.push(i),t.push(...i.getDescendant(e))})),t},propagate(e,t,i){this.watchers.has(e)&&this.signal(e,t,i),this.hasParent()&&this.getParent().propagate(e,t,i)},watch(e,t){this.watchers.has(e)||this.watchers.set(e,[]),this.watchers.get(e).push(t)},signal(e,t,i){this.watchers.has(e)&&this.watchers.get(e).forEach((e=>e(t,this)))},unwatch(t,i){if((0,e.le)(t)||!this.watchers.has(t))return!1;if(!(0,e.mf)(i))return this.watchers.delete(t),!0;let s=this.watchers.get(t).findIndex((e=>e===i));return-1!==s&&(this.watchers.splice(s,1),!0)},done(){this.unregisterAll(),this.watchers.clear()},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}this.getChildren().forEach((e=>{e&&e.delete(!0)}));try{this.model.removeConcept(this.id)&&this.notify("delete")}catch(e){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},copy(e=!0){const t={name:this.name,nature:this.nature};var i=[];return this.getAttributes().forEach((e=>{i.push({name:e.name,value:e.copy(!1)})})),t.attributes=i,e&&this.model.addValue(t),t},clone(){const e={id:this.id,name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.clone()})})),e.attributes=t,e},export(){const e={id:this.id,root:this.isRoot(),name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.export()})})),e.attributes=t,e},toString(){var e={};return this.attributes.forEach((t=>{Object.assign(e,t.toString())})),e},toXML(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function D(t){if((0,e.HD)(t))return t;const{type:i}=t;switch(i){case"concat":return X.call(this,t.concat)}}function B(e,t){const{type:i}=e;return"string"===i?D.call(this,e.value):"property"===i?this.getProperty(e.name):t||e}function X(e,t=""){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");return e.length<2?B.call(this,e[0]):e.map((e=>B.call(this,e))).join(t)}const Z=Object.assign(N,P,$);Object.defineProperty(Z,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(Z,"_prototype",{get(){return this.schema.prototype}}),Object.defineProperty(Z,"hasError",{get(){return this.errors&&!(0,e.xb)(this.errors)}});const F={nature:"primitive",init(t={}){return this.parent=t.parent,this.ref=t.ref,this.default=(0,e.XI)(this.schema.default,!0),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},initValue(t){if((0,e.le)(t))return this.value=this.default,this;if((0,e.Kn)(t)){const{id:e="",value:i}=t;e.length>10&&(this.id=e),this.setValue(i)}else this.setValue(t);return this},hasValue(){return!(0,e.le)(this.value)},getValue(){return this.value},setValue(t){let i=(0,e.Kn)(t)?t.value:t;return 200!==this.validate(i)?{success:!1,message:"Validation failed: The value could not be updated."}:(this.value=(0,e.sw)(i),this.notify("value.changed",i),{success:!0,message:"The value has been successfully updated."})},restore(e){const{value:t}=e;this.setValue(t)},update:(e,t)=>!0,getCandidates:()=>[!0,!1],getChildren:e=>[],validate(t){return this.errors=[],(0,e.HD)(t)&&["true","false"].includes(t.toLowerCase())||Number.isInteger(t)&&[1,0].includes(t)||[!0,!1].includes(t)?200:400},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}},z=Object.assign(Object.create(Z),F);function W(e,t){switch(e){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum allowed: ${t.value}.`};case 402:return{success:!1,message:`Minimum allowed: ${t.value}.`};case 404:return{success:!1,message:`Value allowed: ${t.value}.`}}}const q={nature:"primitive",initValue(t){if((0,e.le)(t))return this.value=this.default,this;if((0,e.Kn)(t)){const{id:e="",value:i}=t;e.length>10&&(this.id=e),this.setValue(i)}else this.setValue(t);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(t){let i=(0,e.Kn)(t)?t.value:t;const{code:s,ctx:n}=this.validate(i);return this.value!==i&&(this.value=(0,e.hr)(i)?null:+i,this.notify("value.changed",i),this.propagate("value.changed",i,this)),200!==s?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},restore(e){const{value:t}=e;this.setValue(t)},getCandidates(){return this.values.forEach((t=>{(0,e.Kn)(t)&&(t.type="value")})),this.values},getChildren:e=>[],update:(e,t)=>!0,validate(t){if(this.errors=[],isNaN(t)){let e=400;return this.errors.push(W.call(this,e).message),{code:e}}if(!this.hasConstraint())return{code:200};if(this.hasConstraint("value")){let e=this.getConstraint("value");const{type:i}=e;if("range"===i){const{min:s,max:n}=e[i];if(s&&+t<s.value){let e=402;return this.errors.push(W.call(this,e,s).message),{code:e,ctx:s}}if(n&&+t>n.value){let e=403;return this.errors.push(W.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=e[i];if(t!==s){let t=404;return this.errors.push(W.call(this,t,e[i]).message),{code:t,ctx:e[i]}}}}if(this.hasConstraint("values")){let i=this.getConstraint("values").map((e=>U.call(this,e))).flat(),s=!1;for(let n=0;!s&&n<i.length;n++){const r=i[n];s=(0,e.Kn)(r)?r.value===t:r===t}if(!s){let e=401;return this.errors.push(W.call(this,e,i).message),{code:e,ctx:i}}}return{code:200}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function U(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}const G=Object.assign(Object.create(Z),q),K={nature:"primitive",reference:null,path:null,init(t={}){return this.parent=t.parent,this.ref=t.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=(0,e.XI)(this.schema.values,[]),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},initValue(t){return(0,e.le)(t)||this.setValue(t.value),this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!(0,e.hr)(this.value)},getValue(t=!1){return(0,e.le)(this.value)?null:t?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return(0,e.le)(this.reference)?null:this.reference},setValue(t,i=!0){let s=(0,e.Kn)(t)?t.id:t;return 200!==this.validate(s)?{success:!1,message:"Validation failed: The value could not be updated."}:(0,e.le)(s)||this.value===s?{success:!0,message:"The value has been ignored."}:(this.reference&&this.reference.unregister(this),this.value=s,this.reference=this.model.getConcept(s),(0,e.le)(this.reference)&&i?setTimeout((()=>this.setValue(t,!1)),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if((0,e.le)(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var t=Q.call(this,this.accept);return this.path&&J(this,this.path).map((e=>({type:this.accept.type,value:e}))),t},getChildren(t){return(0,e.le)(this.reference)||t&&this.reference.name!==t?[]:[this.reference]},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(t){return this.errors=[],(0,e.le)(t)||this.model.hasConcept(t)?200:(this.errors.push("This element is not valid"),401)},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function Q(e){const{name:t,scope:i,rel:s}=e;return"parent"===s?this.getParent(i).getChildren(t):"children"===s?this.getChildren(t):this.model.isPrototype(t)?this.model.getConceptsByPrototype(t):this.model.getConcepts(t)}function J(t,i){if((0,e.le)(i))return t;const{target:s,value:n,rel:r}=i;var a=[];return"parent"===r?a.push(t.getParentWith(s)):"children"===r?a.push(...t.getChildren(s)):"property"===r&&a.push(t.getProperty(s)),a.map((e=>J(e,n))).flat()}const Y=Object.assign({},Z,K),ee={SUCCESS:200,INVALID_VALUE:401,MIN_CARDINALITY_ERROR:402,MAX_CARDINALITY_ERROR:403,FIX_CARDINALITY_ERROR:404};function te(e,t){switch(e){case ee.INVALID_VALUE:return{success:!1,message:`Valid values: ${t}`};case ee.MAX_CARDINALITY_ERROR:return{success:!1,message:`Maximum cardinality: ${this.value.length}/${t.value}.`};case ee.MIN_CARDINALITY_ERROR:return{success:!1,message:`Minimum cardinality: ${this.value.length}/${t.value}.`};case ee.FIX_CARDINALITY_ERROR:return{success:!1,message:`Fixed cardinality: ${t.value}.`};case ee.PATTERN_ERROR:return{success:!1,message:"The value is not valid."}}}const ie={nature:"primitive",init(t={}){return this.parent=t.parent,this.ref=t.ref,this.accept=this.schema.accept,this.ordered=(0,e.XI)(this.schema.ordered,!0),this.constraint=this.schema.constraint,this.watchers=new Map,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},initValue(t){this.removeAllElement();let i=se.call(this);if((0,e.le)(t)){let e=i;for(let t=0;t<e;t++)this.createElement();return this}const{id:s="",name:n,value:r}=t;s.length>10&&(this.id=s);for(let e=0;e<r.length;e++)this.createElement(r[e]);let a=i-r.length;for(let e=0;e<a;e++)this.createElement();return this},hasValue(){return!(0,e.xb)(this.value)},getValue(e=!1){const t=this.value.map((e=>this.model.getConcept(e)));return e?t.map((e=>e.getValue())):t},removeValue(e){return this.hasValue()?(this.removeElement(e),{success:!0,message:"The value has been successfully updated."}):{success:!0,message:"The value has been successfully updated."}},isValidElement(t){const{name:i,accept:s}=this.accept;return this.model.isPrototype(i)?(0,e.le)(s)?this.model.hasPrototype(t.name,i):Array.isArray(s)?s.some((e=>e.name===t.name)):s.name===t.name:this.accept.name===t.name},setValue(e){let t=e.value||e;if(Array.isArray(t)){this.removeAllElement();for(let e=0;e<t.length;e++)this.createElement(t[e])}else this.isValidElement(t)&&this.createElement(t)},restore(e){const{value:t}=e;t.forEach(((e,t)=>{this.value.includes(e.id)||this.createElement(e)}))},getElements(){return this.value.map((e=>this.model.getConcept(e)))},getElement(t){var i=this.value.find((e=>e===t));if(!(0,e.le)(i))return this.model.getConcept(i)},getElementAt(e){if(!(e<0||e>=this.value.length))return this.model.getConcept(this.value[e])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(t){return!(0,e.le)(t)&&(this.value.push(t.id),t.index=this.value.length-1,this.validate(),this.notify("value.added",t),this.propagate("value.changed",t,this),!0)},addElementAt(t,i=0){return(0,e.le)(t)&&(t=this.createElement()),this.value.splice(i,0,t.id),this.validate(),this.notify("value.added",t),this.propagate("value.changed",t,this),this},swapElement(e,t){if(!this.ordered)return this;let i=this.value[e];this.value[e]=this.value[t],this.value[t]=i;let s=this.getElementAt(e);s.index=+e;let n=this.getElementAt(t);return n.index=+t,this.notify("value.swapped",[s,n]),this},removeElement(t){let i=(0,e.XI)(t.index,this.value.indexOf(t.id));return-1!==i&&this.removeElementAt(i)},removeElementAt(t){let i=this.getElementAt(t);if((0,e.le)(i))return{message:`The element at index '${t}' was not found.`,success:!1};i.delete(!0),this.value.splice(t,1);const s=this.getValue();for(let e=t;e<s.length;e++)s[e].index=e;return this.validate(),this.notify("value.removed",i),this.propagate("value.changed",i,this),{message:`The element '${i.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((e=>{this.model.removeConcept(e)})),this.value=[],this.notify("value.changed",this.value),this.propagate("value.changed",this.value,this),this},createElement(e){const t={value:this.model.getValue(e),parent:this,ref:this},i=this.model.createConcept(this.accept,t);return this.addElement(i),i},getProperty(t,i){if("refname"===t)return this.ref.name;if("name"===t)return this.name;if("value"===t)return this.value;if("length"===t||"cardinality"===t)return this.value.length;let s=this.properties.find((e=>e.name===t));if((0,e.le)(s))return;const{type:n,value:r}=s;return"string"===n?r:"number"===n?+r:"boolean"===n?(0,e.sw)(r):r},hasProperty(e){return!!["refname","name","value","length","cardinality"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){return ne.call(this,this.accept)},getChildren(t){if(!this.hasValue())return[];const i=this.getElements();return(0,e.le)(t)?i:i.filter((e=>e.name===t))},validate(){if(this.errors=[],!this.hasConstraint())return{code:ee.SUCCESS};if(this.hasConstraint("cardinality")){let e=this.getConstraint("cardinality");const{type:t}=e;if("range"===t){const{min:i,max:s}=e[t];if(i&&this.value.length<i.value){let e=ee.MIN_CARDINALITY_ERROR;return this.errors.push(te.call(this,e,i).message),{code:e,ctx:i}}if(s&&this.value.length>s.value){let e=ee.MAX_CARDINALITY_ERROR;return this.errors.push(te.call(this,e,s).message),{code:e,ctx:s}}}else if("fixed"===t){const{value:i}=e[t];if(this.value.length!==i){let i=ee.FIX_CARDINALITY_ERROR;return this.errors.push(te.call(this,i,e[t]).message),{code:i,ctx:e[t]}}}}return{code:ee.SUCCESS}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue().map((e=>e.copy(!1)))};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue().map((e=>e.clone()))}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){return this.getValue().map((e=>e.toString()))},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue().map((e=>e.toXML())).join("")+`</${e}>`}};function se(){if(!this.hasConstraint("cardinality"))return 0;const e=this.getConstraint("cardinality"),{type:t}=e;if("range"===t){const{min:i}=e[t];return i.value}if("fixed"===t){const{value:i}=e[t];return i}return 0}function ne(e){return this.model.getConceptSchema(e)}const re=Object.assign(Object.create(Z),ie);Object.defineProperty(re,"count",{get(){return this.value.length}}),Object.defineProperty(re,"canAddValue",{get:()=>!0});const ae=200,le=405;function oe(e,t){switch(e){case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum length: ${t.value}.`};case 402:return{success:!1,message:`Minimum length: ${t.value}.`};case 404:return{success:!1,message:`Fixed length: ${t.value}.`};case le:return{success:!1,message:"The value is not valid."};case 406:return{success:!1,message:"The value is already used."}}}const ce={nature:"primitive",initValue(t){if((0,e.le)(t))return this.value=this.default,this;if((0,e.Kn)(t)){const{id:e="",value:i}=t;e.length>10&&(this.id=e),this.setValue(i)}else this.setValue(t);return this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!(0,e.hr)(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(t){let i=(0,e.Kn)(t)?t.value:t;var{code:s,ctx:n}=this.validate(i);return this.value!==i&&(this.value=i,this.notify("value.changed",i),this.propagate("value.changed",i,this)),s!==ae?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},getProperty(t,i){if("refname"===t)return this.ref.name;if("name"===t)return this.name;if("value"===t)return this.value;if("length"===t)return this.value.length;let s=this.properties.find((e=>e.name===t));if((0,e.le)(s))return;const{type:n,value:r}=s;return"string"===n?r:"number"===n?+r:"boolean"===n?(0,e.sw)(r):r},hasProperty(e){return!!["refname","name","value","length"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){let i=(0,e.XI)(this.getConstraint("values"),[]);return(0,e.xb)(i)?[...this.src.map((i=>{if("reference"===i.type){const{source:s,target:n}=i;let r=this.model.environment.getModel(s.name||s);if((0,e.le)(r))return null;let a=r.concept||r;if(!Array.isArray(a))return null;if(a.forEach((i=>{const s=function(i,s){var n=s;const r=[],a=s=>{let n=i.find((e=>e.name===s));if(!(0,e.le)(n))return(0,t.p$)(n)};for(;!(0,e.le)(n);){const t=(0,e.XI)(a(n),{});l=t.attributes,Array.isArray(l)&&l.forEach((t=>{const i=r.find((e=>e.name===t.name));(0,e.le)(i)?r.push(t):t.required&&(i.required=t.required)})),n=t.prototype}var l;return{attributes:r}}(a,i.prototype);i.attributes.push(...s.attributes)})),(0,e.le)(n.rel))return a.map((e=>e[n.value]));let l=ue.call(this,n,a);return(0,e.le)(l)?[]:l}if("concept"===i.type){const{concept:e,value:t}=i;let s=this.model.getConceptsByPrototype(e.prototype);return console.log(s),"attribute"===t.type?s.map((e=>e.getAttribute(t.name).getValue())):[]}return i}))].flat().filter((t=>!(0,e.le)(t))):i.map((e=>he.call(this,e))).flat().filter((t=>!(0,e.hr)(t)))},getChildren:e=>[],update:(e,t)=>!0,validate(t){if(this.errors=[],(0,e.hr)(t))return{code:ae};if(!this.hasConstraint())return{code:ae};if(this.hasConstraint("length")){let e=this.getConstraint("length");const{type:i}=e;if("range"===i){const{min:s,max:n}=e[i];if(s&&t.length<s.value){let e=402;return this.errors.push(oe.call(this,e,s).message),{code:e,ctx:s}}if(n&&t.length>n.value){let e=403;return this.errors.push(oe.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=e[i];if(t.length!==s){let t=404;return this.errors.push(oe.call(this,t,e[i]).message),{code:t,ctx:e[i]}}}}if(this.hasConstraint("value")){let e=this.getConstraint("value");const{type:i}=e;if("pattern"===i){const{value:i,insensitive:s=!0,global:n=!0}=e.pattern;let r="";if(s&&(r+="g"),n&&(r+="i"),!new RegExp(i,r).test(t)){let t=le;return this.errors.push(oe.call(this,t,e.pattern).message),{code:t,ctx:e.pattern}}}else if(i==="match".startsWith){const{start:s,end:n}=e[i];if(s&&!t.startsWith<s.value){let t=le;return this.errors.push(oe.call(this,t,e.match).message),{code:t,ctx:e.match}}if(n&&t.length>n.value){let t=le;return this.errors.push(oe.call(this,t,e.match).message),{code:t,ctx:e.match}}}else if("unique"===i){const{rel:i="parent",prototype:s}=e.unique;let n=this.getParent(),r=[];if(s?(n.hasPrototype()||(r=[]),r=this.model.getConceptsByPrototype(n._prototype)):r=this.model.getConcepts(n.name),r.some((e=>e!==n&&pe(e,this.ref.name)===t))){let t=406;return this.errors.push(oe.call(this,t,e.unique).message),{code:t,ctx:e.unique}}}}if(this.hasConstraint("values")){let i=this.getConstraint("values").map((e=>he.call(this,e))).flat(),s=!1;for(let n=0;!s&&n<i.length;n++){const r=i[n];s=(0,e.Kn)(r)?r.value===t:r===t}if(!s){let e=401;return this.errors.push(oe.call(this,e,i).message),{code:e,ctx:i}}}return{code:ae}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function he(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}if("meta-reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}function ue(t,i){const{name:s,rel:n,scope:r,value:a}=t;let l=null;if("parent"===n){let t=this.getParent(s);if((0,e.le)(a))return t;if("reference"===a.type)return ue.call(t,a);if("attribute"===a.type)return t.getAttributeByName(a.name).getValue()}if("children"===n){let t=this.getChildren(s);if((0,e.le)(a))return t;if("reference"===a.type)return t.map((e=>ue.call(e,a)));if("attribute"===a.type)return t.filter((e=>fe(e,a.name)&&me(e,a.name))).map((e=>pe(e,a.name)))}if(t.source){const{type:e,value:i}=t.source;l="reference"===e?ue.call(this,t.source):i}if((0,e.le)(l))return i.map((e=>e[s].map((e=>e[a]))));if((0,e.TW)(l)&&(0,e.xb)(l))return[];let o=i.find((e=>Array.isArray(l)?l.includes(e.name):e.name===l));return(0,e.le)(o)||!(0,e.RI)(o,s)?[]:o[s].map((e=>e[a]))}const de=(e,t)=>e.getAttributeByName(t).target,pe=(e,t)=>de(e,t).getValue(),me=(e,t)=>de(e,t).hasValue(),fe=(e,t)=>e.isAttributeCreated(t),ve=Object.assign(Object.create(Z),ce),ge={nature:"concrete",initValue(t){if((0,e.le)(t))return!1;const{id:i="",attributes:s=[]}=t;return i.length>10&&(this.id=i),s.forEach((e=>{const{name:t,id:i,value:s}=e;this.createAttribute(t,s)})),!0},restore(e){const{attributes:t}=e;t.forEach((e=>{const{name:t,id:i,value:s}=e;this.isAttributeCreated(t)||this.createAttribute(t,s)}))},hasValue:()=>!0,getValue(){return{name:this.name,attributes:this.getAttributes().map((e=>({name:e.name,value:e.copy(!1)})))}},setValue(e){const{attributes:t=[]}=e;return t.forEach((e=>{const{name:t,id:i,value:s}=e;this.hasAttribute(t)&&this.createAttribute(t,s)})),!0}},be=Object.assign(Object.create(Z),ge),ye=200;function we(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const Ee={name:"prototype",nature:"prototype",initValue(t){if((0,e.le)(t)){if(this.default){let e=this.createConcept(this.default);this.setValue(e)}return this}const{id:i="",value:s}=t;i.length>10&&(this.id=i);let n=null;return s?(n=this.createConcept(s.name,s),this.setValue(n)):t.name&&t.attributes&&(n=this.createConcept(t.name,t),this.setValue(n)),this},getValue(t=!1){return(0,e.le)(this.value)?null:t?this.target:this.value},getTarget(){return this.target},restore(t){const{value:i}=t;if((0,e.le)(i))return;let s=this.createConcept(i.name,i);this.setValue(s)},setValue(t){let i=t.name||t;if(this.validate(i)!==ye)return{success:!1,message:"Validation failed: The value could not be updated."};let s=t;if(t&&"concept"===t.object&&(0,e.RI)(t,"id")||(s=t.attributes?this.createConcept(i,t):this.createConcept(i)),this.target){let e=this.target.copy(!1);this.target.delete(!0),s.setValue(e)}return this.target=s,this.value=i,this.notify("value.changed",this.getCandidates().find((e=>e.name===this.value))),{success:!0,message:"The value has been successfully updated."}},removeValue(){return(0,e.le)(this.value)||(this.value=null,this.notify("value.changed",this.value)),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!(0,e.le)(this.value)},getCandidates(){return this.candidates||(this.candidates=Ce.call(this,this.schema.accept).map((e=>({type:"meta-concept",name:e.name,concept:Object.create(je,{object:{value:"meta-concept"},type:{value:"meta-concept"},name:{value:e.name},model:{value:this.model},schema:{value:e}})})))),this.candidates},getChildren(t){if(!this.hasValue())return[];const i=[];return((0,e.le)(t)||this.target.name===t)&&i.push(this.target),i},createConcept(e,t){let i=this.model.getValue(t);const s={parent:this,ref:this};i&&(s.value=i);const n=this.model.createConcept(e,s);return n.prototype=this,n},validate(t){if((0,e.hr)(t))return ye;if((0,e.xb)(this.values))return ye;var i=!1;for(let s=0;!i&&s<this.values.length;s++){const n=this.values[s];i=(0,e.Kn)(n)?n.value===t:n===t}if(!i){let e=401;return this.errors.push(we.call(this,e).message),e}return ye},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.target.copy(!1)};return e&&this.model.addValue(t),t},clone(){let e=null;return this.hasValue()&&(e=this.target.clone()),{id:this.id,name:this.name,value:e}},export(){let e=null;return this.hasValue()&&(e={id:this.target.id,name:this.target.name}),{id:this.id,name:this.name,root:this.isRoot(),value:e}},toXML(){if(!this.hasValue())return"";let e=this.getName();return`<${e} id="${this.id}">`+this.target.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function Ce(t){const i=this.model.getConcreteConcepts(this.name);return(0,e.le)(t)?i:Array.isArray(t)?i.filter((e=>t.some((t=>t.name===e.name)))):i.filter((e=>t===e.name))}const je={getProperty(t,i){if("refname"===t)return this.name;if("name"===t)return this.name;let s=this.properties.find((e=>e.name===t));if((0,e.le)(s))return;const{type:n,value:r}=s;return"string"===n?r:"number"===n?+r:"boolean"===n?(0,e.sw)(r):r},hasPrototype(t){if((0,e.le)(this.schema.prototype))return!1;let i=this.model.getConceptSchema(this.schema.prototype);for(;!(0,e.le)(i);){if(i.name===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1}},Le=Object.assign({},Z,Ee);function xe(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const Re={name:"meta",reference:null,initValue(t){return(0,e.le)(t)||this.setValue(t.value),this},hasValue(){return!(0,e.hr)(this.value)},getValue(){return(0,e.le)(this.value)?null:this.value},getProperty(t){const i=this.schema[t];if((0,e.Kn)(i)){const e=[];for(const t in i){const s=i[t];e.push(Object.assign({},{name:t},s))}return e}return i},setValue(t){var i=this.validate(t);return 200!==i?{success:!1,message:"Validation failed: The value could not be updated.",errors:[xe(i).message]}:(0,e.le)(t)||this.value===t?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(t),this.reference.register(this),this.value=t,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:e=>[],delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(t){return(0,e.hr)(t)||(0,e.xb)(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}},Ie=Object.assign({},Z,Re);function Ae(e,t){return{object:{value:"concept"},type:{value:"concept"},model:{value:e},name:{value:t.name},base:{value:t.base},schema:{value:t,writable:!0}}}const Oe={boolean:(e,t)=>Object.create(z,Ae(e,t)),number:(e,t)=>Object.create(G,Ae(e,t)),reference:(e,t)=>Object.create(Y,Ae(e,t)),set:(e,t)=>Object.create(re,Ae(e,t)),string:(e,t)=>Object.create(ve,Ae(e,t)),meta:(e,t)=>Object.create(Ie,Ae(e,t))},Se={primitive:(e,t)=>Oe[t.name](e,t),prototype:(e,t)=>Object.create(Le,Ae(e,t)),concrete:(e,t)=>Object.create(be,Ae(e,t)),derivative:(e,t)=>Oe[t.base](e,t)},Ve={createConcept(t,i,s){const{name:n,nature:r}=i,a=Se[r];if((0,e.le)(a))throw new Error(`Missing handler: The '${n}' concept could not be handled`);const l=a(t,i);if((0,e.le)(l))throw new Error(`Bad request: The '${n}' concept could not be created`);return l.init(s),(0,e.le)(l.id)&&(l.id=T.h.generate()),l}};var _e=0;const Te={concepts:null,values:null,listeners:null,get hasError(){return this.concepts.some((e=>e.hasError))},init(e){return this.concepts=[],this.values=[],this.listeners=[],Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},done(){return this.concepts.forEach((e=>{e.done()})),this.concepts=[],!0},createConcept(e,t){const i=this.getCompleteModelConcept(e);var s=Ve.createConcept(this,i,t);return this.addConcept(s),s},getConcepts(t){if((0,e.TW)(t)){const e=Array.isArray(t)?e=>t.includes(e.name):e=>e.name===t;return this.concepts.filter((t=>e(t)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((e=>e.isRoot()))},getConceptsByPrototype(e){return this.concepts.filter((t=>t.hasPrototype(e)))},getConcept(t){if(!(0,e.HD)(t)||(0,e.xb)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((e=>e.id===t))},addConcept(t){if((0,e.le)(t))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(t),t.register(this.environment),this},removeConcept(t){if(!(0,e.Kn)(t)&&!(0,e.HD)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var i=this.concepts.findIndex((e=>e.id===t));return-1===i?null:this.concepts.splice(i,1)[0]},hasConcept(t){if(!(0,e.Kn)(t)&&!(0,e.HD)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");if((0,e.xb)(this.concepts))return!1;let i=t.id||t;return t.name,this.concepts.some((e=>e.id===i))},getValues(t){if((0,e.TW)(t)){const e=Array.isArray(t)?e=>t.includes(e.name):e=>e.name===t;return this.values.filter((t=>e(t)))}return this.values.slice()},getValue(t){return(0,e.le)(t)?null:(0,e.RI)(t,"value")||(0,e.RI)(t,"attributes")?t:(0,e.RI)(t,"id")?this.values.find((e=>e.id===t.id)):this.values.find((e=>e.id===t))},addValue(t){if((0,e.le)(t))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((e=>{return s=t,(i=e).name===s.name&&(i.value?i.value===s.value:JSON.stringify(i.attributes)===JSON.stringify(s.attributes));var i,s}))||(t.id="value"+_e++,this.values.push(t),this.notify("value.added",t)),this},removeValue(t){if(!(0,e.Kn)(t)&&!(0,e.HD)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var i=this.values.findIndex((e=>e.id===t));if(-1===i)return null;let s=this.values.splice(i,1)[0];return this.notify("value.removed",s),s},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){let t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t)}))},isConcept(t){return!!(0,e.HD)(t)&&-1!==this.schema.findIndex((e=>e.name===t))},isConcrete(t){if(!(0,e.HD)(t))return!1;const i=this.schema.find((e=>e.name===t));return!(0,e.le)(i)&&"concrete"===i.nature},isPrototype(t){if(!(0,e.HD)(t))return!1;const i=this.schema.find((e=>e.name===t));return!(0,e.le)(i)&&"prototype"===i.nature},hasPrototype(t,i){if(!this.isConcept(t))return!1;let s=this.getConceptSchema(t);for(;!(0,e.le)(s);){if(s.prototype===i)return!0;s=this.model.getConceptSchema(s.prototype)}return!1},addConceptSchema(e){return this.schema.push(...e),this.environment.update("concept-model.updated"),!0},getSchema(t){if((0,e.TW)(t)){const e=Array.isArray(t)?e=>t.includes(e.nature):e=>e.nature===t;return this.schema.filter((t=>e(t)))}return this.schema.slice()},getConceptSchema(i){const s=Me(this.schema,i);if(!(0,e.le)(s))return(0,t.p$)(s)},getCompleteModelConcept(t){let i=t;(0,e.HD)(t)&&(i={name:t});const s=this.getConceptSchema(i.name);if((0,e.le)(s))return;Object.assign(s,i),(0,e.RI)(s,"attributes")||(s.attributes=[]);const n=He.call(this,s.prototype);return s.attributes.push(...n.attributes),s},getConcreteConcepts(t){const i=i=>{for(var s=i.prototype;!(0,e.le)(s);){if(s===t)return!0;s=(0,e.XI)(Me(this.schema,s),{}).prototype}return!1},s=this.schema.filter((e=>"concrete"===e.nature));return t?s.filter((e=>i(e))):s},getDerivedConcepts(t){if((0,e.le)(t))throw new TypeError("Bad argument");return this.schema.filter((e=>e.base===t))},export(){const e=[];return this.getConcepts().forEach((t=>{e.push(t.export())})),e.push(...this.getValues()),e},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})},toXML(){return"<model:gentleman>"+this.getRootConcepts().map((e=>e.toXML())).join("")+"</model:gentleman>"}};function He(t){var i=t;const s=[];for(;!(0,e.le)(i);){const t=(0,e.XI)(this.getConceptSchema(i),{});n=t.attributes,Array.isArray(n)&&n.forEach((t=>{const i=s.find((e=>e.name===t.name));(0,e.le)(i)?s.push(t):t.required&&(i.required=t.required)})),i=t.prototype}var n;return{attributes:s}}const ke=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function Me(t,i){let s=t.find((e=>e.name===i));return(0,e.le)(s)&&(s=ke.find((e=>e.name===i))),s}const $e=[],Pe={createModel(t,i){var s=Object.create(Te,{schema:{value:(0,e.XI)(t,[])},environment:{value:i}});return $e.push(s),s}};function Ne(t){const{type:i}=t;let s=this.concept||this.source;return"property"===i?(0,e.XI)(s.getProperty(t.name),""):"param"===i?this.projection.getParam(t.name):t}const De={css:function(t,i){return(0,e.TW)(i)?(ze(t,i),t):t},ref:function(t,i){return(0,e.TW)(i)?(i.forEach((i=>{const{style:s={}}=(0,e.XI)(this.model.getStyleSchema(i),{});s.gss?Xe.call(this,t,s):Ze.call(this,t,s)})),t):t},gss:Ze,text:Fe,box:Ge,html:function(t,i){return(0,e.TW)(i)?(i.forEach((i=>{let s=`style${(0,e.fm)(i.name)}`;t.dataset[s]=Ne.call(this,i.value),"property"===i.value.type&&this.registerHandler("value.changed",(e=>{t.dataset[s]=Ne.call(this,i.value)}))})),t):t}},Be={text:Fe,box:Ge};function Xe(t,i){if(!(0,e.Kn)(i))return t;for(const s in i){const n=i[s];let r=De[s];(0,e.mf)(r)&&r.call(this,t,n)}return t}function Ze(t,i){if(!(0,e.Kn)(i))return t;for(const s in i){const n=i[s];let r=Be[s];(0,e.mf)(r)&&r.call(this,t,n)}return t}function Fe(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"bold":e.style.fontWeight=qe(s);break;case"italic":e.style.fontStyle="italic";break;case"underline":e.style.textDecoration="underline";break;case"strikethrough":e.style.textDecoration="line-through";break;case"color":e.style.color=We(s);break;case"font":e.style.fontFamily=s.toString();break;case"size":e.style.fontSize=Ue(s);break;case"transform":e.style.textTransform=s}}return e}function ze(t,i){if(Array.isArray(i))t.classList.add(...i);else{let s=i.replace(/\s+/g," ").trim();(0,e.hr)(t.className)?t.className=s:ze(t,s.split(" "))}return t}function We(t){if((0,e.le)(t))return"";const{type:i,value:s}=t;switch(i){case"rgb":return(0,e.Kn)(s)?`rgb(${s.red}, ${s.green}, ${s.blue})`:s;case"rgba":return(0,e.Kn)(s)?`rgba(${s.red}, ${s.green}, ${s.blue}, ${s.opacity/100})`:s;case"name":case"hexadecimal":return s;default:return s||t}}function qe(t){if((0,e.le)(t))return"";const{type:i,value:s}=t;return Number.isInteger(t)?`${t}`:"bold"}function Ue(t){if((0,e.le)(t))return"";const{value:i,unit:s}=t;return(0,e.le)(i)?"":`${i}${s}`}function Ge(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"inner":Ke.call(this,e,s,"padding");break;case"outer":Ke.call(this,e,s,"margin");break;case"border":Ye.call(this,e,s);break;case"corner":et.call(this,e,s);break;case"background":Qe.call(this,e,s);break;case"width":e.style.width=Ue.call(this,s);break;case"height":e.style.height=Ue.call(this,s);break;case"opacity":e.style.opacity=s/100;break;case"shadow":Je.call(this,e,s,"shadow")}}return e}function Ke(t,i,s){if(!(0,e.le)(i))for(const e in i){const n=i[e];switch(e){case"all":t.style[`${[s]}`]=Ue.call(this,n);break;case"top":t.style[`${[s]}Top`]=Ue.call(this,n);break;case"right":t.style[`${[s]}Right`]=Ue.call(this,n);break;case"bottom":t.style[`${[s]}Bottom`]=Ue.call(this,n);break;case"left":t.style[`${[s]}Left`]=Ue.call(this,n)}}}function Qe(t,i){if((0,e.le)(i))return;const{color:s,image:n}=i;s&&(t.style.backgroundColor=We.call(this,s)),n&&(t.style.backgroundImage=`url(${n})`)}function Je(t,i){if((0,e.le)(i))return null;const{offsetX:s,offsetY:n,blur:r,spread:a,inset:l=!1,color:o}=i;if((0,e.le)(s)||(0,e.le)(n))return null;let c=Ue.call(this,s),h=Ue.call(this,n),u=Ue.call(this,r),d=Ue.call(this,a),p=We.call(this,o);t.style.boxShadow=l?`inset ${c} ${h} ${u} ${d} ${p}`.trim():`${c} ${h} ${u} ${d} ${p}`.trim()}function Ye(t,i){if(!(0,e.le)(i))for(const s in i){const n=i[s];switch(s){case"all":t.style.borderStyle=(0,e.XI)(n.type,"solid"),t.style.borderWidth=Ue.call(this,n.width),t.style.borderColor=We.call(this,n.color);break;case"top":t.style.borderTopStyle=(0,e.XI)(n.type,"solid"),t.style.borderTopWidth=Ue.call(this,n.width),t.style.borderTopColor=We.call(this,n.color);break;case"right":t.style.borderRightStyle=(0,e.XI)(n.type,"solid"),t.style.borderRightWidth=Ue.call(this,n.width),t.style.borderRightColor=We.call(this,n.color);break;case"bottom":t.style.borderBottomStyle=(0,e.XI)(n.type,"solid"),t.style.borderBottomWidth=Ue.call(this,n.width),t.style.borderBottomColor=We.call(this,n.color);break;case"left":t.style.borderLeftStyle=(0,e.XI)(n.type,"solid"),t.style.borderLeftWidth=Ue.call(this,n.width),t.style.borderLeftColor=We.call(this,n.color)}}}function et(t,i){if((0,e.le)(i))return null;for(const e in i){const s=i[e];switch(e){case"all":t.style.borderRadius=Ue.call(this,s);break;case"top-left":t.style.borderTopLeftRadius=Ue.call(this,s);break;case"top-right":t.style.borderTopRightRadius=Ue.call(this,s);break;case"bottom-right":t.style.borderBottomRightRadius=Ue.call(this,s);break;case"bottom-left":t.style.borderBottomLeftRadius=Ue.call(this,s)}}}function tt(t,i){if(!Array.isArray(i))return!1;t.currentState=null;for(let s=0;s<i.length;s++){const n=i[s],{rule:r,result:a}=n;if((0,e.le)(r))return a;let l=!1,o=it[r.type];if((0,e.mf)(o)&&(l=o.call(this,r[r.type])),l)return t.currentState=s,a}return null}const it={ref:function(t){const{rule:i={}}=(0,e.XI)(this.model.getRuleSchema(t),{});let s=it[i.type];return!!(0,e.mf)(s)&&s.call(this,i[i.type])},eq:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return st.call(this,e[0])==st.call(this,e[1])},ne:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return st.call(this,e[0])!=st.call(this,e[1])},lt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return st.call(this,e[0])<st.call(this,e[1])},le:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return st.call(this,e[0])<=st.call(this,e[1])},gt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return st.call(this,e[0])>st.call(this,e[1])},ge:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return st.call(this,e[0])>=st.call(this,e[1])},and:function(e){return nt.call(this,e[0])&&nt.call(this,e[1])},or:function(e){return nt.call(this,e[0])||nt.call(this,e[1])},not:function(e){return!nt.call(this,e[0])},no:function(t){let i=st.call(this,t);return(0,e.TW)(i)?(0,e.xb)(i):(0,e.le)(i)}};function st(t,i){if(t&&"property"===t.type){const{name:i}=t;let s=`get${(0,e.Ho)(i)}`;return this[s]?this[s]():this[i]}if(t&&"param"===t.type){const{name:e}=t;return this.projection.getParam(e)}if((0,e.Kn)(t)){let i=`get${(0,e.Ho)(t.prop)}`;return this[i]?this[i]():this[t.prop]}return i||t}function nt(t){let i=it[t.type];return(0,e.mf)(i)?i.call(this,t[t.type]):(0,e.sw)(st.call(this,t))}const rt={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,children:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return this.source.hasError},get hasAttached(){return!(0,e.xb)(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(t){return(0,e.mf)(t)?this.attached.filter((e=>t(e))):this.attached},show(){return(0,t.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,t.Cp)(this.element),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},focus(e){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},getContainer(){return this.element},notify(e,i,s){(0,t.lL)(this.element),this.environment.notify(e,i)},append(t){if(!(0,e.Re)(t))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.append(t),this},_focusIn:e=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var i=this.source.delete();i.success?(this.clear(),(0,e.ep)(this.element),this.element.remove()):(this.environment.notify(i.message),(0,t.lL)(this.element))},spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(e){this.focusOut()},deleteHandler(i){if(this.projection.element!==this)return(0,t.lL)(i),!1;if(!this.projection.optional)return(0,t.lL)(this.element),!1;let s=(0,e.wr)(i,(e=>0===e.tabIndex)),n=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),n),this.source.delete();let r=this.environment.resolveElement(s);return(0,e.le)(r)||r.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){return console.warn(`ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()},shiftHandler(e,t){return console.warn(`SHIFT_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1}},at=Object.assign(rt);function lt(t){const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.XI)(this.source.getProperty(t.name),"")):"param"===i?this.projection.getParam(t.name):"html"===i?(0,e.Bv)(t.html):"raw"===i?(0,e.Bv)(t.raw):t}const ot={input:null,label:null,value:"",state:null,init(){const{focusable:e=!0}=this.schema;return this.focusable=e,this.children=[],this},refresh(){if((0,e.XI)(tt.call(this,this.schema,this.schema.state),this.schema),this.schema.state){let t=this.schema.state[this.getValue().toString()];if(t&&t.content){const{style:i,content:s,value:n}=t;let r=(0,e.DZ)();s.forEach((e=>{r.append(ji.call(this,e))})),(0,e.ep)(this.label).append(r),Xe.call(this.projection,this.label,i)}}this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",this.hasError?(this.element.classList.add("error"),this.input.classList.add("error")):(this.element.classList.remove("error"),this.input.classList.remove("error"))},render(){const i=(0,e.DZ)(),{checkbox:s}=this.schema;var n;if((0,e.Re)(this.element)||(this.element=(n=this.id,(0,e.wC)({id:n,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:n}})),this.readonly&&this.element.classList.add("readonly"),Xe.call(this.projection,this.element,this.schema.style)),!(0,e.Re)(this.input)){if(this.input=function(t){return(0,e.Ju)({id:`checkbox${t}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:t}})}(this.id),this.input.checked=this.source.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),s){const{style:e}=s;Xe.call(this.projection,this.input,e)}else(0,t.Cp)(this.input);i.append(this.input)}if(!(0,e.Re)(this.label)){if(this.label=(0,e._)({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,s&&s.label){const{content:t}=s.label;if(Array.isArray(t))t.forEach((t=>{let i=lt.call(this,t),s=(0,e.kQ)({class:["field--checkbox__label-content"],dataset:{ignore:"all"}},i);Xe.call(this.projection,s,t.style),this.label.append(s)}));else{let e=lt.call(this,t);this.label.append(e)}Xe.call(this.projection,this.label,s.label.style)}i.append(this.label)}return i.hasChildNodes()&&(this.element.append(i),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.choice&&(0,t.Cp)(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||this.environment.notify(i.message,"error"),this.input.checked=e,this.value=e,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),s){let t=(0,e.wr)(i,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}},backspaceHandler(e){return this.arrowHandler("left",e)},enterHandler(e){this.setValue(!this.input.checked,!0)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,this.element)},bindEvents(){this.element.addEventListener("change",(e=>{this.setValue(this.getValue(),!0)})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},ct=Object.assign(Object.create(at),ot);function ht(t){const i=e=>e.parentElement===this.choices;return i(t)?t:(0,e.wr)(t,i,5)}function ut(e){const{type:t}=e.dataset;return t}function dt(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)).id:"meta-concept"===t?this.values.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const pt=(e,t)=>"concept"===e.type?pt(e.id,t):"concept"===t.type?pt(e,t.id):"meta-concept"===e.type?pt(e.name,t):"meta-concept"===t.type?pt(e,t.name):e===t,mt={value:null,placeholder:null,expanded:null,values:null,choices:null,input:null,items:null,selection:null,selectList:null,selectListValue:null,icoToggle:null,init(t={}){Object.assign(this.schema,t);const{focusable:i=!0,placeholder:s=!1,expanded:n=!0}=this.schema;return this.items=new Map,this.focusable=i,this.expanded=n,this.placeholder=s,this.children=[],(0,e.RI)(this.schema,"choice")||(this.schema.choice={}),(0,e.RI)(this.schema.choice,"option")||(this.schema.choice.option={}),this},hasChanges(){return this.value!=this.source.getValue()},reset(){this.source.removeValue()},hasValue(){return!(0,e.le)(this.value)},getValue(){return this.selection},setValue(i,s=!1){var n=null;if(s)return(n=this.source.setValue(i)).success||this.environment.notify(n.message,t.k$.ERROR),!0;(0,e.le)(i)?(this.selection&&this.selection.classList.remove("selected"),this.expanded||(0,e.ep)(this.selectListValue),this.selection=null):this.setChoice(i),(0,e.le)(i)?this.value=null:"concept"===i.type?this.value=i.id:"meta-concept"===i.type?this.value=i.name:this.value=i;const{template:r={}}=this.schema.choice.option;if(this.selection&&!this.expanded&&i)if((0,e.ep)(this.selectListValue),"meta-concept"===i.type){let t=this.model.getProjectionSchema(i.concept,(0,e.XI)(r.tag))[0],s=t.type,n={type:s,[s]:t.content||t.projection},a=ji.call(this,n,i.concept,{focusable:!1,meta:i.name});this.selectListValue.append(a)}else if("concept"===i.type){let e=this.model.createProjection(i,r.tag).init({focusable:!1});e.readonly=!0,e.focusable=!1,e.parent=this.projection,this.selectListValue.append(e.render())}else this.selectListValue.append(i.toString());this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value="",!this.expanded&&this.placeholder&&(0,e.ep)(this.selectListValue).append(this.placeholder)),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error")):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error")),this},render(){const t=(0,e.DZ)(),{choice:i,input:s,style:n}=this.schema;if((0,e.Re)(this.element)||(this.element=(0,e.wC)({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),!(0,e.Re)(this.input)&&s){const{placeholder:i="",type:n,style:r}=s;let a=Ei.call(this,i);this.input=(0,e.Ju)({class:["field--choice__input"],type:(0,e.XI)(n,"text"),placeholder:a,title:a,dataset:{nature:"field-component",view:this.type,id:this.id}}),Xe.call(this,this.input,r),t.append(this.input)}if(!(0,e.Re)(this.choices)){const{style:s}=i;this.choices=(0,e.w_)({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),Xe.call(this,this.choices,s),t.append(this.choices)}if(!this.expanded){let i=(0,e.wC)({class:["field--choice__select-wrapper"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}});this.selectListValue=(0,e.wC)({class:["field--choice__select-value"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),this.icoToggle=(0,e.oL)({class:["field--choice__select-icon"],dataset:{nature:"field-component",view:"choice",id:this.id}}),i.append(this.selectListValue,this.icoToggle),this.selectList=(0,e.wC)({class:["field--choice__select-list","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.input&&this.selectList.append(this.input),this.selectList.append(this.choices),t.append(i),t.append(this.selectList)}if(Xe.call(this,this.element,n),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),(0,e.ep)(this.choices),this.placeholder){const{style:t}=this.schema.choice.option;let i=(0,e.HV)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(i),Xe.call(this,i,t)}return this.values=this.source.getCandidates(),this.values.forEach((e=>{this.choices.append(this.createChoiceOption(e))})),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},focus(e){if(this.expanded)if(this.choices.hasChildNodes()){let e=(0,t.sB)(this.choices);e&&e.focus()}else this.input&&!(0,t.xj)(this.input)?this.input.focus():this.selection&&this.selection.focus();else this.input&&!(0,t.xj)(this.input)?this.input.focus():this.selectListValue.focus();return this.element.classList.add("active"),this},navigate(i,s,n){let r=null;if("up"===i?r=(0,t.GV)(this.element):"down"===i?r=(0,t.Sd)(this.element):"left"===i?r=(0,t.GF)(this.element):"right"===i&&(r=(0,t.EE)(this.element)),(0,e.le)(r))return!1;r.focus()},focusIn(){this.focused=!0,this.element.classList.add("active");const i=(0,e.DZ)();return this.source.getCandidates().filter((e=>!this.values.some((t=>pt(t,e))))).forEach((e=>{i.append(this.createChoiceOption(e)),this.values.push(e)})),this.choices.append(i),this.expanded||((0,t.$Z)(this.selectList),this.selectList.dataset.state="open"),this},focusOut(){if(this.readonly)return;this.input&&(0,e.hr)(this.input.value)&&(this.input.value=""),this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:i}=this.choices;for(let e=0;e<i.length;e++){const s=i[e];(0,t.$Z)(s),s.hidden=!1}return this.expanded||((0,t.Cp)(this.selectList),this.selectList.dataset.state="close"),this.focused=!1,this},showChoices(){const{children:e}=this.choices;for(let i=0;i<e.length;i++){const s=e[i];(0,t.$Z)(s),s.hidden=!1}},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(i){const{children:s}=this.choices;if(this.element.dataset.input=i.trim(),(0,e.hr)(i)){for(let e=0;e<s.length;e++){const i=s[e];(0,t.$Z)(i),i.hidden=!1}return}this.element.classList.add("querying");let n=i.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<s.length;e++){const i=s[e];let r=i.textContent.toLowerCase(),a=r.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();n.some((e=>r.includes(e)||a.includes(e)))?((0,t.$Z)(i),i.hidden=!1):((0,t.Cp)(i),i.hidden=!0)}return!0},createChoiceOption(t){const{template:i={},style:s}=this.schema.choice.option,n=(0,e.Kn)(t),r=(0,e.HV)({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:n?"concept":"value",value:n?t.id:t}});if(Xe.call(this,r,s),this.items.set(t.id,r),"meta-concept"===t.type){let s=this.model.getProjectionSchema(t.concept,(0,e.XI)(i.tag))[0],n=s.type,a={type:n,[n]:s.content||s.projection},l=ji.call(this,a,t.concept,{focusable:!1,meta:t.name});r.dataset.type="meta-concept",r.dataset.value=t.name,r.append(l)}else if(n){if(!this.model.hasProjectionSchema(t,i.tag))return r;let e=this.model.createProjection(t,i.tag).init({focusable:!1});e.readonly=!0,e.focusable=!1,e.parent=this.projection,r.append(e.render())}else r.append(t.toString());return r},setChoice(e){const{children:i}=this.choices;let s=!1;for(let n=0;n<i.length;n++){const r=i[n];let a=dt.call(this,r);a&&pt(a,e)?(r.classList.add("selected"),r.dataset.selected="selected",this.selection=r,(0,t.$Z)(r),s=!0):(r.classList.remove("selected"),delete r.dataset.selected)}return this},delete(){if(this.hasValue())this.reset();else{let i=this.source.delete();i.success?(this.clear(),(0,e.ep)(this.element),this.element.remove()):(this.environment.notify(i.message),(0,t.lL)(this.element))}},_spaceHandler(i){let s=this.source.getCandidates();if((0,e.xb)(s))return void this.notify("No candidates found.",t.k$.INFO);const n=(0,e.DZ)();if(s.forEach((e=>{n.append(this.createChoiceOption(e))})),(0,e.ep)(this.choices),this.placeholder){const{style:t}=this.schema.choice.option;let i=(0,e.HV)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(i),Xe.call(this,i,t)}this.choices.append(n),this.filterChoice(this.input.value),(0,t.$Z)(this.choices),this.element.classList.add("querying")},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),!this.expanded&&"open"===this.selectList.dataset.state)return(0,t.Cp)(this.selectList),this.selectList.dataset.state="close",!0;if(s){let t=(0,e.wr)(i,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.focus()},enterHandler(i){const s=ht.call(this,i);(0,e.Re)(s)&&this.selection!==s&&("placeholder"===ut(s)?this.source.removeValue():this.setValue(dt.call(this,s),!0),this.expanded||((0,t.Cp)(this.selectList),this.selectList.dataset.state="close",this.focus()))},backspaceHandler(e){ht.call(this,e)&&this.input&&this.input.focus()},clickHandler(i){const s=ht.call(this,i);(0,e.Re)(s)&&this.selection!==s?("placeholder"===ut(s)?this.source.removeValue():this.setValue(dt.call(this,s),!0),this.expanded||((0,t.Cp)(this.selectList),this.selectList.dataset.state="close")):i===this.selectListValue&&((0,t.$Z)(this.selectList),this.selectList.dataset.state="open")},arrowHandler(i,s){if(!(0,e.Re)(s))return!1;const{parentElement:n}=s,r=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);if(!this.expanded&&s===this.selectListValue)return this.arrowHandler(i,this.selectListValue.parentElement);let a=ht.call(this,s);if(a){let s=(0,t.As)(a,i,this.choices,!1);return(0,e.Re)(s)?(s.focus(),!0):this.arrowHandler(i,this.choices)}if(this.expanded&&n!==this.element)return r();let l=(0,t.As)(s,i,n,!1);return(0,e.Re)(l)?(l===this.selectList&&(l=this.input||this.choices),l===this.choices&&this.choices.hasChildNodes()&&("up"===i?l=(0,t.GV)(this.choices):"down"===i?l=(0,t.Sd)(this.choices):"left"===i?l=(0,t.GF)(this.choices):"right"===i&&(l=(0,t.EE)(this.choices))),l.focus(),!0):r()},bindEvents(){(0,e.Re)(this.input)&&this.element.addEventListener("input",(e=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((e,t)=>{this.setValue(e)}))}},ft=Object.assign(Object.create(at),mt),vt={content:[{type:"static",static:{type:"text",content:"+",focusable:!1}}]};function gt(t){if(!(0,e.Re)(t))return!1;const{nature:i,id:s}=t.dataset;return"field-component"===i&&s===this.id}function bt(t){const i=e=>e.parentElement===this.list;return i(t)?t:(0,e.wr)(t,i,3)}const yt={list:null,items:null,elements:null,selection:null,content:null,init(t){const{focusable:i=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.children=[],this.focusable=i,(0,e.RI)(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(t,i=!1){i&&this.source.setValue(t),this.list&&((0,e.ep)(this.list),t.forEach((e=>{var t=this.createItem(e);this.list.append(t)}))),this.refresh()},clear(){this.items.clear(),this.list&&(0,e.ep)(this.list)},focus(i){if(this.hasValue()&&this.list)this.list.firstElementChild.focus();else{let i=(0,t.Sd)(this.element,(e=>e!==this.list));if(!(0,e.Re)(i))return this;i.focus()}return this},navigate(i,s,n){let r=null;if("up"===i?r=(0,t.GV)(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"down"===i?r=(0,t.Sd)(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"left"===i?r=(0,t.GF)(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"right"===i&&(r=(0,t.EE)(this.element,(e=>e!==this.notification&&e.hasChildNodes()))),!(0,e.Re)(r))return!1;let a=this.environment.resolveElement(r);return!(0,e.le)(a)&&(a.focus(),!0)},focusIn(e){this.focused=!0,this.element.classList.add("active");const{component:t}=e.dataset},focusOut(){if(!this.readonly)return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(t){return(0,e.le)(t)?null:(0,e.RI)(t,"id")?this.items.get(t.id):this.items.get(t)},getItemIndex:t=>(0,e.Re)(t)?t.dataset.index:null,createItem(e){const{template:t={},style:i}=this.schema.list.item;if(!this.model.hasProjectionSchema(e,t.tag))return"";let s=this.model.createProjection(e,t.tag);s.optional=!0,s.collapsible=!0,s.parent=this.projection;let n=s.init(t.options).render();return n.dataset.index=e.index,s.element.parent=this,s.registerHandler("view.changed",(e=>{Xe.call(this.projection,e,i)})),Xe.call(this.projection,n,i),this.items.set(e.id,n),n},addItem(t){if(!(0,e.Re)(this.list))return;const i=this.createItem(t);t.index?this.list.children[t.index-1].after(i):this.list.append(i),this.refresh()},removeItem(t){this.hasList&&!(0,e.le)(t)&&(this.items.delete(t.id),this.items.forEach(((e,t)=>{let i=this.source.getElement(t);i&&(e.dataset.index=i.index)})),this.refresh())},moveItem(e,t,i=!1){return this.list.children[t].before(e),e.dataset.index=t,i&&this.source.swapElement(+this.getItemIndex(e),+t),this},swapItem(e,t,i=!1){const s=this.getItemIndex(e),n=this.getItemIndex(t);return this.moveItem(t,s),this.moveItem(e,n),i&&this.source.swapElement(+s,+n),this},delete(e){if(e===this.element)return this.environment.save(this.source.getParent()),void this.source.remove();const{index:i}=e.dataset;var s=this.source.removeElementAt(+i);if(s.success)if(this.hasValue()){let e=+i<this.list.childElementCount?+i:this.list.childElementCount-1;this.list.children[e].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${s.message}`),(0,t.lL)(e)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list&&this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list&&this.list.classList.add("empty")),this.elements.forEach(((t,i)=>{if(!Array.isArray(i.state))return;const{currentState:s}=i,n=tt.call(this,i,i.state);if(s===i.currentState)return;let r=i.content;n&&(r=n.content);let a=(0,e.DZ)();r.forEach((e=>{let t=ji.call(this,e,null,{focusable:!1});a.append(t)})),(0,e.ep)(t).append(a)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},render(){const t=(0,e.DZ)(),{list:i,style:s,action:n={}}=this.schema;if((0,e.Re)(this.element)||(this.element=(0,e.wC)({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Xe.call(this.projection,this.element,this.schema.style)),i&&!(0,e.Re)(this.list)){const{style:s}=i;this.list=(0,e.wC)({class:["field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),i.currentState=null,this.elements.set(i,this.list),Xe.call(this.projection,this.list,s),t.append(this.list)}let r=(0,e.XI)(n.add,vt);if(r){const{position:i="after",content:s,help:n,style:a}=r;let l=(0,e.ax)({class:["field-action","field--list__add"],tabindex:0,title:n,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});s.forEach((e=>{let t=ji.call(this,e,null,{focusable:!1});l.append(t)})),r.currentState=null,this.elements.set(r,l),Xe.call(this.projection,l,a),"before"===i&&this.list?this.list.before(l):t.append(l)}return this.list&&this.source.getValue().forEach((e=>{var t=this.createItem(e);this.list.append(t)})),Xe.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},_spaceHandler(e){this.notify(`Add or remove ${this.source.accept.name}`)},spaceHandler(t){return!!(0,e.Re)(t)&&t.parentElement===this.list&&(this.createElement(),!0)},deleteHandler(e){return!(!gt.call(this,e)||e.parentElement!==this.list||(this.delete(e),0))},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),s){let t=(0,e.wr)(i,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}return this.focus(),!1},enterHandler(t){const i=(t=>gt.call(this,t)?t:(0,e.wr)(t,(e=>gt.call(this,e)),5))(t);if((0,e.le)(i))return this.focus(),!1;const{action:s,index:n,component:r}=i.dataset;return"add"===s?(this.createElement(),!0):"remove"===s&&(this.delete(i.parentElement),!0)},backspaceHandler:e=>!1,clickHandler(t){const i=(t=>gt.call(this,t)?t:(0,e.wr)(t,(e=>gt.call(this,e)),5))(t);if((0,e.le)(i))return;const{action:s,index:n,name:r}=i.dataset;"add"===s?this.createElement():"remove"===s&&this.delete(i.parentElement)},_arrowHandler(i,s){if(!(0,e.Re)(s))return!1;let n=bt.call(this,s);if(n){let s=(0,t.As)(n,i,this.list);return!!(0,e.Re)(s)&&(this.swapItem(n,s,!0),n.focus(),!0)}return!1},arrowHandler(i,s){if(!(0,e.Re)(s))return!1;const{parentElement:n}=s,r=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);if(n===this.list){let n=(0,t.As)(s,i,this.list);return(0,e.Re)(n)?(this.environment.resolveElement(n).focus(),!0):this.arrowHandler(i,this.list)}if(n!==this.element)return r();let a=(0,t.As)(s,i,this.element);if(!(0,e.Re)(a))return r();if(a===this.notification)return this.arrowHandler(i,a);if(a===this.list){if(!this.list.hasChildNodes())return r();"up"===i?a=(0,t.GV)(this.list):"down"===i?a=(0,t.Sd)(this.list):"left"===i?a=(0,t.GF)(this.list):"right"===i&&(a=(0,t.EE)(this.list))}return a.focus(),!0},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.clear(),this.list&&this.source.getValue().forEach((e=>{let t=this.createItem(e);this.list.append(t)}))})),this.projection.registerHandler("value.swapped",(e=>{const[t,i]=e;let s=this.getItem(t),n=this.getItem(i),r=+this.getItemIndex(s);this.getItemIndex(n),r!==t.index&&this.swapItem(s,n)}))}},wt=Object.assign(Object.create(at),yt);Object.defineProperty(wt,"size",{get(){return this.items.size}}),Object.defineProperty(wt,"hasList",{get(){return(0,e.Re)(this.list)}});var Et=0;const Ct={content:{type:"static",static:{type:"text",content:"Add"}}},jt={content:{type:"static",static:{type:"text",content:"Remove"}}},Lt={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:e=[],template:t,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=e,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,t.tag)[0].projection,this},render(){const{content:t,action:i={}}=this.schema,{disposition:s}=this.template,n=(0,e.DZ)();if(!Array.isArray(t))throw new Error("Empty content for listfield");if((0,e.Re)(this.element)||(this.element=(0,e.wC)({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Xe.call(this.projection,this.element,this.schema.style)),t.forEach((t=>{if("table"===t.type){let i=(0,e.XI)(t.table,{});const{style:s,header:r,body:a={},footer:l}=i;if(this.table=(0,e.W_)({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),r){const{style:t}=r;this.header=(0,e.ZL)({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),Xe.call(this.projection,this.header,t),this.table.append(this.header)}if(a){const{style:t}=a;this.body=(0,e.uI)({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),Xe.call(this.projection,this.body,t),this.table.append(this.body)}if(l){const{style:t}=l;this.footer=(0,e.tH)({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),Xe.call(this.projection,this.footer,t),this.table.append(this.footer)}i.currentState=null,this.contentElements.set(i,this.table),Xe.call(this.projection,this.table,s),n.append(this.table)}else if("action"===t.type){let i=(0,e.XI)(t,Ct);const{content:s,style:r}=i;let a=ji.call(this,s,null),l=(0,e.ax)({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[a]);i.currentState=null,this.contentElements.set(i,l),Xe.call(this.projection,l,r),n.append(l)}else{let e=ji.call(this,t);this.contentElements.set(t,e),n.append(e)}})),this.header){let t=(0,e.ui)({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});s.forEach((i=>{const{header:s}=i,{style:n,content:r}=s;var a=ji.call(this,r),l=(0,e.zI)({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);Xe.call(this.projection,l,n),t.append(l)}));let i=(0,e.Ss)({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");t.append(i),this.header.append(t)}return this.source.hasValue()&&this.source.getValue().forEach((e=>{this.addRow(e)})),n.hasChildNodes()&&(this.element.append(n),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.contentElements.forEach(((t,i)=>{if(!Array.isArray(i.state))return;const{currentState:s}=i,n=tt.call(this,i,i.state);if(s===i.currentState)return;let r=null;r=n?ji.call(this,n.content,null):ji.call(this,i.content,null),(0,e.ep)(t).append(r)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},createElement(){return this.source.createElement()},addRow(t){const{action:i={},before:s={},after:n={}}=this.schema,{disposition:r}=this.template,a=(0,e.XI)(t.index,this.table.rows.length),l="row"+Et++,o=(0,e.ui)({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:a,elementId:l}});this.elements.set(l,o),r.forEach((i=>{const{body:s}=i,{style:n,content:r}=s;var a=ji.call(this,r,t),l=(0,e.Ss)({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);Xe.call(this.projection,l,n),o.append(l)}));var c=(0,e.Ss)({class:["field--table__cell-action"]}),{content:h,style:u}=(0,e.XI)(i.remove,jt),d=ji.call(this,h),p=(0,e.ax)({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:l}},d),m=(0,e.ax)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:l}},"Move up"),f=(0,e.ax)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:l}},"Move down");Xe.call(this.projection,p,u),c.append(p,m,f),o.append(c),this.body.append(o),this.refresh()},removeRow(t){var i=this.body.rows.item(t.index);if(!(0,e.Re)(i))throw new Error("Table error: Row not found");(0,e.ep)(i),i.remove();for(let e=t.index;e<this.body.rows.length;e++){const t=this.body.rows.item(e),{index:i}=t.dataset;t.dataset.index=+i-1}this.refresh()},removeElement(e){return this.source.removeElement(e)},delete(e){if(e===this.element||e===this.table)return void this.source.delete();const{index:i}=e.dataset;this.source.removeElementAt(+i)||(this.environment.notify("This element cannot be deleted"),(0,t.lL)(e))},bindEvents(){this.element.addEventListener("click",(t=>{const{target:i}=t,s=function(t){const i="field-component";return t.dataset.nature===i?t:(0,e.wr)(t,(e=>e.dataset.nature===i))}(i);if(!(0,e.Re)(s))return;const{id:n,action:r}=s.dataset;if(n===this.id)if("add"===r)this.createElement();else if("remove"===r){const{rowId:e}=s.dataset;let t=this.elements.get(e);this.delete(t)}else if("move-up"===r){const{rowId:e}=s.dataset;let t=this.elements.get(e),i=t.previousElementSibling;i&&i.before(t)}else if("move-down"===r){const{rowId:e}=s.dataset;let t=this.elements.get(e),i=t.nextElementSibling;i&&i.after(t)}}),!0),this.projection.registerHandler("value.added",(e=>{this.addRow(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeRow(e)})),this.projection.registerHandler("value.changed",(t=>{(0,e.ep)(this.body),this.source.getValue().forEach((e=>{this.addRow(e)}))}))}},xt=Object.assign(Object.create(at),Lt),Rt=t=>(0,e.Re)(t,["input","textarea"]),It="error";function At(){return(0,e.Re)(this.choice)||(this.choice=(0,e.w_)({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function Ot(t){return(0,e.HV)({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:t,id:this.id}},t)}function St(t){return t.parentElement===this.choice?t:(0,e.wr)(t,(e=>e.parentElement===this.choice),3)}function Vt(t){const{placeholder:i="",type:s}=t;let n="";return n=this._placeholder?(0,e.XI)(Ei.call(this,this._placeholder),""):(0,e.XI)(Ei.call(this,i),""),this.readonly||this.resizable?(0,e.kQ)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:n,dataset:{placeholder:n,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,e.nE)({class:["field--textbox__input"],placeholder:n,title:n,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,e.Ju)({class:["field--textbox__input"],type:(0,e.XI)(s,"text"),placeholder:n,title:n,dataset:{nature:"field-component",view:this.type,id:this.id}})}const _t={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,hasOwnSource:!1,init(t={}){Object.assign(this.schema,t);const{multiline:i=!1,placeholder:s="",resizable:n=!1,focusable:r=!0,source:a}=this.schema;if(this.multiline=i,this.focusable=r,this.resizable=n,this.children=[],this._placeholder=s,a){const e=this.projection.concept.getAttribute(a).getTarget();e.register(this),this.source=e,this.hasOwnSource=!0}return(0,e.RI)(this.schema,"choice")||(this.schema.choice={}),this},focus(e){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),(0,e.hr)(this.getValue())&&(this.input.textContent=""),this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.choice&&(0,t.Cp)(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!(0,e.xb)(this.getValue())},getValue(){return Rt(this.input)?this.input.value:this.input.textContent},setValue(e,i=!1){var s;(s=i?this.source.setValue(e):{success:!0}).success||((0,t.lL)(this.element),this.environment.notify(s.message,"error")),this.setInputValue(e),this.value=e,this.refresh()},setInputValue(e){Rt(this.input)?this.input.value=e:this.input.textContent=e},getCandidates(){let e=this.source.getCandidates();return Array.isArray(e)?e:[]},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){tt.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasError?(this.element.classList.add(It),this.input.classList.add(It)):(this.element.classList.remove(It),this.input.classList.remove(It)),this.choice&&this.filterChoice(this.getValue())},render(){const t=(0,e.DZ)(),{container:i,input:s={},style:n}=this.schema;if((0,e.Re)(this.element)||(this.element=(0,e.wC)({id:this.id,class:["field","text-field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),Xe.call(this.projection,this.element,this.schema.style)),i){const{content:e=[],style:s}=i;e.forEach((e=>{if("input"===e.type){const{style:i}=e.input;this.input=Vt.call(this,e.input),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Xe.call(this.projection,this.input,i),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),t.append(this.input)}else{let i=ji.call(this,e,null,{focusable:!1});t.append(i)}})),Xe.call(this.projection,this.element,s)}else{if(!(0,e.Re)(this.input)){const{style:e}=s;this.input=Vt.call(this,s),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Xe.call(this,this.input,e),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),t.append(this.input)}Xe.call(this.projection,this.element,n)}return t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(i){const{children:s}=this.choice;if((0,e.hr)(i)){for(let e=0;e<s.length;e++){const i=s[e];(0,t.$Z)(i),i.hidden=!1}return!0}let n=i.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<s.length;e++){const i=s[e],{value:r}=i.dataset;n.some((e=>r.toLowerCase().includes(e)))?((0,t.$Z)(i),i.hidden=!1):((0,t.Cp)(i),i.hidden=!0)}return!0},selectChoice(i){if(!(0,e.Re)(i))return;const s=function(e){return e.dataset.value}(i);return this.setValue(s,!0),this.input.focus(),(0,t.Cp)(this.choice),this},update(e,t,i){"delete"!==e?"value.changed"===e&&this.setValue(t):this.delete()},_spaceHandler(i){const s=new Set(this.getCandidates());if(0===s.size)this.notify("Enter any text.",t.k$.INFO);else{At.call(this);const i=(0,e.DZ)();s.forEach((e=>i.append(Ot.call(this,e)))),(0,e.ep)(this.choice).append(i),this.filterChoice(this.getValue()),(0,t.$Z)(this.choice)}},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),this.choice&&!(0,t.xj)(this.choice)&&((0,t.Cp)(this.choice),s=!1),s){let t=(0,e.wr)(i,(e=>0===e.tabIndex)),s=this.environment.resolveElement(t);return s&&s.focus(t),!1}return this.input.focus(),!0},enterHandler(e){const t=St.call(this,e);return t?this.selectChoice(t):this.multiline||(e===this.input?this.setValue(this.getValue(),!0):this.focus()),!0},backspaceHandler(e){St.call(this,e)&&this.input.focus()},clickHandler(t){const i=St.call(this,t);(0,e.Re)(i)&&this.selectChoice(i)},arrowHandler(i,s){if(!(0,e.Re)(s))return!1;const{parentElement:n}=s,r=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);let a=St.call(this,s);if((0,e.Re)(a)){let s=(0,t.As)(a,i,this.choice);return(0,e.Re)(s)?(s.focus(),!0):this.arrowHandler(i,this.choice)}if(n!==this.element)return r();let l=null;if("right"===i){if(s===this.input&&!(this.getValue().length<(0,t.qO)(this.input)+1))return!1;l=(0,t.As)(s,i,this.element,!1)}else if("left"===i){if(s===this.input&&0!==(0,t.qO)(this.input))return!1;l=(0,t.As)(s,i,this.element,!1)}else l=(0,t.As)(s,i,this.element,!1);return(0,e.Re)(l)&&l.dataset.id===this.id?("up"===i?l=(0,t.GV)(this.choice):"down"===i?l=(0,t.Sd)(this.choice):"left"===i?l=(0,t.GF)(this.choice):"right"===i&&(l=(0,t.EE)(this.choice)),l.focus(),!0):r()},bindEvents(){this.element.addEventListener("input",(e=>{this.hasError&&this.source.setValue(this.getValue(),!0),this.refresh()})),this.hasOwnSource||this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Tt=Object.assign(Object.create(at),_t),Ht={binary:(e,t,i)=>Object.create(ct,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:Mt()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),choice:(e,t,i)=>Object.create(ft,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:Mt()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),list:(e,t,i)=>Object.create(wt,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:Mt()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(xt,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:Mt()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),text:(e,t,i)=>Object.create(Tt,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:Mt()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})};var kt=0;const Mt=()=>"field"+kt++,$t={createField(t,i,s){const{type:n}=i,r=Ht[n];if((0,e.le)(r))throw new Error(`Missing handler: The '${n}' field could not be handled`);var a=r(t,i,s);if((0,e.le)(a))throw new Error(`Bad request: The '${n}' field could not be created`);return a.errors=[],a.readonly=(0,e.XI)(i.readonly,!1),(0,e.le)(a.id)&&(a.id=Mt()),a}},Pt={init(){throw new Error("This function has not been implemented")},element:null,children:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!(0,e.xb)(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(t){return(0,e.mf)(t)?this.attached.filter((e=>t(e))):this.attached},show(){return(0,t.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,t.Cp)(this.element),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:e=>!1,navigate(e,t,i){return this.focusable?(this.element.focus(),!0):this.parent.arrowHandler(e,this.element)},clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",t.k$.WARNING,1500),(0,t.lL)(this.element)},spaceHandler(e){return this.arrowHandler("right",e)},_spaceHandler(e){return this.environment.notify("Nothing do here.",t.k$.NORMAL,1500),!1},escapeHandler(t){let i=(0,e.wr)(t,(e=>0===e.tabIndex));return this.projection.resolveElement(i).focus(i),!0},enterHandler(e){this.element.click()},deleteHandler(e){return this.environment.notify("This element cannot be removed",t.k$.WARNING,1500),(0,t.lL)(this.element),!1},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,t)},clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:e=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},Nt=Object.assign(Pt),Dt={init(){return this.children=[],this},render(){const t=(0,e.DZ)(),{help:i,style:s,content:n}=this.schema;return(0,e.Re)(this.element)||(this.element=(0,e.K$)({class:["static","audio-static"],src:n,dataset:{nature:"static",static:"audio",id:this.id,ignore:"all"}})),(0,e.le)(i)||(this.element.title=i),Xe.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},Bt=Object.assign(Object.create(Nt),Dt);function Xt(t,i){let s=t.param.find((e=>e.name===i));if((0,e.le)(s))return;const{type:n="string",value:r}=s;let a=(0,e.XI)(r,s.default);return(0,e.le)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}function Zt(t){if((0,e.le)(t))return"";const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.XI)(this.source.getProperty(t.name),"")):"param"===i?Xt.call(this,this.schema.template,t.name):"raw"===i?(0,e.Bv)(t.raw):t}function Ft(t){return(0,e.hr)(t)?"":t.startsWith("http://")||t.startsWith("https://")?new URL(t).href:Ft(`https://${t}`)}const zt={url:null,alt:null,width:null,height:null,init(){const{url:e,width:t,height:i,alt:s}=this.schema;return this.width=t,this.height=i,this.alt=s,this},render(){let t=!1;const{help:i,style:s,url:n}=this.schema;return this.url=Ft(Zt.call(this,n)),(0,e.Re)(this.element)||(this.element=(0,e.Bi)({class:["static","image-static"],src:this.url,alt:this.alt,dataset:{nature:"static",static:"image",id:this.id,ignore:"all"}}),t=!0),(0,e.le)(this.width)||isNaN(this.width)||(this.element.width=this.width),(0,e.le)(this.height)||isNaN(this.height)||(this.element.height=this.height),(0,e.le)(i)||(this.element.title=i),Xe.call(this.projection,this.element,s),t&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return(0,e.hr)(this.url)?this.element.classList.add("empty"):this.element.classList.remove("empty"),this},update(){const{url:e}=this.schema;return this.element.src=Ft(Zt.call(this,e)),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Wt=Object.assign(Object.create(Nt),zt),qt={email:e=>`mailto:${e}`,phone:e=>`tel:${e}`,link:e=>`${e}`};function Ut(t,i){let s=t.param.find((e=>e.name===i));if((0,e.le)(s))return;const{type:n="string",value:r}=s;let a=(0,e.XI)(r,s.default);return(0,e.le)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}function Gt(t){if((0,e.le)(t))return"";const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.XI)(this.source.getProperty(t.name),"")):"param"===i?Ut.call(this,this.schema.template,t.name):"raw"===i?(0,e.Bv)(t.raw):t}const Kt={url:null,urlType:null,href:null,hrefHandler:null,content:null,init(){const{content:t=[],urlType:i="link"}=this.schema;if(this.content=t,this.urlType=i,this.children=[],this.hrefHandler=qt[this.urlType],!(0,e.mf)(this.hrefHandler))throw new TypeError("type not handled");return this},render(){let t=!1;const i=(0,e.DZ)(),{help:s,style:n,url:r}=this.schema;return this.href=this.hrefHandler(Gt.call(this,r)),(0,e.Re)(this.element)||(this.element=(0,e.cH)({class:["static","link"],href:this.href,dataset:{nature:"static",static:"link",id:this.id,ignore:"all"}}),"link"===this.urlType&&(this.element.target="_blank"),t=!0),this.content.forEach((e=>{let t=ji.call(this,e,this.projection.concept,{focusable:!1});i.append(t)})),(0,e.le)(s)||(this.element.title=s),Xe.call(this.projection,this.element,n),i.hasChildNodes()&&this.element.append(i),t&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},update(){const{url:t}=this.schema;return this.element.href=this.hrefHandler(Gt.call(this,t)),(0,e.ep)(this.element),this.content.forEach((e=>{this.element.append(ji.call(this,e,this.projection.concept,{focusable:!1}))})),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Qt=Object.assign(Object.create(Nt),Kt);function Jt(t,i){let s=t.param.find((e=>e.name===i));if((0,e.le)(s))return;const{type:n="string",value:r}=s;let a=(0,e.XI)(r,s.default);return(0,e.le)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}function Yt(t){if((0,e.le)(t))return"";const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.XI)(this.source.getProperty(t.name),"")):"param"===i?Jt.call(this,this.schema.template,t.name):"html"===i?(0,e.Bv)(t.html):"raw"===i?(0,e.Bv)(t.raw):t}const ei={editable:null,focusable:null,hasProperty:!1,asHTML:!1,init(e={}){Object.assign(this.schema,e);const{content:t,editable:i=!1,focusable:s=!1}=this.schema;return this.children=[],this._content=t,this.editable=i,this.focusable=s,this},render(){let t=!1;const{content:i,help:s,style:n}=this.schema;if(!(0,e.Re)(this.element)){if(this.element=(0,e.kQ)({class:["text","static","text-static"],editable:this.editable,dataset:{nature:"static",view:"text",static:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0),Array.isArray(i))i.forEach((t=>{let i=Yt.call(this,t),s=(0,e.kQ)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",content:i,id:this.id,ignore:"all"}},i);Xe.call(this.projection,s,t.style),this.element.append(s)}));else{let e=Yt.call(this,i);this.element.append(e),this.element.content=e}t=!0}return(0,e.le)(s)||(this.element.title=s),Xe.call(this.projection,this.element,n),t&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,i){if(!this.editable&&this.parent)return this.parent.arrowHandler(e,i);if("right"===e){if(this.getLength()<(0,t.qO)(this.element)+1&&this.parent)return this.parent.arrowHandler(e,i)}else if("left"===e){if(0===(0,t.qO)(this.element)&&this.parent)return this.parent.arrowHandler(e,i)}else if(this.parent)return this.parent.arrowHandler(e,i);return!1},escapeHandler(t){let i=(0,e.wr)(t,(e=>0===e.tabIndex));this.projection.resolveElement(i).focus(i)},update(){const{content:t}=this.schema;return(0,e.ep)(this.element),Array.isArray(t)?t.forEach((t=>{this.element.append((0,e.kQ)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",id:this.id,ignore:"all"}},Yt.call(this,t)))})):this.element.append(Yt.call(this,t)),this},refresh(){return this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},ti=Object.assign(Object.create(Nt),ei),ii={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.children=[],this.focusable=t,this},render(){const t=(0,e.DZ)(),{help:i,style:s,content:n}=this.schema;return(0,e.Re)(this.element)||(this.element=(0,e.ax)({class:["btn","static"],dataset:{nature:"static",view:"plink",static:"plink",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),n.forEach((e=>{let i=ji.call(this,e,this.projection.concept,{focusable:!1});t.append(i)})),(0,e.le)(i)||(this.element.title=i),Xe.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(t){let i=(0,e.wr)(t,(e=>0===e.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){let t=this.projection.findView(this.schema.tag);return-1===t||this.projection.changeView(t),!1},refresh(){return this},bindEvents(){}},si=Object.assign(Object.create(Nt),ii),ni={template:null,selector:null,content:null,init(){return this.selector=this.schema.selector,this.template=(0,e.t4)(this.selector),this},render(){const{style:t,content:i}=this.schema;return(0,e.UG)(this.element)||(this.element=(0,e.jC)(this.template)),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},ri=Object.assign(Object.create(Nt),ni);function ai(t,i){let s=t.param.find((e=>e.name===i));if((0,e.le)(s))return;const{type:n="string",value:r}=s;let a=(0,e.XI)(r,s.default);return(0,e.le)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}const li={contentType:null,editable:null,focusable:null,disabled:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0,disabled:i=!1}=this.schema;return this.children=[],this.focusable=t,this.disabled=i,this},render(){const t=(0,e.DZ)(),{help:i,style:s,content:n}=this.schema;return(0,e.Re)(this.element)||(this.element=(0,e.ax)({class:["btn","static"],dataset:{nature:"static",view:"button",static:"button",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),n.forEach((e=>{let i=ji.call(this,e,this.projection.concept,{template:this.schema.template,focusable:!1});t.append(i)})),(0,e.le)(i)||(this.element.title=i),Xe.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.ep)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(t){let i=(0,e.wr)(t,(e=>0===e.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(t){let i=this.source;if(this.schema.bind&&(i=this.source.getValue(!0)),this.schema.action){const{type:t,value:s,target:n}=this.schema.action;if((0,e.le)(n)&&i.createElement(),(0,e.Kn)(s))for(const e in s){const t=s[e];"param"===t.type&&(s[e]=ai.call(this,this.schema.template,t.name))}return"attribute"===n.type&&i.getAttribute(n.name).target.createElement({value:s}),!1}return this.environment.triggerEvent({name:this.schema.trigger,args:[i]}),!1},refresh(){return this},bindEvents(){}},oi=Object.assign(Object.create(Nt),li);var ci=0;const hi=()=>"static"+ci++,ui={audio:(e,t,i)=>Object.create(Bt,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}}),plink:(e,t,i)=>Object.create(si,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}}),image:(e,t,i)=>Object.create(Wt,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}}),link:(e,t,i)=>Object.create(Qt,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}}),text:(e,t,i)=>Object.create(ti,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}}),html:(e,t,i)=>Object.create(ri,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}}),button:(e,t,i)=>Object.create(oi,{object:{value:"static"},name:{value:"button-static"},type:{value:"button"},id:{value:hi()},model:{value:e},schema:{value:t},projection:{value:i}})},di={createStatic(t,i,s){const{type:n}=i,r=ui[n];if((0,e.le)(r))throw new Error(`Missing handler: The '${n}' static could not be handled`);var a=r(t,i,s);if((0,e.le)(a))throw new Error(`Bad request: The '${n}' static could not be created`);return(0,e.le)(a.id)&&(a.id=hi()),a}},pi={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,children:null,editing:!1,getStyle(){return this.schema.style},setStyle(e){return this.schema.style=e,Xe.call(this.projection,this.container,e),this.refresh(),!0},getContainer(){return this.container},isRoot(){return(0,e.le)(this.parent)},getField(e){return this.projection.getField(e)},getStatic(e){return this.projection.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},show(){return(0,t.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,t.Cp)(this.element),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},_focusIn:e=>!1,spaceHandler(t){return t===this.container&&!(0,e.le)(this.parent)&&this.parent.spaceHandler(this.container)},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(t){if(this.isRoot())return!1;let i=(0,e.wr)(t,(e=>0===e.tabIndex)),s=this.environment.resolveElement(i);return!(0,e.le)(s)&&(s.focus(i),!0)},enterHandler(t){let i=(0,e.sb)('[tabindex]:not([tabindex="-1"])',this.container),s=this.environment.resolveElement(i);return!(0,e.le)(s)&&(s.focus(),!0)},delete(){var e=this.source.delete();e.success||this.environment.notify(e.message)},deleteHandler(i){if(this.projection.element!==this)return!1;if(!this.projection.optional)return(0,t.lL)(this.container),!1;let s=(0,e.wr)(i,(e=>0===e.tabIndex)),n=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),n),this.source.delete();let r=this.environment.resolveElement(s);return(0,e.le)(r)||r.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(i,s){if(s===this.container)return!(0,e.le)(this.parent)&&this.parent.arrowHandler(i,this.container);let n=(0,t.As)(s,i,this.container);if(!(0,e.Re)(n))return!(0,e.le)(this.parent)&&"layout"===this.parent.object&&this.parent.arrowHandler(i,this.container);let r=this.environment.resolveElement(n);return r&&((0,e.mf)(r.navigate)?r.navigate(i):r.focus()),!0},shiftHandler(e,i){if("up"===e){let e=(0,t.a2)(window.getComputedStyle(this.container).marginTop);this.container.style.marginTop=`${e+1}px`}return!0},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()}},mi={ROW:"row",COLUMN:"column"},fi={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},vi={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"};var gi=0;function bi(e,t,i){return Object.create(wi,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:"layout"+gi++},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})}const yi={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema,{orientation:s=mi.ROW,wrappable:n=!0,alignItems:r,justifyContent:a}=this.schema.layout;return this.orientation=s,this.wrappable=n,this.alignItems=r,this.justifyContent=a,this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(t){(0,e.RI)(mi,t)&&(this.orientation=t,this.refresh())},collapse(t=!1){if(!this.collapsed||t)return this.collapseContainer=(0,e.wC)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(t=!1){if(!this.collapsed&&!t)return;let i=(0,e.DZ)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{label:t,content:i,style:s,help:n}=this.schema,r=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),n&&(this.container.title=n);for(let e=0;e<i.length;e++){let t=ji.call(this,i[e],null,this.args),s=this.environment.resolveElement(t);s&&(s.parent=this),this.elements.push(t),r.append(t)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Xe.call(this.projection,this.container,s),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=vi[this.justifyContent],this.container.style.alignItems=fi[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.sb)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.le)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},wi=Object.assign({},pi,yi);function Ei(e){return"property"===e.type?this.projection.concept.getProperty(e.name):e}function Ci(i,s,n){const{tag:r,placeholder:a={},style:l,options:o}=s;if(!n.hasAttribute(i)){let s=`Attribute '${i}' does not exist in the concept '${n.name}'`;return this.environment.notify(s,t.k$.ERROR),this.environment.addError({source:"projection",code:"attribute_not_found",message:s}),(0,e.oL)({hidden:!0},i)}(0,e.XI)(s.required,n.isAttributeRequired(i))&&!n.isAttributeCreated(i)&&n.createAttribute(i);const c={name:i,get created(){return n.isAttributeCreated(i)},schema:s,placeholder:(0,e.oL)({class:["projection-element"],hidden:!0},i),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(c),!c.created){const{content:t}=a;return c.placeholder=t?ji.call(this,t,n,{focusable:!0}):(0,e.oL)({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:i}},`Add ${i}`),c.placeholder.addEventListener("click",(e=>{n.createAttribute(i),this.projection.resolveElement(c.element).focus()})),c.placeholder}{const{target:t,schema:s}=n.getAttributeByName(i);let a=this.projection.model.createProjection(t,r).init(o);if(a.parent=this.projection,a._style=l,c.element=a.render(),(0,e.le)(c.element))return(0,e.oL)({hidden:!0},i);a.element.parent=this}return c.element}function ji(t,i,s={}){if(t.kind)return Li.call(this,t,i,s);const n=(0,e.XI)(i,this.projection.concept);if("container"===t.type){let e=bi(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("layout"===t.type){let e=Bi.createLayout(this.model,t.layout,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("field"===t.type){let e=$t.createField(this.model,t.field,this.projection);return e.parent=this,e.init(s),this.model.registerField(e),e.render()}if("static"===t.type){let e=di.createStatic(this.model,t.static,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerStatic(e),e.render()}if("dynamic"===t.type)return ji.call(this,t.dynamic,i,s);if("attribute"===t.type)return Ci.call(this,t.name,t,n);if("template"===t.type){let n=t.name;"param"===n.type&&(n=this.projection.getParam(n.name));let r=this.model.getTemplateSchema(n);r.param&&(t.param&&r.param.forEach((e=>{Object.assign(e,t.param.find((t=>t.name===e.name)))})),this.projection.addParam(r.param));const a=(0,e.DZ)();let l=Object.assign({template:r},s);return r.content.forEach((e=>{a.append(ji.call(this,e,i,l))})),a}if("projection"===t.type){const{tag:i,style:s,src:r,required:a=!1}=t;if(r&&"attribute"===r.type)return Ci.call(this,r.name,t,n);const l={schema:t,placeholder:(0,e.oL)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return l.update=function(t,r,a){if(l.element&&(l.element.remove(),l.element=null),n.hasValue()){let t=n.getValue(!0),r=this.projection.model.createProjection(t,i).init();r.placeholder=l.placeholder,r.parent=this.projection,l.element=r.render(),l.placeholder&&l.placeholder.after(l.element),(0,e.Re)(l.element)&&Xe.call(this.projection,l.element,s),r.element.parent=this.projection.element}},n.register(l),l.update(),l.element||l.placeholder}if("property"===t.type){const{name:e}=t;return this.projection.concept.getProperty(e)}if("html"===t.type){const{html:i}=t;return(0,e.Bv)(i)}if("raw"===t.type){const{raw:e}=t;return e}if("state"===t.type){let e={},n=tt.call(this,e,t.state);return ji.call(this,n.content,i,s)}throw console.error(t),new TypeError("Bad argument: The type is not recognized")}function Li(t,i,s={}){const n=(0,e.XI)(i,this.projection.concept),{kind:r}=t;if("container"===r){let e=bi(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("layout"===r){let e=Bi.createLayout(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("field"===r){let e=$t.createField(this.model,t,this.projection);return e.parent=this,e.init(s),this.model.registerField(e),e.render()}if("static"===r){let e=di.createStatic(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerStatic(e),e.render()}if("dynamic"===r)return ji.call(this,t,i,s);if("attribute"===r)return Ci.call(this,t.name,t,n);if("template"===r){let n=t.name;"param"===n.type&&(n=this.projection.getParam(n.name));let r=this.model.getTemplateSchema(n);r.param&&(t.param&&r.param.forEach((e=>{Object.assign(e,t.param.find((t=>t.name===e.name)))})),this.projection.addParam(r.param));const a=(0,e.DZ)();return r.content.forEach((e=>{a.append(ji.call(this,e,i,s))})),a}if("projection"===r){const{tag:i,style:s,required:r=!1}=t,a={schema:t,placeholder:(0,e.oL)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return a.update=function(t,r,l){if(a.element&&(a.element.remove(),a.element=null),n.hasValue()){let t=n.getValue(!0),r=this.projection.model.createProjection(t,i).init();r.placeholder=a.placeholder,r.parent=this.projection,a.element=r.render(),a.placeholder&&a.placeholder.after(a.element),(0,e.Re)(a.element)&&Xe.call(this.projection,a.element,s),r.element.parent=this.projection.element}},n.register(a),a.update(),a.element||a.placeholder}if("property"===r){const{name:e}=t;return this.projection.concept.getProperty(e)}if("html"===r){const{html:i}=t;return(0,e.Bv)(i)}if("raw"===r){const{raw:e}=t;return e}if("state"===r){let e={},n=tt.call(this,e,t.state);return ji.call(this,n.content,i,s)}throw console.error(t),new TypeError("Bad argument: The type is not recognized")}const xi={HORIZONTAL:"horizontal",VERTICAL:"vertical"},Ri=[{concept:{name:"stack-layout"},type:"layout",tags:[],projection:{type:"stack",orientation:"vertical",disposition:[{type:"attribute",name:"orientation"}]}}],Ii={orientation:null,args:null,init(e={}){const{orientation:t=xi.HORIZONTAL,editable:i=!0,focusable:s=!1}=this.schema;return this.orientation=t,this.focusable=s,this.editable=i,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){this.orientation=e,this.refresh()},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["layout-container","stack-layout"],title:s,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let e=0;e<t.length;e++){let i=ji.call(this,t[e],null,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Xe.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="nowrap",this.refresh(),this.container},design(){return{concept:[{name:"stack-layout",nature:"concrete",attributes:[{name:"orientation",target:{name:"string",default:this.orientation,constraint:{values:["horizontal","vertical"]}}}]}],projection:Ri,handlers:{orientation:(e,t)=>{this.setOrientation(t)}}}},refresh(){return this.orientation===xi.VERTICAL?this.container.style.flexDirection="column":this.orientation===xi.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.sb)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.le)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Ai=Object.assign({},pi,Ii),Oi={args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema;return this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["layout-container"],title:s,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let e=0;e<t.length;e++){let i=ji.call(this,t[e],this.source,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Xe.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="baseline",this.refresh(),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.sb)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.le)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Si=Object.assign({},pi,Oi),Vi={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(e={}){const{editable:t=!0,collapsible:i=!1,focusable:s=!1}=this.schema;return this.focusable=s,this.collapsible=i,this.editable=t,this.elements=[],this.children=[],Object.assign(this,e),this},collapse(t){if(!this.collapsed)return this.collapseContainer=(0,e.wC)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(t){if(!this.collapsed)return;let i=(0,e.DZ)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let i=0;i<t.length;i++){let s=t[i],r=(0,e.wC)({class:["table-row"]});r.style.display="table-row";for(let t=0;t<s.length;t++){const i=s[t];let n=(0,e.wC)({class:["table-cell"]},ji.call(this,i.content));n.style.display="table-cell",Xe.call(this.projection,n,i.style),r.append(n)}n.append(r)}return Xe.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},_i=Object.assign({},pi,Vi),Ti={ROW:"row",COLUMN:"column"},Hi={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},ki={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"},Mi={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{orientation:t=Ti.ROW,wrappable:i=!0,alignItems:s,justifyContent:n,editable:r=!0,focusable:a=!1}=this.schema;return this.orientation=t,this.wrappable=i,this.alignItems=s,this.justifyContent=n,this.focusable=a,this.editable=r,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(t){(0,e.RI)(Ti,t)&&(this.orientation=t,this.refresh())},collapse(t=!1){if(!this.collapsed||t)return this.collapseContainer=(0,e.wC)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(t=!1){if(!this.collapsed&&!t)return;let i=(0,e.DZ)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.DZ)();(0,e.Re)(this.container)||(this.container=(0,e.wC)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),s&&(this.container.title=s);for(let e=0;e<t.length;e++){let i=ji.call(this,t[e],null,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Xe.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=ki[this.justifyContent],this.container.style.alignItems=Hi[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.sb)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.le)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},$i=Object.assign({},pi,Mi);var Pi=0;const Ni=()=>"layout"+Pi++,Di={stack:(e,t,i)=>Object.create(Ai,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:Ni()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),wrap:(e,t,i)=>Object.create(Si,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:Ni()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),table:(e,t,i)=>Object.create(_i,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:Ni()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),flex:(e,t,i)=>Object.create($i,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:Ni()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Bi={createLayout(t,i,s){const{type:n}=i,r=Di[n];if((0,e.le)(r))throw new TypeError(`Missing handler: The '${n}' layout could not be handled`);const a=r(t,i,s);if((0,e.le)(a))throw new Error(`Bad request: The '${n}' layout could not be created`);return a.createLayout=this.createLayout,(0,e.le)(a.id)&&(a.id=Ni()),a}};var Xi=0;const Zi={createProjection(t,i,s,n){var r=Object.create(Fi,{id:{value:(0,e.XI)(i.id,"projection"+Xi++)},model:{value:t},schema:{value:i,writable:!0},environment:{value:n}});return r.concept=s,r}},Fi={handlers:null,init(e={}){return this.containers=new Map,this.attributes=[],this.params=[],this.templates=[],this.handlers={},this.args=e,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,collapsible:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return(0,e.XI)(this.getSchema().readonly,!1)},isRoot(){return(0,e.le)(this.parent)},getSchema(t){return this.schema[(0,e.XI)(t,this.index)]},hasSchema(e){return-1!==this.schema.findIndex((t=>t.tags.includes(e)))},getContainer(t){return this.containers.get((0,e.XI)(t,this.index))},getStyle(){const{style:e}=this.getSchema();return e},addTemplate(e){this.templates.push(e)},addParam(e){this.params.push(...Array.isArray(e)?e:[e])},getParam(t,i){let s=this.params.find((e=>e.name===t));if((0,e.le)(s))return;const{type:n="string",value:r}=s;let a=(0,e.XI)(r,s.default);return(0,e.le)(a)?null:"string"===n?a.toString():"number"===n?+a:"boolean"===n?(0,e.sw)(a):void 0},getParent(){return this.isRoot()?null:this.parent},getAttributes(e){return this.attributes.filter((t=>t.name===e))},getField(e){return this.environment.getField(e)},getStatic(e){return this.environment.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},resolveElement(e){return this.environment.resolveElement(e)},getHandlers(t){return(0,e.XI)(this.handlers[t],[])},update(i,s,n){if((0,e.xb)(this.containers))return;if("delete"===i)return void this.delete();const r=this.getHandlers(i);switch((0,e.xb)(r)||r.forEach((e=>{e(s,n)})),i){case"attribute.added":return void this.getAttributes(s.name).forEach((e=>{const{schema:i}=e,n=this.model.createProjection(s.target,i.tag).init();n.parent=this,n.optional=!0;const r=n.render();Xe.call(this,r,i.style),n.element.parent=e.parent,e.element=r,e.placeholder&&(e.placeholder.after(r),(0,t.Cp)(e.placeholder))}));case"attribute.removed":return void this.getAttributes(s.name).forEach((i=>{i.element&&((0,e.ep)(i.element).remove(),i.element=null),i.placeholder&&(0,t.$Z)(i.placeholder)}))}},delete(){return this.concept&&this.concept.unregister(this),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((t=>{(0,e.ep)(t),(0,e.Re)(t)&&t.remove()})),this.model.removeProjection(this.id),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(t,i){if(!(0,e.RI)(this.handlers,t))return!1;for(let e=0;e<this.handlers[t].length;e++)if(this.handlers[t][e]===i)return this.handlers[t].splice(e,1),!0;return!1},focus(){this.element.focus()},render(){const i=this.getSchema();if((0,e.le)(i))return null;const{type:s,projection:n,content:r,kind:a}=i;var l=null;if("layout"===s||"layout"===a)this.element=Bi.createLayout(this.model,(0,e.XI)(n,r),this).init(this.args),this.model.registerLayout(this.element);else if("field"===s||"field"===a){let t=(0,e.RI)(i,"field")?i.field:(0,e.XI)(n,r);this.element=$t.createField(this.model,t,this).init(this.args),this.model.registerField(this.element)}else"static"===s||"static"===a?(this.element=di.createStatic(this.model,(0,e.XI)(n,r),this).init(this.args),this.element.source=this.concept,this.model.registerStatic(this.element)):"dynamic"===s||"dynamic"===a?(this.element=di.createStatic(this.model,(0,e.XI)(n,r),this).init(this.args),this.model.registerStatic(this.element)):(this.element=bi(this.model,i.container,this).init(this.args),this.model.registerLayout(this.element));if(this.isRoot()&&(this.element.focusable=!0),this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),l=this.element.render(),"layout"!==s&&"container"!==s||(0,t.n2)(l),this.element.focusable||(l.tabIndex=-1),!(0,e.UG)(l))throw new Error("Projection element container could not be created");if(l.classList.add("projection"),Object.assign(l.dataset,{projection:this.id,concept:this.concept.id,object:this.concept.object}),this.optional){let t=(0,e.ax)({class:["btn","structure__btn-delete","projection__btn-delete"],title:`Delete ${this.concept.name}`,tabindex:-1,dataset:{action:"delete",projection:this.id}});t.addEventListener("click",(t=>{let i=this.getContainer(),s=(0,e.wr)(i,(e=>0===e.tabIndex));this.environment.save(this.concept.getParent(),i.cloneNode(!0)),this.concept.delete();let n=this.environment.resolveElement(s);(0,e.le)(n)||n.focus()})),l.dataset.deletable=!0,l.prepend(t)}if(this.collapsible){let t=(0,e.ax)({class:["btn","projection__btn-collapse"],title:`Collapse ${this.concept.name}`,tabindex:-1,dataset:{action:"collapse",projection:this.id}});t.addEventListener("click",(e=>{this.getContainer().classList.toggle("collapsed")})),l.dataset.collapsible=!0,l.prepend(t)}return this._style&&Xe.call(this,l,this._style),this.containers.set(this.index,l),l},refresh(){this.editing?this.containers.forEach((e=>{e.tabIndex=0})):this.containers.forEach((e=>{e.tabIndex=null}))},changeView(t){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let i=this.getContainer();this.index=(0,e.XI)(t,(this.index+1)%this.schema.length);let s=this.getContainer();(0,e.Re)(s)||(this.params=[],s=this.render()),i.replaceWith(s),this.element=this.resolveElement(s);const n=this.getHandlers("view.changed");return(0,e.xb)(n)||n.forEach((e=>e(s))),this.focus(),this},findView(e){if(!this.hasSchema(e)){if(!this.model.hasProjectionSchema(this.concept,e))return-1;let t=this.model.getProjectionSchema(this.concept,e);this.schema.push(...t)}return this.schema.findIndex((t=>t.tags.includes(e)))},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},zi=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}],Wi={projections:null,fields:null,statics:null,layouts:null,init(e){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this},addSchema(e){return Array.isArray(e.projection)&&this.schema.projection.push(...e.projection),Array.isArray(e.template)&&this.schema.template.push(...e.template),Array.isArray(e.style)&&this.schema.style.push(...e.style),this.environment.update("concept-model.updated"),!0},setSchema(e){return this.schema=e,this.environment.update("projection-model.updated"),this},done(){for(;!(0,e.xb)(this.projections);)this.projections[0].delete();return this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(i,s){const n=this.getProjectionSchema(i,s);(0,e.xb)(n)&&this.environment.notify(`Missing projection (#${s}) for ${i.name}`,t.k$.WARNING);const r=Zi.createProjection(this,n,i,this.environment);return r.tag=s,this.addProjection(r),r},getProjections(){return this.projections.slice()},getProjection(e){return Number.isInteger(e)?this.projections[e]:this.projections.find((t=>t.id===e))},addProjection(t){if((0,e.le)(t))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(t),this},removeProjection(e){var t=this.projections.findIndex((t=>t.id===e));return-1!==t&&(this.projections.splice(t,1),!0)},registerField(e){return e.environment=this.environment,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.environment=null,this.fields.delete(t.id)),this},getField(e){return this.fields.get(e)},registerStatic(e){return e.environment=this.environment,this.statics.set(e.id,e),this},unregisterStatic(e){var t=this.statics.get(e.id);return t&&(t.environment=null,this.statics.delete(t.id)),this},getStatic(e){return this.statics.get(e)},registerLayout(e){return e.environment=this.environment,this.layouts.set(e.id,e),this},unregisterLayout(e){var t=this.layouts.get(e.id);return t&&(t.environment=null,this.layouts.delete(t.id)),this},getLayout(e){return this.layouts.get(e)},getMetadata(e){let t=this.schema.find((t=>t.id===e));return t?t.metadata:null},hasConceptProjection(t,i){let s=null;return s=(0,e.HD)(t)?this.schema.projection.filter((e=>e.concept.name===t)):this.schema.projection.filter((i=>{return(e=>e&&(e===t.name||t.schema&&e===t.schema.base))(i.concept.name)||(s=i.concept.prototype,!(0,e.le)(s)&&"prototype"!==t.nature&&t.hasPrototype(s));var s})),(0,e.TW)(i)&&!(0,e.xb)(i)?-1!==s.findIndex((e=>(e=>Array.isArray(e.tags)&&e.tags.includes(i))(e))):!(0,e.xb)(s)},getSchema(){return this.schema},getProjectionSchema(t,i){if((0,e.le)(t))throw new TypeError("Bad parameter: concept");var s=null;return s=(0,e.HD)(t)?this.schema.projection.filter((e=>e.concept.name===t)):this.schema.projection.filter((i=>{return(e=>e&&(e===t.name||t.schema&&e===t.schema.base))(i.concept.name)||(s=i.concept.prototype,!(0,e.le)(s)&&"prototype"!==t.nature&&t.hasPrototype(s));var s})),(0,e.TW)(i)&&!(0,e.xb)(i)?s.filter((e=>e.tags&&e.tags.includes(i))):s},getTemplateSchema(i){let s=this.schema.template.find((e=>e.name===i));return(0,e.le)(s)?null:(0,t.p$)(s)},getRuleSchema(i){let s=this.schema.find((e=>"rule"===e.type&&e.name===i));return(0,e.le)(s)?null:(0,t.p$)(s)},getStyleSchema(i){let s=this.schema.style.find((e=>e.name===i));return(0,e.le)(s)?null:(0,t.p$)(s)},hasProjectionSchema(t,i){if((0,e.le)(t))throw new TypeError("Bad parameter: concept");let s=[];return s=(0,e.HD)(t)?this.schema.projection.filter((e=>e.concept.name===t)):this.schema.projection.filter((i=>{return(e=>e&&(e===t.name||t.schema&&e===t.schema.base))(i.concept.name)||(s=i.concept.prototype,!(0,e.le)(s)&&"prototype"!==t.nature&&t.hasPrototype&&t.hasPrototype(s));var s})),(0,e.TW)(i)&&!(0,e.xb)(i)?s.some((e=>e.tags&&e.tags.includes(i))):!(0,e.xb)(s)},export(){const e=[];return this.getProjections().forEach((t=>{e.push(t.export())})),e}},qi={unloadAllConcept(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-concept@post"}),this},unloadAllProjection(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-projection@post"}),this},loadSession(){this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)}))},loadConcept(i,s){let n=i.concept||i,r=i.values;return Array.isArray(n)?(0,e.xb)(n)?(this.notify("The concept schema is empty",t.k$.ERROR),!1):((0,e.le)(this.conceptModel)&&(this.conceptModel=Pe.createModel(null,this).init()),this.conceptModel.addConceptSchema(n),this.conceptModel.init(r),this.triggerEvent({name:"editor.load-concept@post",args:[s,JSON.stringify(i)]}),this.refresh(),this):(this.notify("Invalid concept schema",t.k$.ERROR),!1)},loadProjection(t,i){return this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,e.le)(this.projectionModel)&&(this.projectionModel=function(e,t){if(!Array.isArray(e.projection))throw new TypeError("Bad projection schema");return e.projection.push(...zi),Object.create(Wi,{schema:{value:e,writable:!0},environment:{value:t}})}(t,this).init()),this.projectionModel.addSchema(t),(0,e.le)(this.projectionModel),this.instances.forEach((e=>{e.projection=this.projectionModel.createProjection(e.concept).init(),e.render()})),this.triggerEvent({name:"editor.load-projection@post",args:[i,JSON.stringify(t)]}),this.refresh(),this},load(i,s){let n=i.type;if((0,e.hr)(n)){let e=i.name.indexOf(".")+1;n=i.name.substring(e)}else n=t.D3[n];"jsoncp"===n&&"json"===n||this.addResource(i,s);let r=new FileReader;return r.onload=e=>{const t=JSON.parse(r.result),{type:i}=t;"concept"===i?this.loadConcept(t,s):"projection"===i?this.loadProjection(t,s):"model"===i&&(this.loadConcept(t.concept,"model"),this.loadProjection(t.projection,"model"))},r.readAsText(i),!0},unload(){return this.unloadAllConcept(),this.unloadAllProjection(),this.clear(),this}},Ui={getField(t){if(!(0,e.Re)(t))return console.warn("Field error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.le)(i)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(s)?this.projectionModel.getField(i):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(t){if(!(0,e.Re)(t))return console.warn("Static error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.le)(i)?(console.warn("Static error: Missing id attribute on field"),null):["static","static-component"].includes(s)?this.projectionModel.getStatic(i):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(t){if(!(0,e.Re)(t))return console.warn("Layout error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.le)(i)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(s)?this.projectionModel.getLayout(i):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(t){if(!(0,e.Re)(t))return null;const{nature:i}=t.dataset;if((0,e.le)(i))return null;let s=null;switch(i){case"field":case"field-component":s=this.getField(t);break;case"layout":case"layout-component":s=this.getLayout(t);break;case"static":case"static-component":s=this.getStatic(t)}return s&&(s.environment=this),s}};var Gi=0;const Ki={createState(t,i){const{id:s,name:n}=t;let r="value"+Gi++,a=JSON.stringify(t.clone()),l=((0,e.p6)(new Date,"hh:dd"),(0,e.oL)({class:["ico","ico-delete"]},"✖")),o=(0,e.ax)({class:["btn","btn-delete"],title:`Delete ${n} state`},l),c=(0,e.wC)({class:["model-state-preview"],title:`Preview ${n}`},i),h=(0,e.kQ)({class:["model-state-content","fit-content"]},`${t.getName()}`),u=(0,e.HV)({class:["model-state"],title:`Restore ${n} state`,dataset:{id:r,concept:s}},[o,h,c]);u.addEventListener("click",(t=>{let i=function(t){const i=e=>e===u||e===o;return i(t)?t:(0,e.wr)(t,(e=>i(e)),5)}(t.target);if(this.unhighlight(),i===o)this.removeState(r);else{let t=this.restore(a);this.removeState(r);let i=(0,e.sb)(`.projection[data-concept="${t.id}"]`,this.body);i&&i.focus()}}));let d=`.projection[data-concept="${s}"]`;if(u.addEventListener("mouseenter",(t=>{let i=(0,e.sb)(d,this.body);i&&this.highlight(i)})),u.addEventListener("mouseleave",(e=>{this.unhighlight()})),this.states.length>8){let{id:e}=this.stateList.lastChild.dataset;this.removeValue(e)}let p=Object.create({},{id:{value:r},object:{value:"value"},type:{value:"state"},element:{value:u},concept:{value:t},value:{value:a}});return this.addState(p),p},getState(t){if(!(0,e.le)(t)&&!(0,e.xb)(this.states))return this.states[t]},addState(e){return this.stateList.append(e.element),this.states.push(e),this.refresh(),e},removeState(t){if((0,e.le)(t))return;const i=this.states.findIndex((e=>e.id===t));if(-1===i)return null;let s=this.states.splice(i,1)[0],{element:n}=s;return(0,e.ep)(n).remove(),this.refresh(),this}};var Qi=0;const Ji={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeInstance:null,container:null,header:null,body:null,instanceSection:null,designSection:null,navigationSection:null,valueWindow:null,valueList:null,breadcrumb:null,filter:null,home:null,style:null,logs:null,status:null,group:null,input:null,copyValue:null,states:null,activeElement:null,decoratedElements:null,config:null,active:!1,visible:!1,frozen:!1,handlers:null,actions:null,attached:null,instances:null,windows:null,values:null,resources:null,models:null,errors:null,init(e={}){const{conceptModel:t,projectionModel:i,toolbar:s=[],config:n={},handlers:r={},actions:a={}}=e;this.config=Object.assign({},n),this.handlers=new Map,this.actions=new Map,this.attached=[],this.instances=new Map,this.windows=new Map,this.values=new Map,this.resources=new Map,this.models=new Map,this.errors=[],Object.assign(this,w,j),this.states=[],this.decoratedElements=new Set;for(const e in r){const t=r[e];this.registerHandler(e,t)}return this.header=I.call(this).init(),this.home=O.call(this).init(),this.breadcrumb=A.call(this).init(),this.logs=V.call(this).init(),this.status=S.call(this).init(),this.render(),t&&this.loadConcept(t),i&&this.loadProjection(i),this.isReady?(this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this.open()):(this.home.open(),this.refresh()),this},setConfig(t){return!(0,e.le)(t)&&(this.config=t,this.refresh(),this)},getConfig(t){return(0,e.le)(t)?this.config:this.config[t]},getName(){return(0,e.XI)(this.config.name,`editor${(new Date).getTime()}`)},createConcept(i){if((0,e.le)(i))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(i)?this.conceptModel.createConcept(i):(this.notify(`The concept '${i}' is not defined in the model`,t.k$.ERROR),!1)},addConcept(e){let t=e.concept||e;Array.isArray(t)?this.conceptModel.schema.push(...t):this.conceptModel.schema.push(t),this.refresh()},createProjection(i,s){if((0,e.le)(i))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(i,s)?this.projectionModel.createProjection(i,s).init():(this.notify(`The projection for the concept '${i.name}' is not defined in the model`,t.k$.ERROR),!1)},addProjection(e){Array.isArray(e)?this.projectionModel.schema.projection.push(...e):this.projectionModel.addSchema(e),this.refresh()},download(t,i,s){const n="application/jsoncp";window.URL=window.webkitURL||window.URL;var r=(0,e.cH)({class:["bare-link","download-item__link"]},"Download");(0,e.hr)(r.href)||window.URL.revokeObjectURL(r.href);var a=new Blob([JSON.stringify(t)],{type:n});return Object.assign(r,{download:`${(0,e.XI)(i,(new Date).getTime())}.jsoncp`,href:window.URL.createObjectURL(a)}),r.dataset.downloadurl=[n,r.download,r.href].join(":"),r.click(),setTimeout((()=>{window.URL.revokeObjectURL(r.href),r.remove()}),1500),t},export(i=!1){const s="application/jsoncp";window.URL=window.webkitURL||window.URL;var n=(0,e.cH)({});this.container.append(n),(0,e.hr)(n.href)||window.URL.revokeObjectURL(n.href);const r={concept:this.conceptModel.schema,values:this.conceptModel.export(),editor:this.config};var a=new Blob([JSON.stringify(r)],{type:s});return Object.assign(n,{download:"model.jsoncp",href:window.URL.createObjectURL(a)}),console.log(a.type),n.dataset.downloadurl=[s,n.download,n.href].join(":"),i?((0,e.WA)(JSON.stringify(r)),this.notify("The model has been copied to clipboard",t.k$.SUCCESS)):(n.click(),this.notify("The model has been downloaded",t.k$.SUCCESS)),setTimeout((()=>{window.URL.revokeObjectURL(n.href),n.remove()}),1500),r},save(e,t){this.createState(e,t),this.refresh()},restore(e){let t=JSON.parse(e),i=this.conceptModel.getConcept(t.id);return i.restore(t),this.refresh(),i},undo(){if((0,e.xb)(this.states))return void this.notify("There are no previous state",t.k$.NORMAL,2e3);let i=(0,e.Z$)(this.states);this.restore(i.value),this.removeState(i.id)},notify(t,i,s=4500){let n=(0,e.qm)({class:["notify"],html:t});const r="open";i&&n.classList.add(i),this.container.append(n),setTimeout((()=>{n.classList.add(r)}),50),setTimeout((()=>{n.classList.remove(r),setTimeout((()=>{n.remove()}),500)}),s)},addResource(t,i){let s=(0,e.XI)(i,t.name.split(".")[0]);this.resources.set(s,t);let n=new FileReader;return n.onload=e=>{this.addModel(s,n.result)},n.readAsText(t),this.refresh(),t},getResource(e){return this.resources.get(e)},hasResource(e){return this.resources.has(e)},removeResource(e){return this.resources.delete(e),this.triggerEvent({name:"resource.removed"}),this.refresh(),!0},addError(e){return this.errors.push(e),this.refresh(),(0,t.lL)(this.status.editorstatusBadge),e},removeError(e){return this.errors.pop(),this.refresh(),!0},clearError(e){return this.errors=[],this.refresh(),!0},getModel(t){let i=this.models.get(t);return(0,e.le)(i)?null:JSON.parse(i)},addModel(e,t){this.models.set(e,t)},removeModel(e){return this.triggerEvent({name:"model.remove@pre",args:[e]},(()=>{this.models.delete(e),this.refresh(),this.triggerEvent({name:"model.remove@post"})}),!1),!0},hasModel(e){return this.models.has(e)},getValue(e){if(this.values.has(e))return this.values.get(e)},addValue(t){let i="value"+Qi++,s=(0,e.oL)({class:["ico","ico-copy"]}),n=(0,e.oL)({class:["ico","ico-delete"]},"✖"),r=(0,e.ax)({class:["btn","btn-copy","fit-content"],title:`Copy ${t.name}`},[s,t.name]),a=(0,e.ax)({class:["btn","btn-delete"]},n),l=(0,e.HV)({class:["model-value"],dataset:{id:i}},[r,a]);if(r.addEventListener("click",(e=>{this.copy(t)})),a.addEventListener("click",(e=>{this.removeValue(i)})),this.values.size>5){let{id:e}=this.valueList.lastChild.dataset;this.removeValue(e)}return this.valueList.prepend(l),this.values.set(i,{element:l,value:t}),this.refresh(),t},removeValue(t){if((0,e.le)(t)||!this.values.has(t))return;let{element:i}=this.values.get(t);return(0,e.ep)(i).remove(),this.values.delete(t),this.refresh(),this},copy(i,s=!1){return(0,e.le)(i)||(this.copyValue=i,(0,e.WA)(JSON.stringify(i)),s&&this.addValue(i),this.notify(`${i.name} copied`,t.k$.NORMAL)),this},paste(t,i){let s=(0,e.XI)(i,this.copyValue);if(!(0,e.le)(s)){if((0,e.le)(t)){let e=this.createConcept(s.name).init();e.setValue(s),this.createInstance(e)}else"prototype"===s.nature?t.setValue(s.value):t.setValue(s);return this}},show(){return this.triggerEvent({name:"editor.show@pre"},(()=>{(0,t.$Z)(this.container),this.attached.forEach((e=>e.show())),this.visible=!0,this.triggerEvent({name:"editor.show@post"})}),!1),this},hide(){return this.triggerEvent({name:"editor.hide@pre"},(()=>{(0,t.Cp)(this.container),this.attached.forEach((e=>e.hide())),this.visible=!1,this.triggerEvent({name:"editor.hide@post"})}),!1),this},toggle(){return this.triggerEvent({name:"editor.toggle@pre"},(()=>{(0,t.ZN)(this.container),this.visible=!this.visible,this.triggerEvent({name:"editor.toggle@post"})}),!1),this},open(){return this.triggerEvent({name:"editor.open@pre"},(()=>{this.show(),this.active=!0,this.isReady&&this.home.close(),this.triggerEvent({name:"editor.open@post"})}),!1),this},close(){return this.triggerEvent({name:"editor.close@pre"},(()=>{this.hide(),this.active=!1,this.done(),this.clear(),this.triggerEvent({name:"editor.close@post"})}),!1),this},destroy(){return this.triggerEvent({name:"editor.destroy@pre"},(()=>{this.hide(),this.done(),this.instances.forEach((e=>e.delete())),(0,e.ep)(this.container).remove()}),!1),!0},freeze(){return this.triggerEvent({name:"editor.freeze@pre"},(()=>{this.frozen=!0,this.refresh(),this.triggerEvent({name:"editor.freeze@post"})}),!1),this},unfreeze(){return this.frozen=!1,this.refresh(),this},done(){return this.conceptModel&&this.conceptModel.done(),this.projectionModel&&this.projectionModel.done(),this},highlight(i){return(0,e.Re)(i)?((0,t.CH)(i),this.decoratedElements.add(i),this):this},unhighlight(i){return(0,e.Re)(i)?((0,t.HW)(i),this.decoratedElements.delete(i),this):(this.decoratedElements.forEach((e=>(0,t.HW)(e))),this.decoratedElements.clear(),this)},createWindow(){let t=(0,e.wC)({class:["editor-window"],tabindex:0});this.body.append(t)},clear(){return this.triggerEvent({name:"editor.clear@pre"},(()=>{this.instances.forEach((e=>e.delete())),this.instances.clear(),this.resources.clear(),this.models.clear(),this.states.forEach((e=>e.element.remove())),this.states=[],this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,this.refresh(),this.triggerEvent({name:"editor.clear@post"})}),!1),this},update(e,t,i){this.triggerEvent({name:e})},attach(e){this.attached.push(e)},detach(e){let t=this.attached.findIndex((t=>t===e));if(-1===t)return null;this.attached.splice(t,1)},render(t){const i=(0,e.DZ)();if(this.home.isRendered||i.append(this.home.render()),this.header.isRendered||i.append(this.header.render()),(0,e.Re)(this.navigationSection)||(this.navigationSection=(0,e.vB)({class:["model-navigation-section"]}),this.viewSection=(0,e.Pi)({class:["model-view-section"]}),this.navigationSection.append(this.viewSection),i.append(this.navigationSection)),!(0,e.Re)(this.body)){this.body=(0,e.wC)({class:["editor-body"],tabindex:0});let t=(0,e.wC)({class:["editor-body-main"],tabindex:0});this.instanceSection=(0,e.vB)({class:["model-concept-section"]}),t.append(this.instanceSection),this.body.append(t),i.append(this.body)}return(0,e.Re)(this.timeline)||(this.timeline=(0,e.wC)({class:["editor-timeline"]}),this.stateList=(0,e.w_)({class:["bare-list","model-state-list"]}),this.timeline.append(this.stateList),i.append(this.timeline)),this.logs.isRendered||i.append(this.logs.render()),this.breadcrumb.isRendered||this.navigationSection.append(this.breadcrumb.render()),(0,e.Re)(this.valueSection)||(this.valueSection=(0,e.wC)({class:["model-value-window"]}),this.valueList=(0,e.w_)({class:["bare-list","model-value-list"]}),this.valueSection.append(this.valueList),this.navigationSection.append(this.valueSection)),this.status.isRendered||i.append(this.status.render()),(0,e.Re)(this.input)||(this.input=(0,e.Ju)({type:"file",class:["hidden"],accept:".json,.jsoncp"}),i.append(this.input)),i.hasChildNodes()&&(this.container.append(i),this.bindEvents()),(0,e.Re)(t)&&t.append(this.container),this.refresh(),this.container},refresh(i=!1){return this.frozen&&!i||(this.home.isOpen?this.container.classList.add("unfocus"):this.container.classList.remove("unfocus"),this.hasValues?(0,t.$Z)(this.valueWindow):(0,t.Cp)(this.valueWindow),this.header.refresh(),this.breadcrumb.refresh(),this.home.refresh(),this.logs.refresh(),this.status.refresh(),this.instanceSection.dataset.view=this.status.view,["grid"].includes(this.status.view)?(0,t.Cp)(this.viewSection):["tab"].includes(this.status.view)&&(0,t.$Z)(this.viewSection),(0,e.xb)(this.states)?(0,t.Cp)(this.timeline):((0,t.$Z)(this.timeline),this.states.forEach((e=>{this.conceptModel.hasConcept(e.concept.id)?this.hasActiveConcept&&this.activeConcept===e.concept?e.element.classList.add("active"):e.element.classList.remove("active"):this.removeState(e.id)})))),this},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.activeElement=e,this.triggerEvent({name:"editor.element@active:updated"})),this},updateActiveConcept(e){return this.hasActiveConcept&&this.activeConcept===e||(this.activeConcept=e,this.triggerEvent({name:"editor.concept@active:updated"}),this.refresh()),this},updateActiveProjection(t){if(this.activeProjection&&this.activeProjection===t)return this;let i=(0,e.$3)(".active-parent",this.body);for(let e=0;e<i.length;e++)i[e].classList.remove("active-parent");this.activeProjection=t;let s=this.activeProjection.parent;for(;s;)s.getContainer().classList.add("active-parent"),s=s.parent;return this.triggerEvent({name:"editor.projection@active:updated"}),this.refresh(),this},updateActiveInstance(e){if(this.activeInstance){if(this.activeInstance===e)return this;this.activeInstance,this.activeInstance.container.classList.remove("active")}return this.activeInstance=e,this.activeInstance.container.classList.add("active"),this.triggerEvent({name:"editor.instance@active:updated"}),this.refresh(),this},bindEvents(){var i=null,s=null;const n={open:e=>{const{context:t}=e.dataset;t?this[t].open():this.open()},close:e=>{const{context:t,id:i,type:s}=e.dataset;t?this[t].close():this.close()},collapse:t=>{const{rel:i,target:s}=t.dataset;if("parent"===i){let i=(0,e.wr)(t,(e=>e.dataset.name===s));if((0,e.Re)(i)){const{alias:e=""}=i.dataset;i.classList.toggle("collapsed");let s=i.classList.contains("collapsed");t.dataset.state=s?"ON":"OFF",t.title=s?`Expand ${e.toLowerCase()}`:`Collapse ${e.toLowerCase()}`}}},delete:t=>{const{target:i}=t.dataset;if("parent"===i){let i=t.parentElement;(0,e.ep)(i),i.remove()}},"delete:value":e=>{const{id:t}=e.dataset;this.conceptModel.removeValue(t),this.header._valueSelector.update()},"delete:resource":e=>{const{id:t}=e.dataset;this.removeResource(t)},"change-view":e=>{const{value:t}=e.dataset;this.status.changeView(t)},"add-group":e=>{this.status.addGroup()},style:e=>{this.style.toggle()},home:e=>{this.home.toggle()},logs:e=>{this.logs.toggle()},export:e=>{this.export()},"export--copy":e=>{this.export(!0)},"create-instance":e=>{const{concept:t}=e.dataset;let i=this.createConcept(t);this.createInstance(i)},"create-instance:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t),s=this.createConcept(i.name);s.initValue(i),this.createInstance(s)},"copy:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t);this.copy(i)},save:e=>{this.save()},undo:e=>{this.undo()},load:e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},unload:e=>{this.unload()},"load-concept":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-concept":e=>{this.unloadAllConcept()},"download-concept":e=>{const{schema:t,values:i}=this.conceptModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({concept:t},`${s}_model`)},"load-projection":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-projection":e=>{this.unloadAllProjection()},"download-projection":e=>{const{schema:t,views:i}=this.projectionModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({projection:t},`${s}_projection`)}},r={[t.sr.up_arrow]:"up",[t.sr.right_arrow]:"right",[t.sr.down_arrow]:"down",[t.sr.left_arrow]:"left"};this.container.addEventListener("click",(i=>{var s=(0,t.NI)(i.target);const{action:r,context:a,id:l}=s.dataset;if("instance"===a)return void this.getInstance(l).actionHandler(r);if("menu"===a)return void this.home.actionHandler(r,s);if(this.activeElement&&this.activeElement.clickHandler(s),(0,e.le)(r))return;if(this.actions.has(r))return console.warn(r),this.actions.get(r).call(this,s),void s.blur();const o=n[r];(0,e.mf)(o)?(o(s),s.blur()):r&&this.triggerEvent({name:r})}),!0),this.input.addEventListener("change",(e=>{let t=this.input.files[0];this.load(t,s),this.input.value=""})),this.body.addEventListener("copy",(e=>{if(!(0,t.QE)(e.target)){let t=this.activeConcept.copy(!1);this.copy(t,!0),e.preventDefault()}})),this.body.addEventListener("keydown",(s=>{const{target:n}=s,{nature:a}=n.dataset;var l=!1;switch(s.key){case t.sr.backspace:this.activeElement&&i!==t.sr.ctrl&&!0===this.activeElement.backspaceHandler(n)&&s.preventDefault();break;case t.sr.ctrl:case t.sr.shift:s.preventDefault(),l=!0;break;case t.sr.delete:this.activeElement&&i!==t.sr.ctrl&&!(0,t.QE)(n)&&this.activeElement.deleteHandler(n)&&s.preventDefault();break;case t.sr.spacebar:this.activeElement&&i!==t.sr.ctrl&&this.activeElement.spaceHandler(n)&&s.preventDefault();break;case t.sr.alt:s.preventDefault();break;case t.sr.enter:this.activeElement?!0===this.activeElement.enterHandler(n)&&s.preventDefault():"concept-container"===a?this.activeInstance.projection.focus():"editable"===a?n.blur():"BUTTON"===n.tagName?(n.click(),s.preventDefault()):s.preventDefault();break;case t.sr.escape:this.activeElement&&(!0===this.activeElement.escapeHandler(n)?s.preventDefault():(0,e.wr)(n,(e=>0===e.tabIndex)).focus());break;case t.sr.insert:this.activeElement&&s.preventDefault();break;case t.sr.up_arrow:case t.sr.right_arrow:case t.sr.down_arrow:case t.sr.left_arrow:if(this.activeElement&&![t.sr.ctrl,t.sr.shift,t.sr.alt].includes(i))!0===this.activeElement.arrowHandler(r[s.key],n)&&s.preventDefault();else if("concept-container"===a&&![t.sr.ctrl,t.sr.shift,t.sr.alt].includes(i)){let i=(0,t.As)(n,r[s.key],this.instanceSection);if(!(0,e.Re)(i))return!1;i.focus()}break;case"s":i===t.sr.ctrl&&(this.activeConcept.copy(),this.header.valueCount++,this.refresh(),s.preventDefault());break;case"c":if(i===t.sr.ctrl){let e=new ClipboardEvent("copy");this.body.dispatchEvent(e)}break;case"v":if(i===t.sr.ctrl){if((0,t.QE)(n))return;this.paste(this.activeConcept,this.copyValue)}break;case"e":i===t.sr.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),s.preventDefault());break;case"f":break;case"z":i===t.sr.ctrl&&((0,t.QE)(n)||(this.undo(),s.preventDefault()))}l&&(i=s.key)}),!1),this.body.addEventListener("keyup",(s=>{var n=s.target;const{nature:a}=n.dataset;switch(s.key){case t.sr.spacebar:this.activeElement&&i===t.sr.ctrl&&this.activeElement._spaceHandler(n);break;case t.sr.delete:this.activeElement&&i===t.sr.ctrl&&this.activeElement.delete(n);break;case t.sr.alt:break;case t.sr.up_arrow:case t.sr.down_arrow:case t.sr.right_arrow:case t.sr.left_arrow:if(this.activeElement&&i===t.sr.ctrl)!0===this.activeElement._arrowHandler(r[s.key],n)&&s.preventDefault();else if("concept-container"===a&&i===t.sr.ctrl){let a=(0,t.As)(n,r[s.key],this.instanceSection);if(!(0,e.Re)(a))return!1;this.swapInstance(n,a,!0),n.focus(),i=t.sr.ctrl}}i===s.key&&(i=-1)}),!1),this.body.addEventListener("focusin",(e=>{const{target:t}=e,s=this.resolveElement(t);if(i=-1,s?(this.activeElement&&this.activeElement!==s&&(this.activeElement.focusOut(),this.activeElement=null),this.updateActiveElement(s),this.activeElement.focusIn(t)):(this.activeElement&&this.activeElement.focusOut(t),this.activeElement=null),this.activeElement){let e=this.activeElement.projection;this.updateActiveProjection(e),this.updateActiveConcept(e.concept)}else this.activeConcept=null,this.activeProjection=null;this.refresh()})),this.registerHandler("export",(()=>this.export())),this.registerHandler("value.changed",(()=>this.refresh())),this.registerHandler("value.added",(()=>this.refresh())),this.registerHandler("value.removed",(()=>this.refresh())),this.registerHandler("load-resource",(e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});s=e[0],this.input.dispatchEvent(t)}))}},Yi=Object.assign(Ki,qi,Ui,_,Ji);Object.defineProperty(Yi,"hasConceptModel",{get(){return!(0,e.le)(this.conceptModel)}}),Object.defineProperty(Yi,"hasProjectionModel",{get(){return!(0,e.le)(this.projectionModel)}}),Object.defineProperty(Yi,"hasInstances",{get(){return this.instances.size>0}}),Object.defineProperty(Yi,"hasWindows",{get(){return this.windows.size>0}}),Object.defineProperty(Yi,"hasValues",{get(){return this.values.size>0}}),Object.defineProperty(Yi,"isReady",{get(){return this.hasConceptModel&&this.hasProjectionModel}}),Object.defineProperty(Yi,"hasActiveConcept",{get(){return!(0,e.le)(this.activeConcept)}}),Object.defineProperty(Yi,"hasActiveProjection",{get(){return!(0,e.le)(this.activeProjection)}}),Object.defineProperty(Yi,"hasActiveInstance",{get(){return!(0,e.le)(this.activeInstance)}}),Object.defineProperty(Yi,"hasError",{get(){return!(0,e.xb)(this.errors)}});const es="editor";function ts(i){const s=(0,t.fP)(i),n=(t=>(0,e.Re)(t)&&(0,e.RI)(t.dataset,"gentleman"))(a=s)&&a.dataset.gentleman===es?[s]:(0,e.$3)('[data-gentleman="editor"]',s),r=[];var a;return n.forEach((e=>{r.push(is(e))})),r}function is(i){let s=(0,t.fP)(i);return(0,e.Re)(i)||(s=(0,e.wC)({tabindex:-1})),s.classList.add("gentleman-editor"),s.dataset.gentleman=es,Object.create(Yi,{object:{value:"environment"},type:{value:es},name:{value:"gentleman editor"},container:{value:s}})}})(),s})()}));